<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Common variables" href="Environment_Variables.html" />
    <link rel="prev" title="&lt;no title&gt;" href="Editing.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>IPA v2 will include support for counting the number of enrolled clients
and comparing that with a number of <em>entitlements</em> and logging it is out
of compliance.</p>
<p>The entitlement server is the <a class="reference external" href="https://fedorahosted.org/candlepin/wiki">Candlepin
server</a>.</p>
<p>An enrolled client is defined as a machine with a keytab.</p>
<p>IPA will provide 25 entitlements with the base server install.</p>
</section>
<section id="entitlements">
<h1>Entitlements<a class="headerlink" href="#entitlements" title="Permalink to this heading">¶</a></h1>
<p>Entitlements take the form of an X.509 v3 certificate. Certificate
extensions are used to store bits of information about the entitlement
such as the product being entitled, the quantity, etc. The validity of
the certificate represents the validity of the entitlement. When the
certificate expires, the entitlement expires.</p>
</section>
<section id="bootstrapping">
<h1>Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permalink to this heading">¶</a></h1>
<p>When one obtains an entitlement a username and password is provided.
This username and password is sent to the Cancelpin server and registers
as a consumer (of entitlements). The result of this registration is an
SSL client certificate and private key. All subsequent operations
against the Candlepin server are done using this cert and key. This cert
and key will be packaged as a PKCS#12 object and stored in LDAP so that
all IPA servers will have access to it. The password to decrypt it is
currently TBD but I’m leaning towards using the Apache NSS database
password as we have easy access to it.</p>
</section>
<section id="entitlement-cli-operations">
<span id="id1"></span><h1>Entitlement CLI Operations<a class="headerlink" href="#entitlement-cli-operations" title="Permalink to this heading">¶</a></h1>
<p>The ipa command-line will have an entitlements plugin. This plugin will
only be enabled if a setting is True in /etc/ipa/default.conf. By
default this will be False, hiding the plugin.</p>
<p>We will support the following operations:</p>
<ul class="simple">
<li><p>Obtain new entitlement for <em>n</em> clients</p></li>
<li><p>Return an existing entitlement back to the Candlepin server</p></li>
<li><p>Count of current entitlements</p></li>
<li><p>List all entitlements including date, quantity and product</p></li>
<li><p>Import an entitlement Certificate. This loads a raw entitlement
certificate and is only allowed if we are not enrolled to a Candlepin
server.</p></li>
</ul>
</section>
<section id="cron-operations">
<span id="id2"></span><h1>Cron Operations<a class="headerlink" href="#cron-operations" title="Permalink to this heading">¶</a></h1>
<p>A cronjob will pull the entitlements out of IPA and Candlepin and first
compare that we have the right entitlements stored in IPA. Next it will
compare the quantity to the number of enrolled clients (meaning those
entries in cn=computers,cn=accounts that have a krbprincipalkey). We
will bind using the host keytab, meaning that all replicas need to be
able to write the entitlements.</p>
</section>
<section id="counting-hosts">
<span id="id3"></span><h1>Counting Hosts<a class="headerlink" href="#counting-hosts" title="Permalink to this heading">¶</a></h1>
<p>Since the number of entitlements is linked to the number of hosts users
will want to be able to find those hosts that aren’t being used. A
simple LDAP query can be used to determine this:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ldapsearch -x -b 'cn=computers,cn=accounts,dc=example,dc=com' \</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&quot;(&amp;(krbLastSuccessfulAuth &lt; 201004110000Z)(krbPrincipalName=*))&quot; fqdn</span></code></div>
</div>
<p>This looks for all hosts that have a principal and haven’t logged in
since April 11, 2010.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Entitlements_Design.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>