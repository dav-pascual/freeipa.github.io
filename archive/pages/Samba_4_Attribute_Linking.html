<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Overview" href="Samba_4_Attribute_Syntax_Mapping.html" />
    <link rel="prev" title="Overview" href="Samba_4_Attribute_Indexing.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Samba currently uses several methods to maintain links between objects
in the directory:</p>
<ul class="simple">
<li><p>linked_attributes LDB module for TDB and DS backend</p></li>
<li><p>memberof and refint overlay for OpenLDAP backend</p></li>
</ul>
<p>DS provides Linked Attributes and Referential Integrity plugins which
can be used to achieve the same goal. Samba provisioning tool should be
modified to utilize these plugins.</p>
</section>
<section id="attribute-linking">
<span id="id1"></span><h1>Attribute Linking<a class="headerlink" href="#attribute-linking" title="Permalink to this heading">¶</a></h1>
<p>Attribute linking is defined using the linkID attribute in Active
Directory schema. An attribute with linkID n is linked to another
attribute with linkID n+1. See the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cn</span><span class="p">:</span> <span class="n">Member</span>
<span class="n">ldapDisplayName</span><span class="p">:</span> <span class="n">member</span>
<span class="n">linkID</span><span class="p">:</span> <span class="mi">2</span>

<span class="n">cn</span><span class="p">:</span> <span class="n">Is</span><span class="o">-</span><span class="n">Member</span><span class="o">-</span><span class="n">Of</span><span class="o">-</span><span class="n">DL</span>
<span class="n">ldapDisplayName</span><span class="p">:</span> <span class="n">memberOf</span>
<span class="n">linkID</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>In this example the member attribute is linked to the memberOf
attribute.</p>
<p>Suppose in the DIT there’s already an entry as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Administrator</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
</pre></div>
</div>
<p>Suppose a new entry is added with a link pointing to the above entry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Enterprise</span> <span class="n">Admins</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
<span class="n">member</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Administrator</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
</pre></div>
</div>
<p>A new attribute will be added to the target entry pointing back to the
new entry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Administrator</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
<span class="n">memberOf</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Enterprise</span> <span class="n">Admins</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
</pre></div>
</div>
</section>
<section id="current-code">
<span id="id2"></span><h1>Current Code<a class="headerlink" href="#current-code" title="Permalink to this heading">¶</a></h1>
<section id="openldap-configuration">
<span id="id3"></span><h2>OpenLDAP Configuration<a class="headerlink" href="#openldap-configuration" title="Permalink to this heading">¶</a></h2>
<p>The template for the memberof overlay configuration is stored in
source4/setup/memberof.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>overlay memberof
memberof-dn cn=samba-admin,cn=samba
memberof-dangling error
memberof-refint TRUE
memberof-group-oc top
memberof-member-ad ${MEMBER_ATTR}
memberof-memberof-ad ${MEMBEROF_ATTR}
memberof-dangling-error 32
</pre></div>
</div>
<p>The template for the refint overlay configuration is stored in
source4/setup/refint.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>overlay refint
refint_modifiersName cn=samba-admin,cn=samba
refint_attributes ${LINK_ATTRS}
</pre></div>
</div>
</section>
<section id="provisioning-tool">
<span id="id4"></span><h2>Provisioning Tool<a class="headerlink" href="#provisioning-tool" title="Permalink to this heading">¶</a></h2>
<p>The provision_openldap_backend() uses the following code to configure
attribute linking in OpenLDAP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lnkattr</span> <span class="o">=</span> <span class="n">get_linked_attributes</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">schemadn</span><span class="p">,</span><span class="n">schema</span><span class="o">.</span><span class="n">ldb</span><span class="p">)</span>

<span class="n">refint_attributes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">memberof_config</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="k">for</span> <span class="n">att</span> <span class="ow">in</span>  <span class="n">lnkattr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

    <span class="n">refint_attributes</span> <span class="o">=</span> <span class="n">refint_attributes</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">att</span>

    <span class="n">memberof_config</span> <span class="o">+=</span> <span class="n">read_and_sub_file</span><span class="p">(</span><span class="n">setup_path</span><span class="p">(</span><span class="s2">&quot;memberof.conf&quot;</span><span class="p">),</span>
        <span class="p">{</span> <span class="s2">&quot;MEMBER_ATTR&quot;</span> <span class="p">:</span> <span class="n">att</span> <span class="p">,</span>
          <span class="s2">&quot;MEMBEROF_ATTR&quot;</span> <span class="p">:</span> <span class="n">lnkattr</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="p">})</span>
</pre></div>
</div>
</section>
</section>
<section id="proposed-changes">
<span id="id5"></span><h1>Proposed Changes<a class="headerlink" href="#proposed-changes" title="Permalink to this heading">¶</a></h1>
<section id="ds-configuration">
<span id="id6"></span><h2>DS Configuration<a class="headerlink" href="#ds-configuration" title="Permalink to this heading">¶</a></h2>
<p>The Linked Attributes Plugin should be configured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dn: cn=${MEMBER_ATTR} to ${MEMBEROF_ATTR},cn=Linked Attributes,cn=plugins,cn=config
objectclass: extensibleObject
cn: ${MEMBER_ATTR} to ${MEMBEROF_ATTR}
linkType: ${MEMBER_ATTR}
managedType: ${MEMBEROF_ATTR}
</pre></div>
</div>
<p>The Referential Integrity Plugin should be configured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dn: cn=referential integrity postoperation,cn=plugins,cn=config
nsslapd-pluginArg0: 0
nsslapd-pluginArg1: %log_dir%/referint
nsslapd-pluginArg2: 0
nsslapd-pluginArg3: ${ATTR1}
nsslapd-pluginArg4: ${ATTR2}
nsslapd-pluginArg5: ${ATTR3}
...
</pre></div>
</div>
<p>The attributes must have an equality index. See also <a class="reference external" href="Obsolete:Samba_4_Attribute_Indexing">this
page</a>.</p>
</section>
<section id="provisioning-tool-1">
<span id="id7"></span><h2>Provisioning Tool<a class="headerlink" href="#provisioning-tool-1" title="Permalink to this heading">¶</a></h2>
<p>The provision_fds_backend() should uses a similar code to configure
attribute linking in DS.</p>
</section>
</section>
<section id="issues">
<h1>Issues<a class="headerlink" href="#issues" title="Permalink to this heading">¶</a></h1>
<p>There is a minor issue in DS:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=527500">Use proper attribute names for plugin
parameters</a></p></li>
</ul>
</section>
<section id="samba-patches">
<span id="id8"></span><h1>Samba Patches<a class="headerlink" href="#samba-patches" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="http://gitweb.samba.org/?p=samba.git;a=commit;h=cf77bf338260e33e7353f1176210d5cac5a6048d">s4:provision - replaced linked_attributes with FDS
plugins</a></p></li>
</ul>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="http://directory.fedoraproject.org/wiki/Linked_Attributes_Design">Linked Attributes
Design</a></p></li>
<li><p><a class="reference external" href="http://directory.fedoraproject.org/wiki/MemberOf_Plugin">MemberOf
Plugin</a></p></li>
<li><p><a class="reference external" href="http://www.openldap.org/doc/admin24/overlays.html#Reverse%20Group%20Membership%20Maintenance">Reverse Group Membership
Maintenance</a></p></li>
<li><p><a class="reference external" href="http://linux.die.net/man/5/slapo-memberof">slapo-memberof(5)</a></p></li>
<li><p><a class="reference external" href="http://www.redhat.com/docs/manuals/dir-server/8.1/admin/Creating_Directory_Entries-Maintaining_Referential_Integrity.html">Maintaining Referential
Integrity</a></p></li>
<li><p><a class="reference external" href="http://www.redhat.com/docs/manuals/dir-server/8.1/admin/Advanced_Entry_Management-Using_Groups.html#memberof-syntax">The MemberOf Plug-in
Syntax</a></p></li>
<li><p><a class="reference external" href="http://www.redhat.com/docs/manuals/dir-server/8.1/admin/Managing_Indexes.html">Managing
Indexes</a></p></li>
<li><p><a class="reference external" href="http://www.redhat.com/docs/manuals/dir-server/8.1/admin/Managing_Indexes-Creating_Indexes.html">Creating Standard
Indexes</a></p></li>
</ul>
<p><a class="reference external" href="Category:Obsolete">Category:Obsolete</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Samba_4_Attribute_Linking.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>