<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Prerequisite: &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Step 1. Create our Group to be used for user validation" href="YubiRadius_integration_with_group-validated_FreeIPA_Users_using_LDAPS.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><strong>HOWTO: Zimbra Collaboration Server 7.2 - Authentication and GAL
lookups against FreeIPA.</strong></p>
<p><strong>Provided by Dale Macartney</strong></p>
<p>This document is written as an integration document to configure IPA as
an Authentication Source as well as a Directory source for an already
existing Zimbra installation.</p>
<p>This document is not intended as a walkthrough on how to install and
configure Zimbra Collaboration Server.</p>
<p>This document was written and tested using Red Hat Enterprise Linux 6.2
x86_64 running Zimbra Collaboration Server 7.2 (Network Edition)</p>
<p>For the purpose of this document, the following information is given</p>
<p>Servers:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">IPA Server = ds01.example.com</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Zimbra Server = zimbra03.example.com</span></code></div>
</div>
<p><strong>``IMPORTANT``</strong></p>
<p>Please note, that by adding FreeIPA as the external authentication
backend, the username “admin” will clash as both IPA and Zimbra use an
admin account.</p>
<p>you MUST set the following so that, should LDAP authentication fail for
what ever reason, you will be able to still login with the local admin
account.</p>
<p>If you do not do this and you lose LDAP authentication, you will not be
able to log in as the Zimbra Admin user.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;zimbra03 ~]# su -l zimbra</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[zimbra&#64;zimbra03 ~]$ zmprov modifydomain example.com zimbraAuthFallbackToLocal TRUE</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[zimbra&#64;zimbra03 ~]$</span></code></div>
</div>
<section id="prerequisite">
<h1>Prerequisite:<a class="headerlink" href="#prerequisite" title="Permalink to this heading">¶</a></h1>
<p>We will need to create a bind account for Zimbra to authenticate to IPA
as a service account.</p>
<p>To do this, create an ldif file detailing your service account. I used
the following, saved as zimbra.ldif</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn: uid=zimbra,cn=sysaccounts,cn=etc,dc=example,dc=com</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">changetype: add</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectclass: account</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectclass: simplesecurityobject</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">uid: zimbra</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">userPassword: woofwoofimasecretpasswordthatisreallydifficult</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">passwordExpirationTime: 20380119031407Z</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nsIdleTimeout: 0</span></code></div>
</div>
<p>Save your file, and then import it on your IPA server</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]# ldapmodify -h ds01.example.com -p 389 -x -D &quot;cn=Directory  Manager&quot; -w redhat123 -f zimbra.ldif</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">adding new entry &quot;uid=zimbra,cn=sysaccounts,cn=etc,dc=example,dc=com&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]#</span></code></div>
</div>
<p>Your service account is now imported</p>
</section>
<section id="zimbra-authentication-with-freeipa">
<span id="id1"></span><h1>Zimbra Authentication with FreeIPA<a class="headerlink" href="#zimbra-authentication-with-freeipa" title="Permalink to this heading">¶</a></h1>
<p>Step 1 :</p>
<p>Log into the Zimbra admin console
<a class="reference external" href="https://zimbra03.example.com:7071/zimbraAdmin/">https://zimbra03.example.com:7071/zimbraAdmin/</a></p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id7">
<img alt="1-AdminConsoleCrop.png" src="../../_images/1-AdminConsoleCrop.png" />
<figcaption>
<p><span class="caption-text">1-AdminConsoleCrop.png</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 2 :</p>
<p>Once logged in as the admin user, on the left select domains, then click
the domain you wish to add authentication to, and click the
Authentication button above it.</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id8">
<img alt="2-ZimbraDomainsCrop.png" src="../../_images/2-ZimbraDomainsCrop.png" />
<figcaption>
<p><span class="caption-text">2-ZimbraDomainsCrop.png</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 3 :</p>
<p>Select “External LDAP”</p>
<p>Enter your IPA server’s host name (mine is ds01.example.com)</p>
<p>Under LDAP Filter, enter
“(&amp;(objectClass=inetOrgPerson)(objectClass=posixAccount)(uid=%u))”
without the quotes</p>
<p>Under LDAP Search Base, enter “cn=users,cn=accounts,dc=example,dc=com”
without the quotes</p>
<p>Then click Next.</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id9">
<img alt="3-AuthenticationConfigurationCrop.png" src="../../_images/3-AuthenticationConfigurationCrop.png" />
<figcaption>
<p><span class="caption-text">3-AuthenticationConfigurationCrop.png</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 4 :</p>
<p>Place a tick in the box next to “Use DN/Password to bind to external
server:” and enter your service account details.</p>
<p>Note: the correct value to use is as it appears as the output from your
ldapmodify command above.</p>
<p>Click Next</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id10">
<img alt="4-AuthenticationConfigurationBindAccCrop.png" src="../../_images/4-AuthenticationConfigurationBindAccCrop.png" />
<figcaption>
<p><span class="caption-text">4-AuthenticationConfigurationBindAccCrop.png</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 5 :</p>
<p>Here you have the chance to verify your settings to make sure they are
working.</p>
<p>Create a test user and enter the username and password in the fields
available, and then click the test button</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id11">
<img alt="5-AuthenticationConfigurationTestUserCrop.png" src="../../_images/5-AuthenticationConfigurationTestUserCrop.png" />
<figcaption>
<p><span class="caption-text">5-AuthenticationConfigurationTestUserCrop.png</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 6 :</p>
<p>If everything is behaving as it should, you will see a green message,
stating that the authentication process completed suggessfully.</p>
<p>Click next and then finally click finish.</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id12">
<img alt="6-AuthenticationConfigurationAuthSuccessCrop.png" src="../../_images/6-AuthenticationConfigurationAuthSuccessCrop.png" />
<figcaption>
<p><span class="caption-text">6-AuthenticationConfigurationAuthSuccessCrop.png</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The authentication process is now completed.</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id13">
<img alt="7-AuthenticationConfigurationFinishedCrop.png" src="../../_images/7-AuthenticationConfigurationFinishedCrop.png" />
<figcaption>
<p><span class="caption-text">7-AuthenticationConfigurationFinishedCrop.png</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 6 :</p>
<p>Now verify your work and mail-enable your test user</p>
<p>Inside the admin console, on the left, select accounts, then click new,
account Fill in the relevant details, where the account name matches the
username within IPA</p>
<p>Under the “Password” section, enter the External LDAP Account as it
would appear from an ldapsearch. My testuser appears as follows
uid=testuser,cn=users,cn=accounts,dc=example,dc=com</p>
<p>Click Finish once you have filled in all the details you wish to enter.</p>
<figure class="align-default" id="id14">
<img alt="9-AccountsCreateUserCrop.png" src="../../_images/9-AccountsCreateUserCrop.png" />
<figcaption>
<p><span class="caption-text">9-AccountsCreateUserCrop.png</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In a new window, open your browser to <a class="reference external" href="http://zimbra03.example.com/">http://zimbra03.example.com/</a> enter
your IPA username and password and login</p>
<p>Once you have logged in, you will see a new empty mailbox with the test
username in the top right corner.</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id15">
<img alt="12-WebMailConsoleCrop.png" src="../../_images/12-WebMailConsoleCrop.png" />
<figcaption>
<p><span class="caption-text">12-WebMailConsoleCrop.png</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="zimbra-global-address-list-lookups-against-freeipa">
<span id="id2"></span><h1>Zimbra Global Address List lookups against FreeIPA<a class="headerlink" href="#zimbra-global-address-list-lookups-against-freeipa" title="Permalink to this heading">¶</a></h1>
<p>Step 1 :</p>
<p>In the admin console, on the left select domains, then click the domain
you wish to edit</p>
<p>Click the “Configure GAL” button and enter the following details</p>
<p>Step 2 :</p>
<p>IMPORTANT, the default port for the ldap search seems to be spefic for
Active Directory. Please change the port number to 389</p>
<p>Enter the address of your IPA server under “External Server Name” and
set the port to 389</p>
<p>Under “Search Filter”, enter “(&amp;(<a href="#id3"><span class="problematic" id="id4">|</span></a>(cn=*%s*)(sn=*%s*)))” without the
quotes.</p>
<p>Under “Autocomplete Filter”, enter
“(<a href="#id5"><span class="problematic" id="id6">|</span></a>(uid=%s*)(givenname=%s*)(mail=%s*))” without the quotes.</p>
<p>Under “LDAP Search base”, enter “dc=example,dc=com” without the quotes.</p>
<p>Then click next</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id16">
<img alt="13-GALConfigurationCrop.png" src="../../_images/13-GALConfigurationCrop.png" />
<figcaption>
<p><span class="caption-text">13-GALConfigurationCrop.png</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 3 :</p>
<p>Place a tick in the box where is says “Use DN/Password to bind to
external server”</p>
<p>Use the service account you created earlier as the bind account. Enter
the following “uid=zimbra,cn=sysaccounts,cn=etc,dc=example,dc=com”
without the quotes</p>
<p>Enter your service account password.</p>
<p>Click Next</p>
<p>See attached screenshot.</p>
<figure class="align-default" id="id17">
<img alt="14-GALConfigurationBindAccCrop.png" src="../../_images/14-GALConfigurationBindAccCrop.png" />
<figcaption>
<p><span class="caption-text">14-GALConfigurationBindAccCrop.png</span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 4:</p>
<p>By default, there will be a tick alongside “Use GAL search settings for
GAL sync”, leave this as is and click next.</p>
<figure class="align-default" id="id18">
<img alt="15-GALConfigurationGALSyncCrop.png" src="../../_images/15-GALConfigurationGALSyncCrop.png" />
<figcaption>
<p><span class="caption-text">15-GALConfigurationGALSyncCrop.png</span><a class="headerlink" href="#id18" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Step 5:</p>
<p>Enter the username or other name for your test user, and click the test
button.</p>
<p>See attached screenshot</p>
<figure class="align-default" id="id19">
<img alt="16-GALConfigurationTestUserCrop.png" src="../../_images/16-GALConfigurationTestUserCrop.png" />
<figcaption>
<p><span class="caption-text">16-GALConfigurationTestUserCrop.png</span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>If your search is successful, click Finish.</p>
<figure class="align-default" id="id20">
<img alt="17-GALConfigurationTestSuccessCrop.png" src="../../_images/17-GALConfigurationTestSuccessCrop.png" />
<figcaption>
<p><span class="caption-text">17-GALConfigurationTestSuccessCrop.png</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Your IPA GAL is now implemented.</p>
<p>You can verify the Global Address list by creating a new email and
clicking the “To:” button which will allow you to search for your
FreeIPA user accounts.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Zimbra_Collaboration_Server_7.2_Authentication_and_GAL_lookups_against_FreeIPA.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>