<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Trust_GC_support.html" />
    <link rel="prev" title="Overview" href="Time-Based_Account_Policies.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Related tickets <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3068">#3068</a></p>
<p>Tool for FreeIPA which will check status of every replica in FreeIPA
infrastructure. We can check status of FreeIPA related services via
ipactl status command on each replica but we do not have an information
about services running on other replicas. I chose an approach to have a
running net-snmp agent on each replica. Every agent has a set of
services in its configuration file which statuses will be check.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>On each replica will be a client which sends snmp request message to
agents on replicas. Agents send back a message or messages with
information about number of running services of each name. This
communication is asynchronous therefore timeouts for waiting for replies
will be needed.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>When FreeIPA server starts then ipactl gets a set of services for each
replica from directory server and saves them to the net-snmp agent’s
config file. Net-snmp agent cannot check status of services because it
can only check the number of running processes of each service name
(names which could be visible with “/bin/ps -e”) in config file. NTP
service could be configured as FreeIPA part but this information is not
stored in Directory Server as for other services, for example like DNS.
I choose solution when I “grep” /var/lib/ipa/sysrestore/sysrestore.state
file for presence ‘[ntpd]’ option in it.</p>
<p>Client will be authorized to agent via SNMPv3 security possibilities.
SNMPv3 is used for authentication and for privacy. Each replica should
have own account for access to SNMP MIB. Replicas could be created or
removed dynamically, but net-snmp loads account informations during
start from file. Solution is to restart net-snmp daemons on all replicas
after every infrastructure change. This will be the first solution.</p>
<p>Better soulution is implement LDAP backend support for net-snmp
(credentials for client authentication and privacy should be stored
here). New LDAP schema for this support should be defined. Net-snmp
agent then could send query to local 389 DS instance and look up account
information in it. Agent can verify client’s identity after he gets hash
of client passphrase. This extension will be implement later.</p>
<figure class="align-default" id="id3">
<img alt="650|x" src="../../../_images/Tool_to_check_statuses_of_services.png" />
<figcaption>
<p><span class="caption-text">650|x</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="example-agent-s-configuration">
<span id="example-agents-configuration"></span><h2>Example agent’s configuration<a class="headerlink" href="#example-agent-s-configuration" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">``   /etc/snmp/snmpd.conf``</div>
<div class="line">``   ### Added by IPA Installer ###``</div>
<div class="line">``   proc krb5kdc``</div>
<div class="line">``   proc kadmind``</div>
<div class="line">``   proc named``</div>
<div class="line">``   proc memcached``</div>
<div class="line">``   proc httpd``</div>
<div class="line">``   proc java``</div>
<div class="line">``   proc ntpd``</div>
<div class="line">``   proc ns-slapd``</div>
<div class="line">``   ``</div>
<div class="line">``   createUser  myuser SHA authpassphrase AES privpassphrase``</div>
<div class="line">``   rouser -s usm myuser authpriv .1.3.6.1.4.1.2021.2``</div>
</div>
<p>proc option checks number of running processes “name”.</p>
<p>createUser option creates user “myuser” with SHA authentication password
“authpassphrase” and with AES “privpassphrase” password for privacy.</p>
<p>rouser specifies read-only access for user “myuser” to
“.1.3.6.1.4.1.2021.2 “ OID tree. This OID is subtree which stores
information for proc options. authpriv specifies minimum security level
which enforces use of authentication and encryption.</p>
<p>Proc java is in example because pki-tomcatd is visible only as “java”
with /bin/ps -e.</p>
</section>
<section id="example-how-to-get-data-from-agent">
<span id="id1"></span><h2>Example how to get data from agent<a class="headerlink" href="#example-how-to-get-data-from-agent" title="Permalink to this heading">¶</a></h2>
<p>``   snmpwalk -v 3 -u myuser -l authPriv -a SHA -A authpassphrase -x AES -X privpassphrase localhost .1.3.6.1.4.1.2021.2 ``</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>Any additional requirements or changes discovered during the
implementation phase.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>Tool is optional component of FreeIPA and it could be enabled with
–setup-snmp parameter in install script (ipa-server-install). If master
server is installed with –setup-snmp parameter then tool will be
enabled on all replicas. Enabled services in Directory Server on FreeIPA
master server will be checked during replica installation. If entry for
SNMP service will be present, then tool will be enabled.</p>
</section>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>All command line possibilities can be accesible via web browser FreeIPA
interface.</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>Command to gain information could be something like ipa replica-status .
Command will use a net-snmp client, which sends a request to all agents
and client waits for replies. If filter is specified then only status of
specified services or status of specified replicas will be printed.</p>
<p>Client needs to know names of all replicas in FreeIPA infrastructure.
This names should be get from directory server. Entries of connected
replicas are stored in cn=master,cn=ipa,cn=etc,dc= subtree, for example
cn=master,cn=ipa,cn=etc,dc=.</p>
<p>Command should accept timeout argument like –timeout=10, by default
should be used some value, for example 10 seconds.</p>
<p>Filter for replicas should be –replica=name1 –replica=name2. Filter
for services should be –service=name1 –service=name2.</p>
<p>Client will use net-snmp-utils commands, especially snmpwalk to get data
from SNMP agent.</p>
</section>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>net-snmp and net-snmp-utils packages will be needed</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="design-page-authors">
<span id="id2"></span><h1>Design page authors<a class="headerlink" href="#design-page-authors" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="User:Dspurek">Dspurek</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Tool_to_Check_Status_of_All_Replicas.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>