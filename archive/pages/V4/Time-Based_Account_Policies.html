<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Tool_to_Check_Status_of_All_Replicas.html" />
    <link rel="prev" title="Overview" href="Support_of_UPN_for_trusted_domains.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>FreeIPA is currently missing any temporal settings in the HBAC rules.
However, handling access to a host in repeating time periods might be a
desirable feature. The administrator of a certain environment should be
able to set the time a host should be accessed in either the host local
time, a certain time zone time or in UTC. Host-local-time policies would
allow to adapt the time a host can be accessed to the host’s movement
along different time zones. A time bound to a certain time zone is more
transparent than local time as it doesn’t change with the host
travelling. Sometimes, it may also be appropriate to set time in UTC.
This is rather strict setting that does not reflect daylight saving
time.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>A host or service should only be accessed at certain times given by a
certain time zone. This access is repeated in a way, such as three times
a week the same time every other month.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>The time based account policies are an extension mostly to the current
HBAC rule plugin. As the time rules may find use somewhere else in the
system (Sudo rules, for example), they should be designed with that in
mind.</p>
<section id="time-scenarios">
<span id="id1"></span><h2>Time Scenarios<a class="headerlink" href="#time-scenarios" title="Permalink to this heading">¶</a></h2>
<p>This extension is based on the <a class="reference external" href="http://tools.ietf.org/html/rfc5545">iCalendar
format</a>. It therefore understands
time in three different views. These are: host local time, time at a
certain time zone, and UTC.</p>
<section id="host-local-time">
<span id="id2"></span><h3>Host Local Time<a class="headerlink" href="#host-local-time" title="Permalink to this heading">¶</a></h3>
<p>Host local time approach is meant for those hosts that are most likely
to be found across different time zones and for some reason it’s
important that the time they can be accessed reflects their current
position. This helps creating only a single HBAC rule instead of
multiple when only time zone or UTC rules would apply. The time of a
host is counted using the <code class="docutils literal notranslate"><span class="pre">/etc/localtime</span></code> information of the certain
host. Testing such a rule (in HBAC Test) requires the tester to specify
a certain time zone the rule would be tested against. It’s important to
note that this type of policy may bring some unexpected behavior as host
may appear in different time zones, or in case of a hostgroup there
could be hosts from multiple different time zones, and administrator
should be very sure they want to use this.</p>
</section>
<section id="time-zones">
<span id="id3"></span><h3>Time Zones<a class="headerlink" href="#time-zones" title="Permalink to this heading">¶</a></h3>
<p>In this approach, the time is thought of as of a time at a certain time
zone. This might be appropriate when the time settings should reflect a
certain time zone, e.g. the host or the users connecting to it are to be
found in that certain time zone. The time conversion between host and
user time zones is calculated by the <em>libical</em> library. Daylight saving
time is taken into account.</p>
</section>
<section id="utc">
<h3>UTC<a class="headerlink" href="#utc" title="Permalink to this heading">¶</a></h3>
<p>Sometimes the rules should apply for a certain time that is the same for
the whole globe throughout the year. That’s why UTC is also supported.</p>
</section>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<section id="time-policies-storage">
<span id="id4"></span><h2>Time Policies Storage<a class="headerlink" href="#time-policies-storage" title="Permalink to this heading">¶</a></h2>
<p>It should be possible to create time rule objects so that the same time
rule could be referenced by other LDAP objects (at least by HBAC Rule
objects for a start). Therefore, a new container for these objects with
its own permissions should be created. The default permissions to access
this container should be set to the administrators of the objects that
will have access to the time rules.</p>
<p>The time rule object is a simple object with <em>cn</em>, <em>description</em>,
<em>accesstime</em> and <em>memberof</em> attributes. In <em>cn</em>, the name of the object
is stored, the <strong>single-valued</strong> <em>accesstime</em> stores the iCalendar
string that describes the time periods the rule applies to, and
<em>memberof</em> is the common attribute for handling n &lt;-&gt; n relationships.</p>
<p>The change to the schema looks like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.37 NAME 'ipaTimeRule' SUP top STRUCTURAL MUST ( cn $ accessTime ) MAY ( memberOf $ description ) X-ORIGIN 'IPA v4.4')</span></code></p>
<p>Also, there need to be changes to the directory structure:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn: cn=timerules,$SUFFIX</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">changetype: add</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: top</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: nsContainer</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cn: timerules</span></code></div>
</div>
</section>
<section id="hbac-rule-ldap-object-changes">
<span id="id5"></span><h2>HBAC Rule LDAP object changes<a class="headerlink" href="#hbac-rule-ldap-object-changes" title="Permalink to this heading">¶</a></h2>
<p>There is a slight change to how HBAC rules are stored. To be able to
handle backward compatibility more easily, a new object called
<em>ipaHBACRulev2</em> is introduced. This object has the same attributes as
the old <em>ipaHBACRule</em> object with the addition of a <em>memberTimeRule</em>
attribute. The creation of <em>ipaHBACRulev2</em> should be helpful for
additional changes to the HBAC rule LDAP object in near future (e.g.
<a class="reference external" href="http://www.freeipa.org/page/V4/URI-based_HBAC">http://www.freeipa.org/page/V4/URI-based_HBAC</a>). It will also cause that
the <strong>older clients won’t list these new objects</strong> as HBAC rules which
means these rules automatically don’t apply for these older clients.</p>
<p>Upon addition of a time rule to an HBAC rule, the HBAC rule’s
<em>objectClass</em> switches to the new <em>ipaHBACRulev2</em>, when there are no
time rules present it switches back.</p>
<p>The new schema for the new HBAC Rule type:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.76 NAME 'ipaMemberTimeRule' DESC 'Reference to a time rule describing some period of time' SUP distinguishedName EQUALITY distinguishedNameMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.12 X-ORIGIN 'IPA v4.4' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.38 NAME 'ipaHBACRuleV2' SUP ipaAssociation STRUCTURAL MAY ( serviceCategory $ memberService $ externalHost  $ ipaMemberTimeRule ) X-ORIGIN 'IPA v4.4' )</span></code></div>
</div>
</section>
<section id="icalendar-strings-restrictions">
<span id="id6"></span><h2>iCalendar strings restrictions<a class="headerlink" href="#icalendar-strings-restrictions" title="Permalink to this heading">¶</a></h2>
<p>The iCalendar standard format is very rich in features and allows
extensibility. As such, the available parsers (<em>python-icalendar</em>,
<em>libical</em>) don’t do much of a strict parsing and it seems neither sane
nor advisable to try and introduce strict parsing for any iCalendar
string in FreeIPA/SSSD.</p>
<p>Instead of controlling the whole string, the server-side should do
strict parsing of at least the <em>VCALENDAR</em> and <em>VEVENT</em> iCalendar
components for the input iCalendar files, ignoring format correctness of
the rest. The client side should just obtain the <em>VEVENT</em> components
from a received iCalendar string, get values of the properties required
for proper evaluation and check whether these meet the requirements for
correct evaluation.</p>
<p>Furthermore, for the <strong>first version</strong>, we make additional restrictions.
The iCalendar strings stored on server side should strictly only contain
<strong>one</strong> <em>VEVENT</em> component in the root <em>VCALENDAR</em> component. The <strong>only
supported properties</strong> of this <em>VEVENT</em> component are:</p>
<ul class="simple">
<li><p><em>DTSTART</em></p></li>
<li><p><em>DTEND</em></p></li>
<li><p><em>DURATION</em></p></li>
<li><p><em>RDATE</em></p></li>
<li><p><em>RRULE</em></p></li>
</ul>
<p>These restrictions exist for the feasibility of setting the certain time
policies from either CLI or WebUI.</p>
</section>
<section id="server-side">
<h2>Server side<a class="headerlink" href="#server-side" title="Permalink to this heading">¶</a></h2>
<p>The server side should be able to receive iCalendar files and strings
and validate them according to the above restrictions. It should also
give means to generating iCalendar strings based on user input from the
CLI and WebUI. This should be performed using the options at addition
and modification commands.</p>
<p><strong>New dependency:</strong> <em>python-icalendar</em> will be used for parsing and
creating the iCalendar strings.</p>
</section>
<section id="sssd-side">
<span id="id7"></span><h2>SSSD side<a class="headerlink" href="#sssd-side" title="Permalink to this heading">¶</a></h2>
<p>SSSD will be enforcing the time rules. To do that, it will need to
handle parsing the iCalendar strings - <em>libical</em> C library is used for
that. SSSD evaluator should go through the <em>VEVENT</em> components and check
if the current time falls into the time span defined by these
<em>VEVENT</em>s.</p>
<p>For the <strong>first version</strong> only systems that offer means for
non-complicated programmable current time zone retrieval will be
supported. This means Red Hat and Debian based systems.</p>
<p><strong>New dependency:</strong> <em>libical</em> library will be used to handle parsing of
the iCalendar strings. It will also be used to generate recurrence of
<em>RRULE</em> property of iCalendar strings to help evaluate the comparison
against the current time.</p>
</section>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<p>There are multiple ways how to associate an iCalendar string with a time
rule object:</p>
<ol class="arabic simple">
<li><p>Use options of the addition/modification commands (preferred way)</p></li>
<li><p>Add it using an escaped iCalendar string</p></li>
<li><p>Use a file generated by an external tool</p></li>
</ol>
<p>The time rules should also offer a way to test whether they apply for a
given time similarly to what <em>hbactest</em> module does. The <em>hbactest</em>
module should also be extended to allow testing whether an HBAC rule
applies at a given time.</p>
<p>These possibilities should be reflected both in the WebUI and CLI.</p>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>A new page will need to be created for listing and creation of time rule
objects. The creation page should allow creation/modification of a time
rule using the parameters of the according addition/modification
commands. It should also allow upload of an iCalendar file or direct
iCalendar string addition. For the modification of the <em>RRULE</em> iCalendar
property some code of this 3rd party solution might be helpful:
<a class="reference external" href="http://jkbrzt.github.io/rrule/">http://jkbrzt.github.io/rrule/</a>.</p>
<p>The WebUI should show warning of some kind when modifying a time rule
that belongs to one or more HBAC rules.</p>
<p>The UI of HBAC rules needs changing as well. It should now include a new
section for addition of time rules, similar to the user, host and
service sections. User should be able to add more time policies for an
HBAC rule by the name of the policy.</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>CLI will need to introduce new commands for the addition of the time
rules as well as adding these newly created rules to HBAC rules.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Options</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>timerule-add</p></td>
<td><p>NAME [ –icalfile=file.ics |
–time=escaped_icalstring | OPTS ]</p></td>
</tr>
<tr class="row-odd"><td><p>timerule-mod</p></td>
<td><p>NAME [ –icalfile=file.ics |
–time=escaped_icalstring | OPTS ]</p></td>
</tr>
<tr class="row-even"><td><p>timerule-del</p></td>
<td><p>NAME</p></td>
</tr>
<tr class="row-odd"><td><p>timerule-show</p></td>
<td><p>NAME</p></td>
</tr>
<tr class="row-even"><td><p>timerule-find</p></td>
<td><p>[NAME]</p></td>
</tr>
<tr class="row-odd"><td><p>timerule-test</p></td>
<td><p>–time=DTIME</p></td>
</tr>
<tr class="row-even"><td><p>hbacrule-add-timerule</p></td>
<td><p>NAME –timerule=RULE_NAME</p></td>
</tr>
<tr class="row-odd"><td><p>hbacrule-remove-timerule</p></td>
<td><p>NAME –timerule=RULE_NAME</p></td>
</tr>
<tr class="row-even"><td><p>hbactest</p></td>
<td><p>–time=DTIME</p></td>
</tr>
</tbody>
</table>
<p>where
<code class="docutils literal notranslate"><span class="pre">OPTS</span> <span class="pre">=</span> <span class="pre">[--</span></code><code class="docutils literal notranslate"><span class="pre">`start</span></code> &lt;<a class="reference external" href="https://tools.ietf.org/html/rfc5545#section-3.8.2.4">https://tools.ietf.org/html/rfc5545#section-3.8.2.4</a>&gt;`__<code class="docutils literal notranslate"><span class="pre">=TIME]</span> <span class="pre">[--</span></code><code class="docutils literal notranslate"><span class="pre">`end</span></code> &lt;<a class="reference external" href="https://tools.ietf.org/html/rfc5545#section-3.8.2.2">https://tools.ietf.org/html/rfc5545#section-3.8.2.2</a>&gt;`__<code class="docutils literal notranslate"><span class="pre">=TIME]</span> <span class="pre">|</span> <span class="pre">--</span></code><code class="docutils literal notranslate"><span class="pre">`duration</span></code> &lt;<a class="reference external" href="https://tools.ietf.org/html/rfc5545#section-3.8.2.5">https://tools.ietf.org/html/rfc5545#section-3.8.2.5</a>&gt;`__<code class="docutils literal notranslate"><span class="pre">=DUR]</span> <span class="pre">[--</span></code><code class="docutils literal notranslate"><span class="pre">`dates</span></code> &lt;<a class="reference external" href="https://tools.ietf.org/html/rfc5545#section-3.8.5.2">https://tools.ietf.org/html/rfc5545#section-3.8.5.2</a>&gt;`__<code class="docutils literal notranslate"><span class="pre">=DTLIST]</span> <span class="pre">[--</span></code><code class="docutils literal notranslate"><span class="pre">`rrule</span></code> &lt;<a class="reference external" href="https://tools.ietf.org/html/rfc5545#section-3.8.5.3">https://tools.ietf.org/html/rfc5545#section-3.8.5.3</a>&gt;`__<code class="docutils literal notranslate"><span class="pre">=RRULE]</span></code>.
<code class="docutils literal notranslate"><span class="pre">TIME</span></code>, <code class="docutils literal notranslate"><span class="pre">DUR</span></code>, <code class="docutils literal notranslate"><span class="pre">DTLIST</span></code>, <code class="docutils literal notranslate"><span class="pre">RRULE</span></code> should be values formatted
according to <a class="reference external" href="http://tools.ietf.org/html/rfc5545">RFC5545</a> for the
given iCalendar components. The RFC5545 value type (e.g.
<code class="docutils literal notranslate"><span class="pre">DATE,</span> <span class="pre">DATE-TIME</span></code>) is recognized automatically from the value format.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DTIME</span></code> values are formatted as the
<a class="reference external" href="https://tools.ietf.org/html/rfc5545#section-3.3.5">DATE-TIME</a> value
data type.</p>
<p>As one can see from the table the addition/modification commands take
one of <em>icalfile</em>, <em>time</em> or combination of iCalendar creation options.</p>
<p><em>timerule-mod</em> and <em>timerule-show</em> should display all the HBAC rules
that are using them so that the user directly sees the impact of their
actions.</p>
<p><em>timerule-del</em> should prevent deletion of a time rule should this time
rule be used in any HBAC rule to prevent security issues.</p>
<p><em>hbactest</em> command should be extended with a compulsory option <em>–time</em>.</p>
</section>
</section>
<section id="how-to-use">
<h1>How to Use<a class="headerlink" href="#how-to-use" title="Permalink to this heading">¶</a></h1>
<ol class="arabic simple">
<li><p>A user creates a time rule depending on what they have available</p>
<ul class="simple">
<li><p>iCalfile:
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">timerule-add</span> <span class="pre">someday</span> <span class="pre">--icalfile=myical05052016.ics</span></code></p></li>
<li><p>iCalstring:
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">timerule-add</span> <span class="pre">someday</span> <span class="pre">--time=&quot;BEGIN:VCALENDAR\nPRODID:Internet</span> <span class="pre">iCal</span> <span class="pre">generator\nVERSION:2.0\nMETHOD:REQUEST\nBEGIN:VEVENT\nDTSTAMP:20160406T112129Z\nDTSTART;VALUE=DATE:20160505\nUID:1&#64;darkside.com\nEND:VEVENT\nEND:VCALENDAR&quot;</span></code></p></li>
<li><p>Using options: <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">timerule-add</span> <span class="pre">someday</span> <span class="pre">--start=20160505</span></code></p></li>
</ul>
</li>
<li><p>Then, <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">hbacrule-add</span> <span class="pre">newRule</span> <span class="pre">SOMEOPTIONS</span></code> for standard HBAC Rule
creation.</p></li>
<li><p>Add the newly created time rule to the HBAC rule:
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">hbacrule-add-timerule</span> <span class="pre">newRule</span> <span class="pre">--timerule=someday</span></code></p></li>
<li><p>From now on, the hosts/services are only accessible at the time
described by the iCalendar string in <em>someday</em> time rule.</p></li>
</ol>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Time-Based_Account_Policies.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>