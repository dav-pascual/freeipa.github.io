<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Password_Vault_1.1.html" />
    <link rel="prev" title="Design" href="Password_Vault.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Password Vault 1.0 provides the initial implementation of <a class="reference external" href="V4/Password_Vault/Design">Password
Vault</a>.</p>
<section id="secret">
<h2>Secret<a class="headerlink" href="#secret" title="Permalink to this heading">¶</a></h2>
<p>Secret is an information that should only be known by a limited number
of people. IPA provides a mechanism to archive, retrieve, share, and
recover secrets, and manage the access control. The secret itself will
actually be stored securely in the KRA backend.</p>
<p>A secret is a binary data, so anything can be stored as a secret (e.g.
password, PIN, private key), but there will be a limit imposed by the
server. A secret ID is a unique name to identify a secret within a
vault.</p>
<p>During archival, the client will generate a random session key and use
it to encrypt the secret, then send both the encrypted secret and the
session key wrapped with KRA’s transport public key to KRA. KRA will
unwrap the session key with the transport private key, then use it to
decrypt the secret. Then KRA will encrypt the secret with the storage
key and store it in the LDAP backend.</p>
<p>During retrieval, the client will generate a random session key and send
it to the server wrapped with KRA’s transport public key. KRA will
decrypt the secret stored in the LDAP backend using the storage key,
return the secret encrypted using the session key.</p>
</section>
<section id="vault">
<h2>Vault<a class="headerlink" href="#vault" title="Permalink to this heading">¶</a></h2>
<p>Vault is a secure place to store a secret. A vault may be privately
owned by a user, a service, or shared. A user or service may own
multiple vaults.</p>
<p>A vault is uniquely identified by its name within its container. See
<a class="reference external" href="#Container">Container</a>.</p>
<p>There are three types of vault which may offer additional level of
security:</p>
<section id="standard-vault">
<span id="id1"></span><h3>Standard Vault<a class="headerlink" href="#standard-vault" title="Permalink to this heading">¶</a></h3>
<p>A standard vault will use the KRA’s standard transport and storage
encryption as described above. Any authorized vault members, vault
owners, or escrow officers can read and write the secrets without having
to use a password/keys.</p>
</section>
<section id="symmetric-vault">
<span id="id2"></span><h3>Symmetric Vault<a class="headerlink" href="#symmetric-vault" title="Permalink to this heading">¶</a></h3>
<p>With symmetric vault the secrets are additionally protected with a
symmetric key generated from a vault password. The client will encrypt
secrets before sending them to the server and decrypt them after
receiving them from the server. Any authorized vault members, vault
owners, or escrow officers can read and write the secrets, but they will
have to use a shared vault password.</p>
</section>
<section id="asymmetric-vault">
<span id="id3"></span><h3>Asymmetric Vault<a class="headerlink" href="#asymmetric-vault" title="Permalink to this heading">¶</a></h3>
<p>With asymmetric vault (drop box) the secrets are additionally protected
with asymmetric keys. The client will archive the secrets using the
public key, and retrieve using the private key. The public key is
available to all vault members, but the private key is only available to
vault owners. This way vault members can archive secrets, but only vault
owners/escrow officers can retrieve them.</p>
</section>
</section>
<section id="container">
<h2>Container<a class="headerlink" href="#container" title="Permalink to this heading">¶</a></h2>
<p>Container is a collection of vaults. There are several built-in
containers:</p>
<ul class="simple">
<li><p>service containers</p></li>
<li><p>shared container</p></li>
<li><p>user containers</p></li>
</ul>
<p>Each user has a user container to store the user’s private vaults. The
container is created automatically when the first private vault is
created. When the user is removed, the container and its contents will
be removed automatically.</p>
<p>The shared container is used to store vaults that can be shared by
different users. Only the admins can create shared vaults.</p>
<p>Each service has a service container to store the service’s private
vaults. The container is created automatically when the first private
vault is created. When the service is removed, the container and its
contents will be removed automatically.</p>
</section>
<section id="access-control">
<span id="id4"></span><h2>Access Control<a class="headerlink" href="#access-control" title="Permalink to this heading">¶</a></h2>
<p>The vault access control list allows the following operations:</p>
<ul class="simple">
<li><p>Any user can create a private user container.</p></li>
<li><p>A container owner can manage vaults in the container.</p></li>
<li><p>A vault member can list, archive, and retrieve the secrets in a
standard vault. With symmetric vault the member will need a vault
password in order to archive and retrieve secrets. With asymmetric
vault the member can only archive the secrets but not retrieve them
since it only has the public key and not the private key.</p></li>
<li><p>A vault owner can list, archive, and retrieve the secrets like vault
members, but it has the private key so it can retrieve secrets from
asymmetric vault. The owner can also manage the list of members and
owners of the vault, and change the vault password/keys.</p></li>
<li><p>An administrator can do everything except accessing the secrets in
symmetric or asymmetric vaults and change/reset the password/keys.</p></li>
</ul>
</section>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h1>
<p>First install IPA server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa-server-install
...
</pre></div>
</div>
<p>Then install KRA component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa-kra-install
...
</pre></div>
</div>
<p>Authenticate as an IPA user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kinit testuser
Password for testuser@EXAMPLE.COM: ********
</pre></div>
</div>
<p>The vault is ready to use.</p>
</section>
<section id="vault-management">
<span id="id5"></span><h1>Vault Management<a class="headerlink" href="#vault-management" title="Permalink to this heading">¶</a></h1>
<section id="listing-accessible-vaults">
<span id="id6"></span><h2>Listing accessible vaults<a class="headerlink" href="#listing-accessible-vaults" title="Permalink to this heading">¶</a></h2>
<p>A user can search the vaults that it owns or it’s a member of using the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-find [OPTIONS]
</pre></div>
</div>
<p>By default the command will list the vaults in the private container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-find
---------------
1 entries found
---------------
  Vault name: PrivateVault
  Description: Private vault
  Type: standard
----------------------------
Number of entries returned 1
----------------------------
</pre></div>
</div>
<p>To find service vaults, specify –service :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-find --service HTTP/server.example.com
---------------
1 entries found
---------------
  Vault name: test
  Type: standard
----------------------------
Number of entries returned 1
----------------------------
</pre></div>
</div>
<p>To find shared vaults, specify -shared:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-find --shared
---------------
1 entries found
---------------
  Vault name: test
  Type: standard
----------------------------
Number of entries returned 1
----------------------------
</pre></div>
</div>
<p>To find user vaults, specify –user :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-find --user testuser
---------------
1 entries found
---------------
  Vault name: test
  Type: standard
----------------------------
Number of entries returned 1
----------------------------
</pre></div>
</div>
</section>
<section id="displaying-vault-info">
<span id="id7"></span><h2>Displaying vault info<a class="headerlink" href="#displaying-vault-info" title="Permalink to this heading">¶</a></h2>
<p>A user can view a particular vault info using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-show &lt;name&gt; [OPTIONS]
</pre></div>
</div>
<p>To display the basic vault info:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-show PrivateVault
  Vault name: PrivateVault
  Description: Private vault
  Type: standard
  Salt: ....
  Owner users: admin
</pre></div>
</div>
<p>To display the complete vault info:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-show PrivateVault --all
  dn: cn=PrivateVault,cn=admin,cn=users,cn=vaults,...
  Vault name: PrivateVault
  Description: Private vault
  Type: standard
  Salt: ....
  Owner users: admin
  objectclass: top, ipaVault
</pre></div>
</div>
</section>
<section id="creating-a-new-vault">
<span id="id8"></span><h2>Creating a new vault<a class="headerlink" href="#creating-a-new-vault" title="Permalink to this heading">¶</a></h2>
<p>A container member can create a vault using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add &lt;name&gt; [OPTIONS]
</pre></div>
</div>
<p>Private vaults can be created by specifying a relative vault ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add PrivateVault --desc &quot;Private vault&quot;
--------------------------
Added vault &quot;PrivateVault&quot;
--------------------------
  Vault name: PrivateVault
  Description: Private vault
  Type: standard
</pre></div>
</div>
<p>Shared vaults can be created by specifying –shared:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add SharedVault --desc &quot;Shared vault&quot; --shared
---------------------------------
Added vault &quot;SharedVault&quot;
---------------------------------
  Vault name: SharedVault
  Description: Shared vault
  Type: standard
</pre></div>
</div>
<p>Symmetric vaults can be created by specifying the type and the password.
The password can be provided interactively, specified in the command
option, or specified in a file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add SymmetricVault --desc &quot;Symmetric vault&quot; --type symmetric
New password: ********
Verify password: ********
----------------------------
Added vault &quot;SymmetricVault&quot;
----------------------------
  Vault name: SymmetricVault
  Description: Symmetric vault
  Type: symmetric

$ ipa vault-add SymmetricVault --desc &quot;Symmetric vault&quot; --type symmetric --password mypassword
----------------------------
Added vault &quot;SymmetricVault&quot;
----------------------------
  Vault name: SymmetricVault
  Description: Symmetric vault
  Type: symmetric

$ ipa vault-add SymmetricVault --desc &quot;Symmetric vault&quot; --type symmetric -password-file password.txt
----------------------------
Added vault &quot;SymmetricVault&quot;
----------------------------
  Vault name: SymmetricVault
  Description: Symmetric vault
  Type: symmetric
</pre></div>
</div>
<p>Asymmetric vaults can be created by specifying the type and the public
key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add AsymmetricVault --desc &quot;Asymmetric vault&quot; --type asymmetric --public-key-file public.pem
-----------------------------
Added vault &quot;AsymmetricVault&quot;
-----------------------------
  Vault name: AsymmetricVault
  Description: Asymmetric vault
  Type: asymmetric
</pre></div>
</div>
</section>
<section id="archiving-data">
<span id="id9"></span><h2>Archiving data<a class="headerlink" href="#archiving-data" title="Permalink to this heading">¶</a></h2>
<p>A vault member/owner can archive data using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive &lt;name&gt; [--in &lt;input file&gt; | --data &lt;base-64 encoded data&gt;] [OPTIONS]
</pre></div>
</div>
<p>With a standard vault the operation can be done directly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive StandardVault --data c2VjcmV0
----------------------------------------
Archived data into vault &quot;StandardVault&quot;
----------------------------------------
$ ipa vault-archive StandardVault --in secret.txt
----------------------------------------
Archived data into vault &quot;StandardVault&quot;
----------------------------------------
</pre></div>
</div>
<p>With a symmetric vault the operation requires a password:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive SymmetricVault --in secret.txt
Password: ********
-----------------------------------------
Archived data into vault &quot;SymmetricVault&quot;
-----------------------------------------
</pre></div>
</div>
<p>With an asymmetric vault the operation does not require anything since
the vault public key is stored in one of vault attributes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive AsymmetricVault --in secret.txt
------------------------------------------
Archived data into vault &quot;AsymmetricVault&quot;
------------------------------------------
</pre></div>
</div>
</section>
<section id="retrieving-data">
<span id="id10"></span><h2>Retrieving data<a class="headerlink" href="#retrieving-data" title="Permalink to this heading">¶</a></h2>
<p>A vault member/owner can be retrieve data using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve &lt;name&gt; [--out &lt;output file&gt;] [OPTIONS]
</pre></div>
</div>
<p>With a standard vault the operation can be done directly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve StandardVault --out secret.txt
-----------------------------------------
Retrieved data from vault &quot;StandardVault&quot;
-----------------------------------------
$ ipa vault-retrieve StandardVault
-----------------------------------------
Retrieved data from vault &quot;StandardVault&quot;
-----------------------------------------
    Data: c2VjcmV0
</pre></div>
</div>
<p>With a symmetric vault the operation requires a password:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve SymmetricVault --out secret.txt
Password: ********
------------------------------------------
Retrieved data from vault &quot;SymmetricVault&quot;
------------------------------------------
</pre></div>
</div>
<p>With an asymmetric vault the operation requires a private key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve AsymmetricVault --out secret.txt --private-key-file private.pem
-------------------------------------------
Retrieved data from vault &quot;AsymmetricVault&quot;
-------------------------------------------
</pre></div>
</div>
</section>
<section id="modifying-a-vault">
<span id="id11"></span><h2>Modifying a vault<a class="headerlink" href="#modifying-a-vault" title="Permalink to this heading">¶</a></h2>
<p>The vault owner can modify a vault using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod &lt;name&gt; [OPTIONS]
</pre></div>
</div>
<p>For example, to change vault description:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-show PrivateVault
  Vault name: PrivateVault
  Description: Private vault
  Type: standard

$ ipa vault-mod PrivateVault --desc &quot;This is a private vault&quot;
-----------------------------
Modified vault &quot;PrivateVault&quot;
-----------------------------
  Vault name: PrivateVault
  Description: This is a private vault
  Type: standard
</pre></div>
</div>
</section>
<section id="changing-vault-password-keys">
<span id="changing-vault-passwordkeys"></span><h2>Changing vault password/keys<a class="headerlink" href="#changing-vault-password-keys" title="Permalink to this heading">¶</a></h2>
<p>To change the password of a symmetric vault execute the following
commands (Note: In <a class="reference external" href="V4/Password_Vault_1.1">Password Vault 1.1</a> this
process will be merged into a single command):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve SymmetricVault --out secret.txt
Password: ********
------------------------------------------
Retrieved data from vault &quot;SymmetricVault&quot;
------------------------------------------

$ ipa vault-del SymmetricVault
------------------------------
Deleted vault &quot;SymmetricVault&quot;
------------------------------

$ ipa vault-add SymmetricVault --type symmetric
New Password: ********
Verify Password: ********
----------------------------
Added vault &quot;SymmetricVault&quot;
----------------------------
  Vault name: SymmetricVault
  Type: symmetric

$ ipa vault-archive SymmetricVault --in secret.txt
Password: ********
-----------------------------------------
Archived data into vault &quot;SymmetricVault&quot;
-----------------------------------------
</pre></div>
</div>
<p>To change the public/private keys of an asymmetric vault execute the
following commands (Note: In <a class="reference external" href="V4/Password_Vault_1.1">Password Vault
1.1</a> this process will be merged into a single
command):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve AsymmetricVault --out secret.txt --private-key-file private.pem
-------------------------------------------
Retrieved data from vault &quot;AsymmetricVault&quot;
-------------------------------------------

$ ipa vault-del AsymmetricVault
-------------------------------
Deleted vault &quot;AsymmetricVault&quot;
-------------------------------

$ ipa vault-add AsymmetricVault --type asymmetric --public-key-file public.pem
-----------------------------
Added vault &quot;AsymmetricVault&quot;
-----------------------------
  Vault name: AsymmetricVault
  Type: asymmetric

$ ipa vault-archive AsymmetricVault --in secret.txt
------------------------------------------
Archived data into vault &quot;AsymmetricVault&quot;
------------------------------------------
</pre></div>
</div>
</section>
<section id="removing-a-vault">
<span id="id12"></span><h2>Removing a vault<a class="headerlink" href="#removing-a-vault" title="Permalink to this heading">¶</a></h2>
<p>To remove a vault the owner can execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-del &lt;name&gt; [OPTIONS]
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-del PrivateVault
----------------------------
Deleted vault &quot;PrivateVault&quot;
----------------------------
</pre></div>
</div>
</section>
</section>
<section id="access-control-1">
<span id="id13"></span><h1>Access Control<a class="headerlink" href="#access-control-1" title="Permalink to this heading">¶</a></h1>
<section id="adding-vault-member">
<span id="id14"></span><h2>Adding vault member<a class="headerlink" href="#adding-vault-member" title="Permalink to this heading">¶</a></h2>
<p>A vault owner can add members to the vault with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add-member &lt;name&gt; [--users &lt;list of users&gt;] [--groups &lt;list of groups&gt;]
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add-member MyVault --users testmember
---------------------------------
Added members to &quot;MyVault &quot; vault
---------------------------------
</pre></div>
</div>
</section>
<section id="removing-vault-member">
<span id="id15"></span><h2>Removing vault member<a class="headerlink" href="#removing-vault-member" title="Permalink to this heading">¶</a></h2>
<p>A vault owner can remove a member from the vault with the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-remove-member &lt;name&gt; [--users &lt;list of users&gt;] [--groups &lt;list of groups&gt;]
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-remove-member MyVault --users testmember
-------------------------------------
Removed members from &quot;MyVault &quot; vault
-------------------------------------
</pre></div>
</div>
</section>
<section id="adding-vault-owner">
<span id="id16"></span><h2>Adding vault owner<a class="headerlink" href="#adding-vault-owner" title="Permalink to this heading">¶</a></h2>
<p>An owner can add another owner to the vault with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add-owner &lt;vault ID&gt; [--users &lt;list of users&gt;] [--groups &lt;list of groups&gt;]
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add-owner MyVault --users testowner
----------------------------------
Added owners from &quot;MyVault &quot; vault
----------------------------------
</pre></div>
</div>
</section>
<section id="removing-vault-owner">
<span id="id17"></span><h2>Removing vault owner<a class="headerlink" href="#removing-vault-owner" title="Permalink to this heading">¶</a></h2>
<p>An owner can remove another owner from the vault with the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-remove-owner &lt;name&gt; [--users &lt;list of users&gt;] [--groups &lt;list of groups&gt;]
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-remove-owner MyVault --users testowner
------------------------------------
Removed owners from &quot;MyVault &quot; vault
------------------------------------
</pre></div>
</div>
</section>
</section>
<section id="service-operations">
<span id="id18"></span><h1>Service Operations<a class="headerlink" href="#service-operations" title="Permalink to this heading">¶</a></h1>
<section id="creating-service-vault-password">
<span id="id19"></span><h2>Creating service vault password<a class="headerlink" href="#creating-service-vault-password" title="Permalink to this heading">¶</a></h2>
<p>A service administrator can create a service vault password by archiving
a new secret into a private vault:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add http_password
---------------------------
Added vault &quot;http_password&quot;
---------------------------
  Vault name: http_password
  Type: standard
  Owner users: admin

$ ipa vault-archive http_password --in secret.txt
----------------------------------------
Archived data into vault &quot;http_password&quot;
----------------------------------------
</pre></div>
</div>
</section>
<section id="provisioning-service-vault-password-for-service-instance">
<span id="id20"></span><h2>Provisioning service vault password for service instance<a class="headerlink" href="#provisioning-service-vault-password-for-service-instance" title="Permalink to this heading">¶</a></h2>
<p>A service administrator can provision the service vault password to a
specific service instance using a service vault. To create a service
vault, obtain the service public key, then execute the following command
(<strong>Note:</strong> In the future the service public key will be retrieved
automatically):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add &lt;service vault name&gt; --service &lt;service name&gt; --type asymmetric --public-key &lt;service public key&gt;
</pre></div>
</div>
<p>To copy the service vault password from the service administrator’s
private vault into the service vault execute the following commands
(<strong>Note:</strong> In <a class="reference external" href="Password_Vault_1.1">Password Vault 1.1</a> this will be
merged into a single command):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve &lt;private vault name&gt; --out secret.txt
$ ipa vault-archive &lt;service vault name&gt; --service &lt;service name&gt; --in secret.txt
</pre></div>
</div>
<p>The commands will retrieve the service vault password already archived
earlier, then encrypt it with the service instance’s public key. The
public key will be obtained from the service certificate that’s already
generated previously on the server.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add password --service HTTP/server.example.com --type asymmetric --public-key-file service-public.pem
---------------------
Added vault &quot;password&quot;
---------------------
  Vault name: password
  Type: asymmetric
  Public key: ...
  Owner users: admin

$ ipa vault-retrieve http_password --out secret.txt
-----------------------------------------
Retrieved data from vault &quot;http_password&quot;
-----------------------------------------

$ ipa vault-archive password --service HTTP/server.example.com --in secret.txt
-----------------------------------
Archived data into vault &quot;password&quot;
-----------------------------------
</pre></div>
</div>
</section>
<section id="retrieving-service-vault-password-for-service-instance">
<span id="id21"></span><h2>Retrieving service vault password for service instance<a class="headerlink" href="#retrieving-service-vault-password-for-service-instance" title="Permalink to this heading">¶</a></h2>
<p>A service instance can retrieve the service vault password using the
service private key stored locally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kinit HTTP/server.example.com -k -t /etc/httpd/conf/ipa.keytab

$ ipa vault-retrieve password --service HTTP/server.example.com --private-key-file service-private.pem --out secret.txt
------------------------------------
Retrieved data from vault &quot;password&quot;
------------------------------------
</pre></div>
</div>
</section>
<section id="changing-service-vault-password">
<span id="id22"></span><h2>Changing service vault password<a class="headerlink" href="#changing-service-vault-password" title="Permalink to this heading">¶</a></h2>
<p>The service administrator can change the service vault password by
archiving a new secret:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive http_password --in new_secret.txt
----------------------------------------
Archived data into vault &quot;http_password&quot;
----------------------------------------
</pre></div>
</div>
<p>The service administrator will need to re-provision the new service
vault password to each service instance using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve http_password --out secret.txt
-----------------------------------------
Retrieved data from vault &quot;http_password&quot;
-----------------------------------------

$ ipa vault-archive password --service HTTP/server.example.com --in secret.txt
-----------------------------------
Archived data into vault &quot;password&quot;
-----------------------------------
</pre></div>
</div>
<p>This way if there’s a compromised instance the service administrator can
isolate it by changing the service vault password and re-provisioning it
to non-compromised instances only.</p>
</section>
</section>
<section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h1>
<p>The following command can be used to display vault configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vaultconfig-show
  Transport Certificate: -----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----
</pre></div>
</div>
</section>
<section id="ldap-directory">
<span id="id23"></span><h1>LDAP Directory<a class="headerlink" href="#ldap-directory" title="Permalink to this heading">¶</a></h1>
<section id="directory-structure">
<span id="id24"></span><h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this heading">¶</a></h2>
<p>The containers and vaults are represented as LDAP entries in a subtree
in the IPA directory. The root container is represented by the root
entry of the subtree. Sub-containers are represented by entries directly
under the parent container. Vaults are represented by entries stored
under the container.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">suffix</span><span class="o">&gt;</span>
<span class="o">+</span> <span class="n">cn</span><span class="o">=</span><span class="n">kra</span>
   <span class="o">+</span> <span class="n">cn</span><span class="o">=</span><span class="n">vaults</span>
      <span class="o">+</span> <span class="n">cn</span><span class="o">=</span><span class="n">users</span>
         <span class="o">+</span> <span class="n">cn</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span>
            <span class="o">+</span> <span class="n">cn</span><span class="o">=&lt;</span><span class="n">user</span> <span class="n">vault</span> <span class="n">name</span><span class="o">&gt;</span>
            <span class="o">+</span> <span class="o">...</span>
      <span class="o">+</span> <span class="n">cn</span><span class="o">=</span><span class="n">shared</span>
         <span class="o">+</span> <span class="n">cn</span><span class="o">=&lt;</span><span class="n">shared</span> <span class="n">vault</span> <span class="n">name</span><span class="o">&gt;</span>
         <span class="o">+</span> <span class="o">...</span>
      <span class="o">+</span> <span class="n">cn</span><span class="o">=</span><span class="n">services</span>
         <span class="o">+</span> <span class="n">cn</span><span class="o">=&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;</span>
             <span class="o">+</span> <span class="n">cn</span><span class="o">=&lt;</span><span class="n">service</span> <span class="n">vault</span> <span class="n">name</span><span class="o">&gt;</span>
             <span class="o">+</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this heading">¶</a></h2>
<p>Vault schema is defined in install/share/60basev3.ldif.</p>
<p>Attribute types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.18.2.1</span> <span class="n">NAME</span> <span class="s1">&#39;ipaVaultType&#39;</span> <span class="n">DESC</span> <span class="s1">&#39;IPA vault type&#39;</span> <span class="n">EQUALITY</span> <span class="n">caseExactMatch</span> <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.15</span> <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v4.2&#39;</span><span class="p">)</span>
<span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.18.2.2</span> <span class="n">NAME</span> <span class="s1">&#39;ipaVaultSalt&#39;</span> <span class="n">DESC</span> <span class="s1">&#39;IPA vault salt&#39;</span> <span class="n">EQUALITY</span> <span class="n">octetStringMatch</span> <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.40</span> <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v4.2&#39;</span> <span class="p">)</span>
<span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.18.2.3</span> <span class="n">NAME</span> <span class="s1">&#39;ipaVaultPublicKey&#39;</span> <span class="n">DESC</span> <span class="s1">&#39;IPA vault public key&#39;</span> <span class="n">SUP</span> <span class="n">ipaPublicKey</span> <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v4.2&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>Object classes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>objectClasses: (2.16.840.1.113730.3.8.18.1.1 NAME &#39;ipaVault&#39; DESC &#39;IPA vault&#39; SUP top STRUCTURAL MUST ( cn ) MAY ( description $ ipaVaultType $ ipaVaultSalt $ ipaVaultPublicKey $ owner $ member ) X-ORIGIN &#39;IPA v4.2&#39; )
objectClasses: (2.16.840.1.113730.3.8.18.1.2 NAME &#39;ipaVaultContainer&#39; DESC &#39;IPA vault container&#39; SUP top STRUCTURAL MUST ( cn ) MAY ( description $ owner ) X-ORIGIN &#39;IPA v4.2&#39; )
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.freeipa.org/page/V4/PKCS11_in_LDAP/Schema">LDAP schema for PKCS#11
data</a>.</p>
</section>
<section id="access-control-list">
<span id="id25"></span><h2>Access Control List<a class="headerlink" href="#access-control-list" title="Permalink to this heading">¶</a></h2>
<p>The LDAP ACI attributes are used to control the access to the LDAP
entries representing the vaults and the containers. The secrets
themselves are stored in KRA and accessed by IPA as KRA agent on behalf
of IPA users. The IPA user’s access to the secrets will be determined by
IPA framework based on the user’s membership or ownership of the vaults
and containers, not by LDAP ACI.</p>
<p>The ACI attributes are defined in the root entry of the vault subtree in
install/share/vault.update:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dn: cn=kra,$SUFFIX
...

dn: cn=vaults,cn=kra,$SUFFIX
...

################################################################################
# Vault Container ACLs
################################################################################
aci: (target=&quot;ldap:///cn=*,cn=users,cn=vaults,&lt;suffix&gt;&quot;)
  (version 3.0; acl &quot;Allow users to create private container&quot;;
   allow (add) userdn = &quot;ldap:///uid=($attr.cn),cn=users,cn=accounts,$SUFFIX&quot;;)

################################################################################
# Vault ACLs
################################################################################
aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Container owners can manage vaults in the container&quot;;
   allow(read, search, compare, add, delete) userattr=&quot;parent[1].owner#USERDN&quot;;)
aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Indirect container owners can manage vaults in the container&quot;;
   allow(read, search, compare, add, delete) userattr=&quot;parent[1].owner#GROUPDN&quot;;)

aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Vault members can access the vault&quot;;
   allow(read, search, compare) userattr=&quot;member#USERDN&quot;;)
aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Indirect vault members can access the vault&quot;;
   allow(read, search, compare) userattr=&quot;member#GROUPDN&quot;;)

aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Vault owners can manage the vault&quot;;
   allow(read, search, compare, write) userattr=&quot;owner#USERDN&quot;;)
aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Indirect vault owners can manage the vault&quot;;
   allow(read, search, compare, write) userattr=&quot;owner#GROUPDN&quot;;)
</pre></div>
</div>
</section>
</section>
<section id="demo">
<h1>Demo<a class="headerlink" href="#demo" title="Permalink to this heading">¶</a></h1>
<p>See <a class="reference external" href="http://pki.fedoraproject.org/wiki/IPA_Password_Vault_1.0">Demo</a>.</p>
</section>
<section id="status">
<h1>Status<a class="headerlink" href="#status" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Fixed KRA backend
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=0b08043c37210d0f86cb0c66d659acafda0fb529">pushed</a>).</p></li>
<li><p>Modified NSSConnection not to shutdown existing database
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=80a8df3f193aa800740f1627a269e6973f57aa0a">pushed</a>).</p></li>
<li><p>Added vault plugin
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=fde21adcbd62b9a300740d9ba237ca9e89a905e4">pushed</a>).
This implements section 3.1, 3.2, 3.3, 3.6, 3.7.</p></li>
<li><p>Added vault archive and vault retrieve commands
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=df1bd39a43f30138cf55e0e7720fa3dec1d912e0">pushed</a>).
This implements section 3.4, 3.5, and 5.</p></li>
<li><p>Moved vaults to cn=vaults,cn=kra
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=81729e22d35c5313e85081b6b3e8658b3d542af1">pushed</a>).</p></li>
<li><p>Fixed ipa-kra-install
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=e7ac57e1390c76c3d7fdb2710808def107d21d6d">pushed</a>).</p></li>
<li><p>Added symmetric and asymmetric vaults
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=fc5c614950dd39c7d002377f810f37ef36b0e8a4">pushed</a>).
This implements section 1.2.2 and 1.2.3 and adds python-cryptography
dependency.</p></li>
<li><p>Added ipaVaultPublicKey attribute.
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=475ade4becd4cdb59a9bcf0da7de1d2739e293c8">pushed</a>).</p></li>
<li><p>Added vault access control.
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/commit/?id=bf6df3df9b388753a52a0040d9c15b1eabce41ca">pushed</a>).
This implements section 4.</p></li>
</ul>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="http://www.freeipa.org/page/V4/Password_Vault/Test_Plan">Test
Plan</a></p></li>
</ul>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="V4/Password_Vault">Password Vault</a></p></li>
<li><p><a class="reference external" href="http://pki.fedoraproject.org/wiki/IPA_KRA_Agent_Setup">IPA KRA Agent
Setup</a></p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Password_Vault_1.0.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>