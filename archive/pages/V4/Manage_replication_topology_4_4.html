<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Managed_Read_permissions.html" />
    <link rel="prev" title="hostname attribute in config" href="Manage_replication_topology.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Centralized topology management was one of the main features of <a class="reference external" href="Releases/4.3.0">4.3.0
release</a>. Management of topology is working but user
experience is not at a desired level. This document covers missing parts
of topology management to be implemented in 4.4 release.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>Same as in <a class="reference external" href="V4/Manage_replication_topology">original design</a>.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>Extends <a class="reference external" href="V4/Manage_replication_topology">original design</a>. Main
topics are:</p>
<ul class="simple">
<li><p>improvement of Web UI topology graph to be usable with bigger number
of IPA servers</p></li>
<li><p>continue with deprecating of <code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span></code> and
<code class="docutils literal notranslate"><span class="pre">ipa-csreplica-manage</span></code> for day to day topology management. The
direction was discussed in freeipa-devel thread <a class="reference external" href="https://www.redhat.com/archives/freeipa-devel/2015-October/msg00454.html">Fate of
ipa-replica-manage and ipa-csreplica-manage
tools</a>.</p></li>
</ul>
<section id="ipa-cs-replica-manange-changes">
<span id="ipacsreplica-manange-changes"></span><h2>ipa(cs)replica manange changes<a class="headerlink" href="#ipa-cs-replica-manange-changes" title="Permalink to this heading">¶</a></h2>
<p>The long term plan is to completely deprecate <code class="docutils literal notranslate"><span class="pre">ipa-csreplica-manage</span></code>
tool. <code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span></code> will be used only for management of winsync
agreements, assuming domain level 1.</p>
</section>
<section id="ipa-csreplica-manage">
<span id="id1"></span><h2>ipa-csreplica-manage<a class="headerlink" href="#ipa-csreplica-manage" title="Permalink to this heading">¶</a></h2>
<p>The only remaining goal before depracation is to transform
<code class="docutils literal notranslate"><span class="pre">set-renewal-master</span></code> into an API command. It will be done according to
<a class="reference external" href="V4/Server_Roles">server roles design page</a>. <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5689">ticket
#5689</a></p>
</section>
<section id="ipa-replica-manage">
<span id="id2"></span><h2>ipa-replica-manage<a class="headerlink" href="#ipa-replica-manage" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">del</span></code>: FreeIPA 4.3 changes allows to transform <code class="docutils literal notranslate"><span class="pre">del</span></code> command into an
API method: <code class="docutils literal notranslate"><span class="pre">server_del</span></code>.
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5588">#5588</a>.
<code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span></code> should call this API method on domain level 1 for
backwards compatibility. This new API command should be then used in
<code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code>, more details below.</p>
<p><code class="docutils literal notranslate"><span class="pre">clean-dangling-ruvs</span></code>: description at <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5411#comment:7">ticket
#5411</a></p>
<p><code class="docutils literal notranslate"><span class="pre">list-ruv/clean-ruv</span></code>: extend the commands’ default behavior so that
they search both ca and domain trees to list/clean from them. <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/4987">ticket
#4987</a>. It is to
support the new <code class="docutils literal notranslate"><span class="pre">clean-dangling-ruvs</span></code> subcommand.</p>
<p><code class="docutils literal notranslate"><span class="pre">abort-clean-ruv</span></code>: Should work with both suffixes. It should
find/check existence of the task first and then abort it. It should make
use of the proposed `replica-force-cleaning: yes` <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5396">ticket
#5396</a> so that it won’t
hang if a replica is shut down.</p>
<p>Non goals in FreeIPA 4.4 release:</p>
<ul class="simple">
<li><p>move DNA ranges management to API</p></li>
<li><p>modify re-initialize and force-sync commands of both tools.</p></li>
</ul>
</section>
<section id="server-del">
<h2><code class="docutils literal notranslate"><span class="pre">server_del</span></code><a class="headerlink" href="#server-del" title="Permalink to this heading">¶</a></h2>
<p>New API method, will do the same as current <code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span></code>
on domain level 1. It will work only with domain level 1 because domain
level 0 requires also to connect to other servers.</p>
<p>Arguments and options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">server</span></code> - argument, server to be deleted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--force</span></code> - should be allowed to call the method even if it was
already removed. Should perform cleaning tasks. If server was not
deleted, <code class="docutils literal notranslate"><span class="pre">--force</span></code> doesn’t have any additional meaning. This will
be a simplification of <code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span> <span class="pre">--force</span> <span class="pre">--clean</span></code> The
difference is that <code class="docutils literal notranslate"><span class="pre">--force</span></code> won’t skip topology disconnection
check and last services check.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ignore-topology-disconnect</span></code> Will skip topology disconnection
check.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ignore-last-services</span></code> Will skip last services check.</p></li>
</ul>
</section>
<section id="uninstallation">
<h2>uninstallation<a class="headerlink" href="#uninstallation" title="Permalink to this heading">¶</a></h2>
<p>In the past uninstallation was 2-3 step process:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ipa-csreplica-manage</span> <span class="pre">del</span></code> (applicable only if the deleted master
has CA)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code></p></li>
</ol>
<p>Centralized topology management and changes done in
<code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span></code> in FreeIPA 4.3 allows to skip step 1. From
personal experience and post on FreeIPA users list step 1 and 2 are
often forgotten. Fortunately centralized topology management allows to
move <code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span></code> into an API command. It allows to use it
from <code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code>. I.e. the uninstallation process
can be simplified into a single command:
<code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code></p>
<p>Proposal: <code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code> should connect to API of
different master with host credential and call <code class="docutils literal notranslate"><span class="pre">server-del</span></code> command.
It should be done after initial validation. <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5588">ticket
#5588</a>. The reason is
that replica cleanup method removes DNS records and server keytabs.
Doing it on the to-be uninstalled server would be racy - some of the
changes wouldn’t be replicated.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>Move of <code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span></code> to API command requires little
refactoring - ipa-replica-manage prints to output directly but IPA
method doesn’t do it. Additional change is to adjust ACIs and cleanup
method so that <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">server-del</span></code> can be called with host credentials.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<section id="topology-graph">
<span id="id3"></span><h3>Topology graph<a class="headerlink" href="#topology-graph" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="V4/Manage_replication_topology">4.3 release</a> came with topology
graph component. It is hard to use with higher number of replicas.
Canvas has a static size. It doesn’t work well on small screens and
doesn’t take benefit of bigger screens. Will be fixed by resizing canvas
size to a size of its container
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5647">#5647</a>. It will create
a little drawback - higher number of replicas might not fit into a
smaller canvas and also while the canvas is shrank, some of the nodes
will be hidden. Therefore panning and zooming of canvas is required
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5502">#5502</a>.</p>
<p>D3 force layout used in the canvas positions the nodes using force
simulation. The layout is different on each refresh. It makes impossible
to create a mental picture of the topology because position of a node is
always different. With following graph features: node can be dragged by
mouse. Graph supports switching nodes between static and float position.
Node’s position when layout is static is stored into <code class="docutils literal notranslate"><span class="pre">localStorage</span></code>.
User can then create his own design which is persisted across browser
session(but still limited to the browser instance). It is actually a
desired state but a path to get there is cumbersome because user has to
double click on each individual node. The initial layout can’t start
with static mode because UI doesn’t know position of nodes so starting
with float mode is required. Issue will be solved by switching all nodes
to static position after initial layout is done. E.g. it can be about
5s(better value should be found during implementation, e.g. it can be
computed). UI should provide a way to re-init the layout: a
<code class="docutils literal notranslate"><span class="pre">reset</span> <span class="pre">layout</span></code> button.</p>
<p>Topology segments(links between nodes) are created using adder dialog.
It is initiated by <code class="docutils literal notranslate"><span class="pre">add</span></code> button. This is solution is standard in Web
UI but in this case it doesn’t work very well. User sees which nodes he
wants to connect but then he needs to remember the nodes names, find it
in the dialog, choose suffix and add. It is slow. UI should provide an
interactive way to create the segment. Proposal is to drag-drop mouse
from one node to another
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5648">#5648</a>. This move will
identify the two nodes and open the dialog. Right now it conflicts with
dragging node on a canvas. There should be a switch between dragging
node and creation connection.</p>
<p>Nice to have: segment name field in segment adder dialog should have a
placeholder set to “autogenerated”.</p>
<p>Summary:</p>
<ul class="simple">
<li><p>resize canvas on window resize to fill its container
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5647">#5647</a></p></li>
<li><p>implement pan&amp;zoom of canvas
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5502">#5502</a></p></li>
<li><p>switch position of nodes to “static” after initial layout of nodes
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5649">#5649</a></p></li>
<li><p>implement creation of topology segment by dragging from left node to
right node <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5548">#5548</a></p></li>
<li><p>set placeholder in segment adder dialog
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5867">#5867</a></p></li>
</ul>
<p>Server roles won’t be displayed in the topology graph in 4.4 release.</p>
</section>
<section id="server-management">
<span id="id4"></span><h3>Server management<a class="headerlink" href="#server-management" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Leverage server roles design. Server details page should contain
<code class="docutils literal notranslate"><span class="pre">set-renewal-master</span></code> action in action list.
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5689">#5689</a></p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">delete</span></code> action to server details page. It will call
<code class="docutils literal notranslate"><span class="pre">server_del</span></code> API method. There has to be a confirmation window with
a red(i.e. destroy action) confirm button with label <em>Delete IPA
server</em>. <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5588">#5588</a></p></li>
</ul>
</section>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>Overview of new or modified CLI commands.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Options</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ipa server-del</p></td>
<td><p>–force –ignore-last-services
–ignore-topology-disconnect</p></td>
</tr>
<tr class="row-odd"><td><p>ipa config-mod</p></td>
<td><p>–ca-re
newal-master=server1.example.com</p></td>
</tr>
<tr class="row-even"><td><p>ipa replica-manage
clean-dangling-ruvs</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>Nothing new.</p>
</section>
</section>
<section id="how-to-test">
<span id="how-to-test22"></span><h1>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">¶</a></h1>
<p>Easy to follow instructions how to test the new feature. FreeIPA user
needs to be able to follow the steps and demonstrate the new features.</p>
<p>The chapter may be divided in sub-sections per <a class="reference external" href="#Use_Cases">Use
Case</a>.</p>
</section>
<section id="test-plan">
<span id="test-plan22"></span><h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>Test scenarios that will be transformed to test cases for FreeIPA
<a class="reference external" href="V3/Integration_testing">Continuous Integration</a> during
implementation or review phase. This can be also link to <a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/">source in
cgit</a> with the test,
if appropriate.</p>
<p><a class="reference external" href="V4/Manage_replication_topology_4_4/Test_Plan">Manage replication topology V4.4 test
plan</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Manage_replication_topology_4_4.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>