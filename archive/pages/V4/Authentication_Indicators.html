<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Authselect_migration.html" />
    <link rel="prev" title="Overview" href="Asn1crypto.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Users can authenticate to Kerberos in FreeIPA using many different
mechanism (i.e. Password, Password+OTP, RADIUS, etc.). Each mechanism
represents a different authentication strength. Similarly, Kerberos
enabled services had varying degrees of security sensitive content. It
would be valuable if services could specify that they require certain
authentication methods. This would permit, for example, the strongest
authentication methods to be used across all the services while not
allowing weaker authentication methods to have access to security
critical services.</p>
<p>This project enables authentication methods to insert tags, called
Authentication Indicators, into the TGT based upon the types of
authentication that are used. Service principals can then define a set
of authentication indicators which are required in order to obtain a
ticket for the service.</p>
</section>
<section id="use-cases">
<span id="use-cases3"></span><h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<section id="strong-authentication-on-selected-system">
<span id="id1"></span><h2>Strong Authentication on Selected System<a class="headerlink" href="#strong-authentication-on-selected-system" title="Permalink to this heading">¶</a></h2>
<section id="user-story">
<h3>User story<a class="headerlink" href="#user-story" title="Permalink to this heading">¶</a></h3>
<p>As an Administrator, I want to setup authentication to a critical system
in my infrastructure (gateway VPN, accounting system) to only allow IdM
users authenticated via strong authentication methods (2FA). I do not
want to require strong authentication on other systems.</p>
</section>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h3>
<p>A realm has two servers configured for ssh which use the following
principals configured with authentication indicators:</p>
<ul class="simple">
<li><p>host/lowsecurity.example.com []</p></li>
<li><p>host/highesecurity.example.com [otp radius]</p></li>
</ul>
<p>When the administrator logs in using both his password and an OTP token,
he can access both systems via ssh. However, when the administrator logs
in using just a password, he can only access lowsecurity.example.com.</p>
</section>
</section>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">¶</a></h2>
<p>The IETF draft for Authentication Indicators is available here:
<a class="reference external" href="https://tools.ietf.org/html/draft-jain-kitten-krb-auth-indicator-01">https://tools.ietf.org/html/draft-jain-kitten-krb-auth-indicator-01</a></p>
<p>The MIT Kerberos project for Authentication Indicators is available
here: <a class="reference external" href="http://k5wiki.kerberos.org/wiki/Projects/Authentication_indicator">http://k5wiki.kerberos.org/wiki/Projects/Authentication_indicator</a></p>
<p>MIT Kerberos now contains all the plumbing for Authentication Indicators
as of the 1.14 release. Our changes are mostly limited to the kdb plugin
and the UI/CLI.</p>
</section>
<section id="overview-1">
<span id="id2"></span><h2>Overview<a class="headerlink" href="#overview-1" title="Permalink to this heading">¶</a></h2>
<figure class="align-default" id="id9">
<img alt="Indicators.png" src="../../../_images/Indicators.png" />
<figcaption>
<p><span class="caption-text">Indicators.png</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="enable-optional-otp-preauth">
<span id="id3"></span><h2>Enable Optional OTP Preauth<a class="headerlink" href="#enable-optional-otp-preauth" title="Permalink to this heading">¶</a></h2>
<section id="server-side">
<h3>Server Side<a class="headerlink" href="#server-side" title="Permalink to this heading">¶</a></h3>
<p>Currently, if OTP is enabled for a user (even optionally), only the otp
preauth mechanism is returned. Once we have authentication indicators,
it is the otp preauth mechanism that will set the indicator. Thus, we
have to disallow 1FA through the otp preauth module so that only 2FA
authentications get a 2FA indicator.</p>
<p>To accomplish this, we have ipa-otpd set a critical control during its
bind operation which indicates to the server that an OTP MUST be
validated for authentication to succeed. If the server does not support
this control, the bind will fail. If the server does support the control
but is unable to validate an OTP, the bind will fail. The bind control
has the following OID: TBD.</p>
<p>Once authentications through ipa-otpd enforce the presence of a second
factor, we can enable other preauthentication mechanisms (encrypted
challenge/timestamp) for 1FA.</p>
</section>
<section id="client-side">
<span id="id4"></span><h3>Client Side<a class="headerlink" href="#client-side" title="Permalink to this heading">¶</a></h3>
<p>The kinit utility should work out of the box. Versions that did not
support OTP previously failed authentication. However, with the above
server change these clients now work for 1FA only. Further, clients
without FAST enabled will now be able to obtain a 1FA ticket; enabling
them to step up to 2FA by enabling FAST with their 1FA ticket. Finally,
clients that both understand OTP and have FAST enabled will chose the
first mechanism returned from the server; which is OTP. This is probably
the best behavior we can expect from kinit.</p>
<p>SSSD will have to learn how to handle receiving both encrypted challenge
and OTP when FAST is present. Currently, it should force the use of OTP.
We need to make this optional.</p>
</section>
</section>
<section id="insert-authentication-indicators-during-authentication-asreq">
<span id="id5"></span><h2>Insert Authentication Indicators During Authentication (ASReq)<a class="headerlink" href="#insert-authentication-indicators-during-authentication-asreq" title="Permalink to this heading">¶</a></h2>
<p>Once the above task is done, we can start inserting authentication
indicators. This is a simple configuration change to the KDB plugin to
return a specially formatted user string for the otp preauthentication
mechanism.</p>
</section>
<section id="verify-authentication-indicators-during-ticket-issuance-tgsreq">
<span id="id6"></span><h2>Verify Authentication Indicators During Ticket Issuance (TGSReq)<a class="headerlink" href="#verify-authentication-indicators-during-ticket-issuance-tgsreq" title="Permalink to this heading">¶</a></h2>
<p>During a TGS request, the KDC will load the service principal from KDB
like normal. In this case, we simply need to return a tl_data string
with the key as “require_auth” and the value a space separated list of
authentication indicators. This will be stored in LDAP as the optional
multi-valued attribute krbPrincipalAuthInd on krbPrincipal objects. This
will require a patch to the upstream LDAP KDB plugin’s schema to support
this new attribute. It will also require a patch to FreeIPA’s KDB to
support this new schema.</p>
<p>Once the KDC has a list of acceptable indicators, it can make the proper
policy evaluation.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>New Dependencies</p></th>
<th class="head"><p>Backup and Restore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>krb5 &gt;= 1.14.0 (freeipa-server only)</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
<section id="otprequired-bind-control">
<span id="id7"></span><h2>OTPRequired Bind Control<a class="headerlink" href="#otprequired-bind-control" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>OID</p></th>
<th class="head"><p>Contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TBD</p></td>
<td><p>None (empty)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="kdb-string-attributes">
<span id="id8"></span><h2>KDB String Attributes<a class="headerlink" href="#kdb-string-attributes" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Principal Type</p></th>
<th class="head"><p>Configuration</p></th>
<th class="head"><p>Key</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>User (AS Req)</p></td>
<td><p>RADIUS</p></td>
<td><p>otp</p></td>
<td><p>[{“indicators”: [“radius”]}]</p></td>
</tr>
<tr class="row-odd"><td><p>User (AS Req)</p></td>
<td><p>OTP</p></td>
<td><p>otp</p></td>
<td><p>[{“indicators”: [“otp”]}]</p></td>
</tr>
<tr class="row-even"><td><p>Service (TGS Req)</p></td>
<td><p>N/A</p></td>
<td><p>require_auth</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="feature-management">
<span id="feature-management3"></span><h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>Services should gain checkboxes for the required authentication
indicators.</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>Overview of the CLI commands. Example:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Options</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>service-add</p></td>
<td><p>–auth-ind=[‘otp’, ‘radius’]</p></td>
</tr>
<tr class="row-odd"><td><p>service-mod</p></td>
<td><p>–auth_ind=[‘otp’, ‘radius’]</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="upgrades">
<h1>Upgrades<a class="headerlink" href="#upgrades" title="Permalink to this heading">¶</a></h1>
<p>Upgrades will need to learn the new schema.</p>
</section>
<section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h1>
<p>TBD</p>
</section>
<section id="how-to-test">
<span id="how-to-test3"></span><h1>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">¶</a></h1>
<p>Easy to follow instructions how to test the new feature. FreeIPA user
needs to be able to follow the steps and demonstrate the new features.</p>
<p>The chapter may be divided in sub-sections per <a class="reference external" href="#Use_Cases">Use
Case</a>.</p>
</section>
<section id="test-plan">
<span id="test-plan3"></span><h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>Test scenarios that will be transformed to test cases for FreeIPA
<a class="reference external" href="V3/Integration_testing">Continuous Integration</a> during
implementation or review phase. This can be also link to <a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/">source in
cgit</a> with the test,
if appropriate.</p>
<p><a class="reference external" href="V4/Authentication_Indicators/Test_Plan">Authentication Indicators V4.4 test
plan</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Authentication_Indicators.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>