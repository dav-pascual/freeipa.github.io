<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Design" href="Password_Vault.html" />
    <link rel="prev" title="Overview" href="One-way_trust.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Store cryptographic objects (public and private keys, certificates) in
LDAP for use by PKCS#11 soft-token module.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>The PKCS#11 module can be plugged into various applications and provide
the data to them:</p>
<ul class="simple">
<li><p>BIND and OpenDNSSEC - handle DNS zone signing (see
<a class="reference external" href="https://fedorahosted.org/bind-dyndb-ldap/wiki/BIND9/Design/DNSSEC">https://fedorahosted.org/bind-dyndb-ldap/wiki/BIND9/Design/DNSSEC</a>)</p></li>
<li><p>p11-kit - CA certificate trust information (see <a class="reference external" href="V4/CA_certificate_renewal">V4/CA certificate
renewal</a>)</p></li>
<li><p>NSS databases - users’ private keys and certificates for SSL client
authentication</p></li>
<li><p>OpenSSH - users’ private keys for SSH public key authentication</p></li>
<li><p>…</p></li>
</ul>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><img alt="Pkcs11.png" src="../../../_images/Pkcs11.png" /></div>
<div class="line">The data is organized into subtrees, each representing a token in the
PKCS#11 module. Access control is handled by ACIs on per-token and
per-object level.</div>
</div>
<p>Object classes:</p>
<ul class="simple">
<li><p>Private key - private key as per PKCS#11 spec</p></li>
<li><p>Public key - public key as per PKCS#11 spec</p></li>
<li><p>Certificate - X.509 certificate as per PKCS#11 spec</p></li>
<li><p>Trust - NSS vendor-specific trust object</p></li>
</ul>
<p>The LDAP schema design is on <a class="reference external" href="V4/PKCS11_in_LDAP/Schema">separate
page</a>.</p>
<p>Subtrees/tokens:</p>
<ul class="simple">
<li><p>cn=DNSSEC</p>
<ul>
<li><p>private key and public key objects</p></li>
<li><p>read and write access for IPA DNS masters, read access to public
keys for everyone</p></li>
</ul>
</li>
<li><p>cn=CA Certificates</p>
<ul>
<li><p>certificate and trust objects</p></li>
<li><p>read access for everyone, write access for IPA masters</p></li>
</ul>
</li>
<li><p>cn=User Keys</p>
<ul>
<li><p>private key and certificate objects</p></li>
<li><p>read and write access to individual objects for their owner</p></li>
</ul>
</li>
</ul>
<section id="how-applications-interact-with-pkcs-11">
<span id="how-applications-interact-with-pkcs11"></span><h2>How applications interact with PKCS#11<a class="headerlink" href="#how-applications-interact-with-pkcs-11" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>BIND v9.10b1 - <img alt="PKCS functions seen by ltrace while runnin on top of SoftHSMv2" src="../../../_images/bind.v9.10.ltrace.pkcs11_functions.log" /> <img alt="Full log" src="../../../_images/Bind.v9.10.ltrace.log" /></p>
<ul>
<li><p>uses digest, sign, verify, keygen and RNG functions</p></li>
<li><p>does not persist any objects</p></li>
<li><p>searches objects by CKA_CLASS, CKA_KEY_TYPE, CKA_ID, CKA_LABEL,
CKA_TOKEN</p></li>
</ul>
</li>
<li><p>OpenDNSSEC</p>
<ul>
<li><p>uses digest, sign, keygen and RNG functions</p></li>
<li><p>persists private key objects with CKA_LABEL, CKA_ID, CKA_KEY_TYPE,
CKA_SIGN, CKA_DECRYPT, CKA_UNWRAP, CKA_SENSITIVE, CKA_TOKEN,
CKA_PRIVATE, CKA_EXTRACTABLE and key-type specific attributes</p></li>
<li><p>persists public key objects with CKA_LABEL, CKA_ID, CKA_KEY_TYPE,
CKA_VERIFY, CKA_ENCRYPT, CKA_WRAP, CKA_TOKEN and key-type specific
attributes</p></li>
<li><p>searches objects by CKA_CLASS, CKA_ID</p></li>
<li><p>utility “ods-hsmutil test” can test given PKCS#11 module</p></li>
</ul>
</li>
<li><p>p11-kit</p>
<ul>
<li><p>proxies function calls to external PKCS#11 module</p></li>
<li><p>does not persist any objects</p></li>
</ul>
</li>
<li><p>NSS</p>
<ul>
<li><p><a class="reference external" href="https://developer.mozilla.org/en/docs/PKCS11_FAQ">https://developer.mozilla.org/en/docs/PKCS11_FAQ</a></p></li>
</ul>
</li>
<li><p>OpenSSH</p>
<ul>
<li><p>uses sign functions</p></li>
<li><p>does not persist any objects</p></li>
<li><p>searches objects by CKA_CLASS, CKA_ID, CKA_SIGN</p></li>
</ul>
</li>
</ul>
<p>The PKCS#11 module needs to provide cryptographic functions, either by
re-using existing solution (e.g. SoftHSM) or by implementing a thin
layer on top of NSS cryptographic functions.</p>
<p>TODO</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>N/A</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>N/A</p>
</section>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>FreeIPA is going to have <a class="reference external" href="V4/Password_Vault">Vault</a> suitable for key
material storage. There was an proposal to use this Vault as private-key
storage for PKCS#11 module instead of plain LDAP.</p>
<p>This idea was postponed because Vault implementation will take some
time. For now we need to support private-keys stored in LDAP. To be
future-proof, we have to have upgrade path from plain LDAP to Vault.</p>
<p>Please see <a class="reference external" href="https://www.redhat.com/archives/freeipa-devel/2014-March/msg00148.html">discussion on
freeipa-devel</a>
(it was focused on private keys used for DNSSEC).</p>
<p>There are two basic approaches:</p>
<ul class="simple">
<li><p>(a radical one) One-shot migration:</p>
<ul>
<li><p>Upon replica-upgrade, convert all private keys from LDAP to Vault
and replace all private keys in LDAP with a reference to Vault.</p></li>
<li><p>Old clients will no longer see private keys over PKCS#11 so
clients need to be upgraded.</p></li>
<li><p>This is feasible only if set of clients is very limited, e.g. only
DNSSEC machinery (BIND + OpenDNSSEC) running on IPA replicas.</p></li>
</ul>
</li>
<li><p>(a conservative one) Use configuration information from LDAP (e.g. in
cn=etc or so) to detect if some old replicas/clients are still in the
topology and run auxiliary daemon for LDAP&lt;-&gt;Vault synchronization.</p></li>
</ul>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>The objects will be accessed mainly through the PKCS#11 module. The
PKCS#11 module will use SSSD as backend.</p>
</section>
<section id="backup-and-restore">
<h1>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="rfe-author">
<h1>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="User:Jcholast">Jan Cholasta</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/PKCS11_in_LDAP.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>