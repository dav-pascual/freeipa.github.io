<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Certificate_Identity_Mapping.html" />
    <link rel="prev" title="Overview" href="CA-less_to_CA-full_conversion.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Allow automated and manual renewal of IPA CA certificate. Provide an
utility for manual renewal, including modification of chaining
(self-signed vs. signed by external CA). Store multiple CA certificates
in LDAP and distribute them to clients.</p>
<p>This page describes <strong>phase 1</strong> of the CA certificate management
feature, which consists of automated and manual CA certificate renewal,
CA certificate management utility and storage of multiple CA certificate
in LDAP. Visit <a class="reference external" href="V4/CA_certificate_renewal_(2)">V4/CA certificate renewal
(2)</a> for description of <strong>phase 2</strong>,
which consists of distribution of CA certificates to IPA clients.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<section id="automated-ca-certificate-renewal">
<span id="id1"></span><h2>Automated CA certificate renewal<a class="headerlink" href="#automated-ca-certificate-renewal" title="Permalink to this heading">¶</a></h2>
<p>When the CA certificate is nearing its expiration time, it should be
automatically renewed. The renewed certificate will use the same keypair
and subject name as the old certificate.</p>
<p>This only works for self-signed CA certificates in CA-ful installs.</p>
</section>
<section id="manual-ca-certificate-renewal">
<span id="id2"></span><h2>Manual CA certificate renewal<a class="headerlink" href="#manual-ca-certificate-renewal" title="Permalink to this heading">¶</a></h2>
<p>Allow admin to manually renew the CA certificate and possibly change its
chaining (self-signed → signed by external CA, signed by external CA →
self-signed, signed by external CA → signed by other external CA)
(<strong>phase 1</strong>) and have the renewed certificate automatically distributed
to all systems in the domain (<strong>phase 2</strong>). The renewed certificate will
use the same keypair and subject name as the old certificate.</p>
<p>This works for any CA certificate in CA-ful installs.</p>
</section>
<section id="manual-install-of-ca-certificate">
<span id="id3"></span><h2>Manual install of CA certificate<a class="headerlink" href="#manual-install-of-ca-certificate" title="Permalink to this heading">¶</a></h2>
<p>In CA-less installs, CA certificate renewal is completely in charge of a
3rd party CA. Provide means of installing CA certificates obtained from
such a CA (<strong>phase 1</strong>) and automatically distribute them to all systems
in the domain (<strong>phase 2</strong>).</p>
</section>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<section id="shared-certificate-store">
<span id="id4"></span><h2>Shared certificate store<a class="headerlink" href="#shared-certificate-store" title="Permalink to this heading">¶</a></h2>
<p>CA certificates will be stored in entries under
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn: cn=EXAMPLE.COM IPA CA,cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: ipaCertificate</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: pkiCA</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: ipaKeyPolicy</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cn: cn=EXAMPLE.COM IPA CA</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaCertSubject: CN=Certificate Authority,O=EXAMPLE.COM</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaCertIssuerSerial: CN=Certificate Authority,O=EXAMPLE.COM;1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaCertIssuerSerial: CN=Certificate Authority,O=EXAMPLE.COM;22</span></code></div>
<div class="line"><a href="#id5"><span class="problematic" id="id6">``</span></a>ipaPublicKey: <a href="#id7"><span class="problematic" id="id8">``</span></a><em>``DER-encoded public key``</em></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaConfigString: ipaCA</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaConfigString: compatCA</span></code></div>
<div class="line"><a href="#id9"><span class="problematic" id="id10">``</span></a>cACertificate;binary:: <a href="#id11"><span class="problematic" id="id12">``</span></a><em>``DER-encoded certificate 1``</em></div>
<div class="line"><a href="#id13"><span class="problematic" id="id14">``</span></a>cACertificate;binary:: <a href="#id15"><span class="problematic" id="id16">``</span></a><em>``DER-encoded certificate 2``</em></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaKeyTrust: trusted</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaKeyExtUsage: 1.3.6.1.5.5.7.3.1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaKeyExtUsage: 1.3.6.1.5.5.7.3.2</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaKeyExtUsage: 1.3.6.1.5.5.7.3.3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaKeyExtUsage: 1.3.6.1.5.5.7.3.4</span></code></div>
</div>
<p>Each entry represents a set of certificates using a single subject name
and public key and contains trust policy for the set of certificates
(based on <a class="reference external" href="http://p11-glue.freedesktop.org/doc/storing-trust-policy/index.html">p11-kit trust
policy</a>).
The attributes are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cn</span></code></p>
<p>Nickname for the certificates. The value must be unique in the store.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaCertSubject</span></code></p>
<p>Subject name of the certificates. The value must be unique in the
store. Semicolons in the subject name are escaped as <code class="docutils literal notranslate"><span class="pre">\3b</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaCertIssuerSerial</span></code></p>
<p>Issuer name and serial number of each certificate in the set,
separated by semicolon. Each value must be unique in the store.
Semicolons in the issuer name are escaped as <code class="docutils literal notranslate"><span class="pre">\3b</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">`ipaPublicKey</span></code> &lt;V4/PKCS11_in_LDAP/Schema#Encoded_key_data&gt;`__</p>
<p>Public key of the certificates as DER-encoded SubjectPublicKeyInfo.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaConfigString</span></code></p>
<p>Configuration flags:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaCA</span></code></p>
<p>This entry represents the IPA CA certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compatCA</span></code></p>
<p>When a new certificate is added to the set, update
<code class="docutils literal notranslate"><span class="pre">cn=CAcert,cn=ipa,cn=etc,</span></code><em>``suffix``</em> with it.</p>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">cACertificate</span></code></p>
<p>Each of the certificates in the set in DER encoding.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaKeyTrust</span></code></p>
<p>Trust setting for the certificates:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code> (default)</p>
<p>Trust is not explicitly given. If there is other source of trust
information, it should be used instead.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">trusted</span></code></p>
<p>The certificates in the set are explicitly trusted.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">distrusted</span></code></p>
<p>The certificates in the set are explicitly distrusted.</p>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaKeyUsage</span></code></p>
<p>Allowed key usages for the certificates as purpose bit names from the
key usage certificate extension (see <a class="reference external" href="http://tools.ietf.org/html/rfc5280#section-4.2.1.3%7CRFC">5280, section
4.2.1.3</a>).
A value of <code class="docutils literal notranslate"><span class="pre">none</span></code> means no key usages are allowed. Default value is
the value of the key usage extension from each certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaKeyExtUsage</span></code></p>
<p>Allowed extended key usages as key purpose OIDs (see <a class="reference external" href="http://tools.ietf.org/html/rfc5280#section-4.2.1.12%7CRFC">5280, section
4.2.1.12</a>).
A value of <code class="docutils literal notranslate"><span class="pre">1.3.6.1.4.1.3319.6.10.16</span></code> means no extended key usages
are allowed. Default value is the value of the extended key usage
extension from each certificate.
For trusted CA certificates, the value of this attribute is mapped to
NSS / certutil trust flags as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.1</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">C,,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.2</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">T,,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.3</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">,,C</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.4</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">,C,</span></code></p></li>
</ul>
</li>
</ul>
<p>The entries will be readable by everyone and writable only by the
directory manager (for installers and management tools) and the server
host (for automatic renewal).</p>
<p>The new schema used for the entries is:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaCertSubject’``</div>
<div class="line">``                 DESC ‘Subject name’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 SINGLE-VALUE``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’ )``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaCertIssuerSerial’``</div>
<div class="line">``                 DESC ‘Issuer name and serial number’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SUBSTR caseIgnoreSubstringsMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’ )``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaKeyTrust’``</div>
<div class="line">``                 DESC ‘Key trust (unknown, trusted, distrusted)’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’) ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaKeyUsage’``</div>
<div class="line">``                 DESC ‘Allowed key usage’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’) ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaKeyExtUsage’``</div>
<div class="line">``                 DESC ‘Allowed extended key usage’``</div>
<div class="line">``                 EQUALITY objectIdentifierMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.38``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’)``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.???</span></code></div>
<div class="line">``                NAME ‘ipaCertificate’``</div>
<div class="line">``                SUP top STRUCTURAL``</div>
<div class="line">``                MUST ( cn $ ipaCertSubject $ ipaCertIssuerSerial $ ipaPublicKey )``</div>
<div class="line">``                MAY  ( ipaConfigString )``</div>
<div class="line">``                X-ORIGIN ‘IPA v4’ )``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.???</span></code></div>
<div class="line">``                NAME ‘ipaKeyPolicy’``</div>
<div class="line">``                SUP top AUXILIARY``</div>
<div class="line">``                MAY  ( ipaKeyTrust $ ipaKeyUsage $ ipaExtKeyUsage )``</div>
<div class="line">``                X-ORIGIN ‘IPA v4’)``</div>
</div>
</section>
<section id="automatic-renewal-of-ipa-ca-certificate">
<span id="id17"></span><h2>Automatic renewal of IPA CA certificate<a class="headerlink" href="#automatic-renewal-of-ipa-ca-certificate" title="Permalink to this heading">¶</a></h2>
<p>The CA certificate managed by Dogtag will be tracked by certmonger. If
the certificate is self-signed, it will be automatically renewed. If the
certificate is signed by an external CA, the renewal attempt will fail
with an error, advising the administrator to renew the certificate
manually. The error is syslogged with ALERT severity.</p>
</section>
<section id="ca-certificate-management-utility">
<span id="id18"></span><h2>CA certificate management utility<a class="headerlink" href="#ca-certificate-management-utility" title="Permalink to this heading">¶</a></h2>
<p>There will be new utility to manage CA certificates,
<code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code>. It will have several subcommands:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">renew</span></code><em>``options``</em></p>
<p>This command will be available only for CA-ful installs and will be
used to renew the IPA CA certificate. The certificate can be renewed
either as self-signed or signed by an external CA. By default, the
chaining used for the old certificate is used for the new certificate
as well. Renewing a CA certificate signed by an external CA is a 2
step operation: in the first step, a CSR is exported to
<code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code>; in the second step, the signed certificate
is installed.
The available options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--self-signed</span></code></p>
<p>Renew the CA certificate as self-signed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--external-ca</span></code></p>
<p>Renew the CA certificate as signed by an external CA, step 1:
Export CSR to <code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--external-cert-file</span></code><em>``file``</em></p>
<p>Renew the CA certificate as signed by an external CA, step 2:
Install the new CA certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--password</span></code><em>``password``</em></p>
<p>Directory manager password. Required for external CA renewal step
2.</p>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">install</span></code><em>``options``</em><a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">``</span></a><em>``file``</em></p>
<p>Install CA certificate from a PEM file.
The available options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code><em>``nickname``</em>, <code class="docutils literal notranslate"><span class="pre">--nickname</span></code><em>``nickname``</em></p>
<p>Nickname for the certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code><em>``flags``</em>, <code class="docutils literal notranslate"><span class="pre">--trust-flags</span></code><em>``flags``</em></p>
<p>Trust flags for the certificate in NSS / certutil format.</p>
</li>
</ul>
</li>
</ul>
</section>
<section id="client-certificate-update-utility">
<span id="id23"></span><h2>Client certificate update utility<a class="headerlink" href="#client-certificate-update-utility" title="Permalink to this heading">¶</a></h2>
<p>There will be new utility, <code class="docutils literal notranslate"><span class="pre">ipa-certupdate</span></code>, for updating CA
certificates on clients with up-to-date data from LDAP. Until <strong>phase
2</strong> is complete, running it manually will be the only way to update the
CA certificates after installation.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>In CA-ful installs, CA certificate renewal is handled by certmonger.
Automatic renewal is handled by certmonger itself. In manual renewal,
<code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code> resubmits the certmonger request for the CA
certificate. If the CA certificate is self-signed, the request is
submitted directly to Dogtag. If the CA certificate is signed by an
external CA, <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code> exports the CSR created by certmonger
to <code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code> in the first step. In the seconds step, it
updates <code class="docutils literal notranslate"><span class="pre">cn=ca_renewal,cn=ipa,cn=etc,</span></code><em>``suffix``</em> so that the new
CA certificate can be picked up by certmonger and resubmits the
certmonger request. In the post-save command of the certmonger request,
the renewed CA certificate is added to
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>.</p>
<p>When installing new CA certificate manually, <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code> adds
the certificate directly to
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>.</p>
<p>When a CA certificate is renewed, its previous version is not removed to
allow rollover.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>N/A</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="#CA_certificate_management_utility">design</a>.</p>
</section>
<section id="installers">
<h2>Installers<a class="headerlink" href="#installers" title="Permalink to this heading">¶</a></h2>
<p>N/A</p>
</section>
</section>
<section id="upgrade">
<h1>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this heading">¶</a></h1>
<p>Old clients will look for IPA CA certificate in
<code class="docutils literal notranslate"><span class="pre">cn=CAcert,cn=ipa,cn=etc,</span></code><em>``suffix``</em>. A copy of the most recent
IPA CA certificate needs to be maintained in this entry for
compatibility with old clients.</p>
<p>Old servers do not have
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>. Client installer has
to look for CA certificates both in this entry and in
<code class="docutils literal notranslate"><span class="pre">cn=CAcert,cn=ipa,cn=etc,</span></code><em>``suffix``</em> for compatibility with old
servers.</p>
</section>
<section id="how-to-test">
<span id="how-to-test13"></span><h1>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">¶</a></h1>
<section id="automated-ca-certificate-renewal-1">
<span id="id24"></span><h2>Automated CA certificate renewal<a class="headerlink" href="#automated-ca-certificate-renewal-1" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Install IPA server with CA (either self-signed or signed by external
CA)</p></li>
<li><p>Get the expiration date of the IPA CA certificate:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># getcert list -d /etc/pki/pki-tomcat/alias -n &#39;caSigningCert cert-pki-ca&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Move system time 3 weeks before the expiration date</p></li>
<li><p>Check the status of the certmonger request:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># getcert list -d /etc/pki/pki-tomcat/alias -n &#39;caSigningCert cert-pki-ca&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>If the IPA CA was installed self-signed:</p>
<ol class="arabic simple">
<li><p>Wait for the certmonger request to complete, it should end up with
MONITORING status</p></li>
<li><p>Check that the renewed CA certificate was added to the LDAP
certificate store and to the <code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS
database</p></li>
</ol>
</li>
<li><p>If the IPA CA was installed signed by external CA:</p>
<ol class="arabic simple">
<li><p>Wait for the certmonger request to complete, it should end up with
CA_WORKING status</p></li>
<li><p>Check that an error was syslogged with ALERT severity</p></li>
</ol>
</li>
</ol>
</section>
<section id="manual-ca-certificate-renewal-1">
<span id="id25"></span><h2>Manual CA certificate renewal<a class="headerlink" href="#manual-ca-certificate-renewal-1" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Install IPA server with CA (either self-signed or signed by external
CA)</p></li>
<li><p>To renew the IPA CA certificate as self-signed:</p>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code>, if the IPA CA was not installed
self-signed, add the <code class="docutils literal notranslate"><span class="pre">--self-signed</span></code> option</p></li>
<li><p>Wait for the command to complete</p></li>
<li><p>Check that the renewed CA certificate was added to the LDAP
certificate store and to the <code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS
database</p></li>
</ol>
</li>
<li><p>To renew the IPA CA certificate as signed by external CA:</p>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code>, if the IPA CA was not installed
signed by external CA, add the <code class="docutils literal notranslate"><span class="pre">--external-ca</span></code> option</p></li>
<li><p>The command will produce a CSR file at <code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code></p></li>
<li><p>Sign the CSR file with the external CA to get the renewed CA
certificate</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code>, specify the renewed CA
certificate and external CA certificate chain files in the
<code class="docutils literal notranslate"><span class="pre">--external-cert-file</span></code> option</p></li>
<li><p>Wait for the command to complete</p></li>
<li><p>Check that the renewed CA certificate and the external CA
certificate were added to the LDAP certificate store and to the
<code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS database</p></li>
</ol>
</li>
</ol>
</section>
<section id="manual-install-of-ca-certificate-1">
<span id="id26"></span><h2>Manual install of CA certificate<a class="headerlink" href="#manual-install-of-ca-certificate-1" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Install IPA server</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">install</span></code> to install the CA certificate</p></li>
<li><p>Check that the certificate was added to the LDAP certificate store</p></li>
</ol>
</section>
<section id="manual-update-of-local-ca-certificate-files">
<span id="id27"></span><h2>Manual update of local CA certificate files<a class="headerlink" href="#manual-update-of-local-ca-certificate-files" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Install IPA server(s) and possibly client(s)</p></li>
<li><p>Renew or install CA certificate(s)</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-certupdate</span></code> on either a server or a client</p></li>
<li><p>Check that the <code class="docutils literal notranslate"><span class="pre">/etc/ipa/nssdb</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/pki/nssdb</span></code> NSS
databases and the <code class="docutils literal notranslate"><span class="pre">/etc/ipa/ca.crt</span></code> file were updated with CA
certificates from the LDAP certificate store</p></li>
<li><p>If on a server, additionaly check that the
<code class="docutils literal notranslate"><span class="pre">/etc/dirsrv/slapd-REALM</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/httpd/alias</span></code> NSS databases
and the <code class="docutils literal notranslate"><span class="pre">/usr/share/ipa/html/ca.crt</span></code> file were updated as well</p></li>
<li><p>If on a server with a CA, additionaly check that the
<code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS database was updated as well</p></li>
</ol>
</section>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="rfe-author">
<h1>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="User:Jcholast">Jan Cholasta</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/CA_certificate_renewal.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>