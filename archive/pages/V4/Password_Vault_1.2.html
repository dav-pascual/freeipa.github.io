<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Notice - Design Document" href="Password_Vault_2.0.html" />
    <link rel="prev" title="Overview" href="Password_Vault_1.1.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Password Vault 1.2 provides several enhancements over <a class="reference external" href="V4/Password_Vault_1.1">Password Vault
1.1</a>.</p>
<p>New vault management commands:</p>
<ul class="simple">
<li><p>Copying vault secrets.</p></li>
</ul>
</section>
<section id="vault-management">
<span id="id1"></span><h1>Vault Management<a class="headerlink" href="#vault-management" title="Permalink to this heading">¶</a></h1>
<section id="copying-vault-secret">
<span id="id2"></span><h2>Copying vault secret<a class="headerlink" href="#copying-vault-secret" title="Permalink to this heading">¶</a></h2>
<p>The vault-add and the vault-archive commands provide a mechanism to copy
a secret from one vault to another. On these commands if the source
vault is specified the secret will be retrieved from the source vault
then archived into the target vault. The retrieval parameters should be
specified as in the vault-retrieve command using the –source-*
parameters. The vault-add will copy the secret into a new target vault.
The vault-archive will copy the secret into an existing target vault. In
either case the target vault may have a different vault type than the
source vault.</p>
<p>To copy a secret from a source vault to a new target vault:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add &lt;target vault&gt; --source-vault &lt;source vault&gt; [--source-service &lt;service&gt;|--source-shared|--source-user &lt;user&gt;] [--source-password-file &lt;password file&gt;] [--source-private-key-file &lt;private key file&gt;]
</pre></div>
</div>
<p>To copy a secret from a source vault to an existing target vault:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive &lt;target vault&gt; --source-vault &lt;source vault&gt; [--source-service &lt;service&gt;|--source-shared|--source-user &lt;user&gt;] [--source-password-file &lt;password&gt; file] [--source-private-key-file &lt;private key file&gt;]
</pre></div>
</div>
</section>
</section>
<section id="service-operations">
<span id="id3"></span><h1>Service Operations<a class="headerlink" href="#service-operations" title="Permalink to this heading">¶</a></h1>
<p>Vault 1.2 provides a mechanism to copy a secret from one vault to
another. This can be used to simplify provisioning service passwords.</p>
<section id="creating-service-password">
<span id="id4"></span><h2>Creating service password<a class="headerlink" href="#creating-service-password" title="Permalink to this heading">¶</a></h2>
<p>Initially a service administrator can store the service password in
admin’s private vault:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add http_password
$ ipa vault-archive http_password --in password.txt
</pre></div>
</div>
<p>Then service password can be copied into a new service vault:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add password --service HTTP/server.example.com --type asymmetric --public-key-file service-public.pem --source-vault http_password
-------------------------------
Archived data into vault &quot;password&quot;
-------------------------------
  Vault name: password
  Type: asymmetric
</pre></div>
</div>
</section>
<section id="changing-service-vault-password">
<span id="id5"></span><h2>Changing service vault password<a class="headerlink" href="#changing-service-vault-password" title="Permalink to this heading">¶</a></h2>
<p>The service administrator can change the service vault password by
archiving a new secret:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive http_password --in new_password.txt
----------------------------------------
Archived data into vault &quot;http_password&quot;
----------------------------------------
  Vault name: http_password
  Type: standard
</pre></div>
</div>
<p>The service administrator will need to re-provision the new service
vault password to each service instance using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-archive password --service HTTP/server.example.com --source-vault http_password
-------------------------------
Archived data into vault &quot;password&quot;
-------------------------------
  Vault name: password
  Type: asymmetric
</pre></div>
</div>
</section>
</section>
<section id="escrow-operations">
<span id="id6"></span><h1>Escrow Operations<a class="headerlink" href="#escrow-operations" title="Permalink to this heading">¶</a></h1>
<p>Vault encryption key can be escrowed such that if needed the escrow
officer can recover the secrets.</p>
<section id="creating-a-vault-with-escrow">
<span id="id7"></span><h2>Creating a vault with escrow<a class="headerlink" href="#creating-a-vault-with-escrow" title="Permalink to this heading">¶</a></h2>
<p>An escrowed symmetric vault can be created with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add EscrowedSymmetricVault --type symmetric --escrow-public-key-file escrow-public.pem
New password: ********
Verify password: ********
------------------------------------
Added vault &quot;EscrowedSymmetricVault&quot;
------------------------------------
  Vault name: EscrowedSymmetricVault
  Vault type: symmetric
</pre></div>
</div>
<p>An escrowed asymmetric vault can be created with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-add EscrowedAsymmetricVault --type asymmetric --public-key-file public.pem --escrow-public-key-file escrow-public.pem
-------------------------------------
Added vault &quot;EscrowedAsymmetricVault&quot;
-------------------------------------
  Vault name: EscrowedAsymmetricVault
  Vault type: asymmetric
</pre></div>
</div>
</section>
<section id="escrowing-an-existing-vault">
<span id="id8"></span><h2>Escrowing an existing vault<a class="headerlink" href="#escrowing-an-existing-vault" title="Permalink to this heading">¶</a></h2>
<p>A vault owner can escrow an existing symmetric vault by providing the
escrow public key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod SymmetricVault --escrow-public-key-file escrow-public.pem
Password: ********
-------------------------------
Modified vault &quot;SymmetricVault&quot;
-------------------------------
</pre></div>
</div>
<p>A vault owner can escrow an existing asymmetric vault by providing the
vault private key and the escrow public key</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod AsymmetricVault --private-key-file private.pem --escrow-public-key-file escrow-public.pem
--------------------------------
Modified vault &quot;AsymmetricVault&quot;
--------------------------------
</pre></div>
</div>
<p>A vault owner can unescrow a vault box as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod Vault --escrow-public-key &#39;&#39;
----------------------
Modified vault &quot;Vault&quot;
----------------------
</pre></div>
</div>
</section>
<section id="recovering-an-escrowed-secret">
<span id="id9"></span><h2>Recovering an escrowed secret<a class="headerlink" href="#recovering-an-escrowed-secret" title="Permalink to this heading">¶</a></h2>
<p>An escrow officer can recover the secret by specifying the escrow
private key to decrypt the secret key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-retrieve EscrowedVault --escrow-private-key-file escrow-private.pem --out secret.txt
-----------------------------------------
Retrieved data from vault &quot;EscrowedVault&quot;
-----------------------------------------
</pre></div>
</div>
</section>
<section id="changing-escrowed-vault-password">
<span id="id10"></span><h2>Changing escrowed vault password<a class="headerlink" href="#changing-escrowed-vault-password" title="Permalink to this heading">¶</a></h2>
<p>If the current symmetric vault password is known, the owner can change
it by providing the old password and the new password. The new secret
key will automatically be escrowed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod EscrowedSymmetricVault --change-password
Password: *********
New password: *********
Verify password: ********
-------------------------
Password change completed
-------------------------
</pre></div>
</div>
<p>If the current password is unknown, the owner can request password
reset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod EscrowedSymmetricVault --reset-password
New password: *********
Verify password: ********
-----------------------
Password change pending
-----------------------
</pre></div>
</div>
<p>The escrow officer can approve the request as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod EscrowedSymmetricVault --approve-reset --escrow-private-key-file escrow-private.pem
-------------------------
Password change completed
-------------------------
</pre></div>
</div>
<p>If necessary, the escrow officer can reject the request as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa vault-mod EscrowedSymmetricVault --reject-reset
------------------------
Password change canceled
------------------------
</pre></div>
</div>
</section>
</section>
<section id="ldap-directory">
<span id="id11"></span><h1>LDAP Directory<a class="headerlink" href="#ldap-directory" title="Permalink to this heading">¶</a></h1>
<section id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">cn</span><span class="o">=&lt;</span><span class="n">vault</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">DN</span><span class="o">&gt;</span>
<span class="o">...</span>
<span class="n">ipaVaultPublicKey</span><span class="p">::</span> <span class="o">...</span>
<span class="n">ipaVaultEscrowPublicKey</span><span class="p">::</span> <span class="o">...</span>
<span class="n">ipaVaultPendingSalt</span><span class="p">::</span> <span class="o">...</span>
<span class="n">ipaVaultPendingPublicKey</span><span class="p">::</span> <span class="o">...</span>
<span class="n">ipaVaultPendingEscrowedSecretKey</span><span class="p">::</span> <span class="o">...</span>
<span class="n">ipaVaultPendingEscrowedPrivateKey</span><span class="p">::</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="access-control-list">
<span id="id12"></span><h2>Access Control List<a class="headerlink" href="#access-control-list" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dn: cn=kra,$SUFFIX
...

dn: cn=vaults,cn=kra,$SUFFIX
...

################################################################################
# Security Officer ACLs
################################################################################
aci: (targetfilter=&quot;(objectClass=ipaVaultContainer)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Security officers can access all container&quot;;
   allow(read, search, compare) groupdn=&quot;ldap:///cn=security officers,cn=groups,cn=accounts,&lt;suffix&gt;&quot;;)
aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;*&quot;)
  (version 3.0; acl &quot;Security officers can access all vaults&quot;;
   allow(read, search, compare) groupdn=&quot;ldap:///cn=security officers,cn=groups,cn=accounts,&lt;suffix&gt;&quot;;)
aci: (targetfilter=&quot;(objectClass=ipaVault)&quot;)
  (targetattr=&quot;ipaVaultEncSalt || ipaVaultPublicKey || ipaVaultEscrowPublicKey || ipaVaultEscrowedEncKey
   || ipaVaultEscrowedPublicKey || ipaVaultNewSecretSalt || ipaVaultNewPublicKey || ipaVaultNewEscrowedSecretKey || ipaVaultNewEscrowedPublicKey&quot;)
  (version 3.0; acl &quot;Security officer can reset/change vault password/keys&quot;;
   allow(write) groupdn=&quot;ldap:///cn=security officers,cn=groups,cn=accounts,&lt;suffix&gt;&quot;;)
</pre></div>
</div>
</section>
</section>
<section id="status">
<h1>Status<a class="headerlink" href="#status" title="Permalink to this heading">¶</a></h1>
<p>Planned changes:</p>
<ul class="simple">
<li><p>Add mechanism for copying vault secrets (<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/5223">pending
review</a>).</p></li>
<li><p>Add vault archival from standard input.</p></li>
<li><p>Add vault escrow (needs rebase).</p></li>
<li><p>Other improvements.</p></li>
</ul>
<p>Note that the list of patches may change depending on the review
feedback.</p>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="V4/Password_Vault">Password Vault</a></p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Password_Vault_1.2.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>