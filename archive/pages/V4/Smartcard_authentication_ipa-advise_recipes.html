<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Sub-CAs.html" />
    <link rel="prev" title="Introduction" href="Smart_Proxy.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Smartcard authentication requires additional settings to work properly
(both PKINIT and Login to WebUI). That setting might not be really
straight forward and mainly it has to be done on all FreeIPA servers. As
FreeIPA doesn’t have any way how to change settings on all servers
remotely, we need to create script, which will be then run on all
servers. For those purposes ipa has <code class="docutils literal notranslate"><span class="pre">ipa-advise</span></code> command, which can
generate scripts.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>As an administrator I want to be able to configure Smartcard
certificate authentication to FreeIPA WebUI and KDC using minimum
manual intervention, ideally via a provided command-line tool</p></li>
<li><p>As an administrator I want to configure OCSP client certificate
checking in a robust way that checks whether my environment will
support IPA CA-supplied OCSP responder querying.</p></li>
<li><p>As an administrator I want to be able to enable PKINIT feature after
install/upgrade with minimum effort</p></li>
<li><p>As an administrator I expect these tools to be easily re-usable in
configuration management platforms such as Chef and Ansible</p></li>
</ul>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>Each use case can be solved by running a dedicated recipe generated by
querying a corresponding topic in <code class="docutils literal notranslate"><span class="pre">ipa-advise</span></code> command. Each script
should be able to check whether the environment supports the desired
configuration (e.g. all DNS records are resolvable, especially ipa-ca)
and should also be idempotent so that it can be safely used in an
Ansible playbook. It should also provide information message that the
step was successful or provide steps how to solve the issue. In case
that a script fails it has to be rerun after fixing described issue.</p>
<section id="smartcard-login-activation">
<span id="id1"></span><h2>Smartcard Login activation<a class="headerlink" href="#smartcard-login-activation" title="Permalink to this heading">¶</a></h2>
<p>The main purpose of this script is to obtain all master’s hostnames
which are in topology and for each of them call ‘ipa service-mod
–ok-auth-as-delegate=True’. As the script needs to use ipa CLI it needs
to be called with authenticated user. Whether there is a correct ticket
or not is the first check (step) of the script.</p>
</section>
<section id="ocsp">
<h2>OCSP<a class="headerlink" href="#ocsp" title="Permalink to this heading">¶</a></h2>
<p>The script for turning on the OSCP has to be sure that the
<code class="docutils literal notranslate"><span class="pre">ipa-ca.domain.com</span></code> is resolvable because otherwise the issuing of
certificates (in CA-full installation) and installing replica (in all
installations) will be broken. If the <code class="docutils literal notranslate"><span class="pre">ipa-ca</span></code> records prove to be
unresolvable, the script will emit an error and also provide the list of
records for the user to add into their DNS infrastructure. Once the DNS
works correctly, the script will continue with subsequent steps.</p>
<p>Steps:</p>
<ol class="arabic simple">
<li><p>Check whether the ipa-ca.domain.com is resolvable. If so, it can
continue to next steps. If not it generates DNS records which need to
be added into DNS system.</p></li>
<li><p>Set trust flags of server certificate (usually called Server-Cert) in
/etc/httpd/alias NSS DB to “P,,”. The “P” flag in SSL section means
that the cert is trusted even if we don’t know the issuer.</p></li>
<li><p>Set NSSOCSP directive to ‘on’ in /etc/httpd/conf.d/nss.conf in
VirtualHost section. For this step, Augeas might be used as it has
Lens for HTTPD configuration files.</p></li>
<li><p>The OCSP configuration status will be written to sysupgrade file, so
that subsequent upgrades of FreeIPA deployments do not break the
configuration requested by the system admin.</p></li>
</ol>
<p>The reversal script for turning of OSCP check will do steps above in
reversal order. The only thing which will be skipped is step 1.</p>
</section>
<section id="pkinit">
<h2>PKINIT<a class="headerlink" href="#pkinit" title="Permalink to this heading">¶</a></h2>
<p>The script will check the PKINIT status on the master (e.g. by running
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">pkinit-status</span> <span class="pre">--server</span> <span class="pre">FQDN</span></code>) and if it is not configured, will
then use IPA CA to issue PKINIT key pair for KDC.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>TBD</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<p>After calling <code class="docutils literal notranslate"><span class="pre">ipa-advise</span></code> with the specified topic, the output can be
piped to a shell script that will configure the desired functionality on
the master.</p>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>No UI required.</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ipa-advise</span></code> has new topics:</p>
<section id="enable-client-certificate-logins-on-server">
<h3>enable_client_certificate_logins_on_server<a class="headerlink" href="#enable-client-certificate-logins-on-server" title="Permalink to this heading">¶</a></h3>
<p>Checks the status of PKINIT, OCSP and HTTP principal flags on the master
and then configures the individual components required to enable
SmartCard authentication against IPA master</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Topic</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ipa-advise</p></td>
<td><p>enable_client_certificate_logins_on_server</p></td>
</tr>
</tbody>
</table>
</section>
<section id="enable-client-certificate-logins-on-clients">
<h3>enable_client_certificate_logins_on_clients<a class="headerlink" href="#enable-client-certificate-logins-on-clients" title="Permalink to this heading">¶</a></h3>
<p>This recipe will configure the client-side of Smart Card authentication
(pam, gdm, Kerberos client library, etc.)</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Topic</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ipa-advise</p></td>
<td><p>enable_client_certificate_logins_on_clients</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>No configuration required.</p>
</section>
</section>
<section id="upgrade">
<h1>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this heading">¶</a></h1>
<p>In the case of OCSP configuration, the script must be able to store the
state of the feature in upgrade files so that subsequent updates do not
revert the existing configuration.</p>
</section>
<section id="how-to-use">
<h1>How to Use<a class="headerlink" href="#how-to-use" title="Permalink to this heading">¶</a></h1>
<p>Example 1: configure smart card auth on <code class="docutils literal notranslate"><span class="pre">master.example.com</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># kinit admin</span>
<span class="c1"># ipa-advise enable_client_certificate_logins_on_server &gt; configure_smart_cards.sh</span>
<span class="n">trying</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">master1</span><span class="o">.</span><span class="n">ipa</span><span class="o">.</span><span class="n">test</span><span class="o">/</span><span class="n">ipa</span><span class="o">/</span><span class="n">session</span><span class="o">/</span><span class="n">json</span>
<span class="o">...</span>
<span class="c1"># chmod +x configure_smart_cards.sh &amp;&amp; ./configure_smart_cards.sh</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>It should be straightforward to incorporate the newly developed
functionality into existing SmartCard login auth test scenarios since
much of the implemented enhancements can actually replace the existing
manual setup steps required.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Smartcard_authentication_ipa-advise_recipes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>