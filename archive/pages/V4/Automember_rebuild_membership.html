<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Backporting_Capabilities.html" />
    <link rel="prev" title="Overview" href="Automatic_Certificate_Request_Generation.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Integrate the <a class="reference external" href="https://fedorahosted.org/389/ticket/20">rebuild membership
feature</a> of the automember DS
plugin into IPA CLI and Web UI.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>Make sure that user or host membership can be easily rebuilt, based on
new or updated automember rules.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>Add a new CLI command <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">automember-rebuild</span></code>, to rebuild auto
membership for specified entries. Hook the command into web UI
appropriately.</p>
<p>Note that automember rebuild command only <strong>adds</strong> new membership
relationship, it does not remove those that do not match automember
rules.</p>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>The newly added command will invoke the
<code class="docutils literal notranslate"><span class="pre">automember</span> <span class="pre">rebuild</span> <span class="pre">membership</span></code> task, by creating an LDAP entry under
<code class="docutils literal notranslate"><span class="pre">cn=automember</span> <span class="pre">rebuild</span> <span class="pre">membership,cn=tasks,cn=config</span></code>. The details of
automember plugin tasks implementation and usage are described
<a class="reference external" href="https://fedorahosted.org/389/ticket/20#comment:10">here</a>.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>Hook the new command into the web UI: to the user and host pages. Add a
new action ‘Rebuild auto membership’, and place it appropriately on
these pages.</p>
<ul class="simple">
<li><p>On the user search facet, add the new action to the action list. This
makes it possible to rebuild auto membership for multiple users.
Executing the action without selecting any users will run the task
for all the users (using –type=group).</p></li>
<li><p>On the user details facet, add the new action to the action list.
This makes it possible to rebuild automembership for a single user.</p></li>
<li><p>On the host search facet, add the new action to the action list. This
makes it possible to rebuild auto membership for multiple hosts.</p></li>
</ul>
<p>Executing the action without selecting any hosts will run the task for
all the hosts (using –type=hostgroup).</p>
<ul class="simple">
<li><p>On the host details facet, add the new action to the action list.
This makes it possible to rebuild automembership for a single host.</p></li>
</ul>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">automember-rebuild</span></code> can be used to rebuild membership for all
objects of certain type:</p>
<div class="line-block">
<div class="line">``   $ ipa automember-rebuild –type=group``</div>
<div class="line">``   $ ipa automember-rebuild –type=hostgroup``</div>
</div>
<p>It can also be used to rebuild membership for the specified entries:</p>
<div class="line-block">
<div class="line">``   $ ipa automember-rebuild –hosts=HOSTNAME1 –hosts=HOSTNAME2``</div>
<div class="line">``   $ ipa automember-rebuild –users=LOGIN1 –users=LOGIN2``</div>
</div>
</section>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>A new ACI, a permission and a privilege will be created in order to
support creation of automember tasks:</p>
<ul class="simple">
<li><p>privilege: <code class="docutils literal notranslate"><span class="pre">Automember</span> <span class="pre">Task</span> <span class="pre">Administrator</span></code>, which will contain two
permissions listed below</p></li>
<li><p>permission: <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Automember</span> <span class="pre">Rebuild</span> <span class="pre">Membership</span> <span class="pre">Task</span></code></p></li>
<li><p>underlying ACI for the permission listed above</p></li>
</ul>
</section>
<section id="how-to-test">
<span id="how-to-test12"></span><h1>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">¶</a></h1>
<p>Add a hostgroup:</p>
<p>``   $ ipa hostgroup-add –desc=”Web Servers” webservers``</p>
<p>Add a host:</p>
<p>``   $ ipa host-add web1.example.com –force``</p>
<p>Add an automember rule:</p>
<div class="line-block">
<div class="line">``   $ ipa automember-add –type=hostgroup webservers``</div>
<div class="line">``   $ ipa automember-add-condition –key=fqdn –type=hostgroup –inclusive-regex=^web[1-9]+.example.com webservers``</div>
</div>
<p>The automember feature is now working for newly added entries. If we add
a new host, it will be automatically placed in the appropriate
hostgroup:</p>
<div class="line-block">
<div class="line">``   $ ipa host-add web2.example.com –force``</div>
<div class="line">``   $ ipa hostgroup-show webservers``</div>
<div class="line">``     Host-group: webservers``</div>
<div class="line">``     Description: Web Servers``</div>
<div class="line">``     Member hosts: web2.example.com``</div>
</div>
<p>However, the old host entry for <code class="docutils literal notranslate"><span class="pre">web1.example.com</span></code> is still not a
member or the <code class="docutils literal notranslate"><span class="pre">webservers</span></code> hostgroup. By introducting the new
<code class="docutils literal notranslate"><span class="pre">automember-rebuild</span></code> commands, we make it possible:</p>
<p>``   $ ipa automember-rebuild –type=hostgroup``</p>
<p>or</p>
<p>``   $ ipa automember-rebuild –hosts=web1.example.com``</p>
<p>will run the <code class="docutils literal notranslate"><span class="pre">automember</span> <span class="pre">rebuild</span> <span class="pre">membership</span></code> task and consequently
place the host in the appropriate hostgroup:</p>
<div class="line-block">
<div class="line">``   $ ipa hostgroup-show webservers``</div>
<div class="line">``     Host-group: webservers``</div>
<div class="line">``     Description: Web Servers``</div>
<div class="line">``     Member hosts: web2.example.com, web1.example.com``</div>
</div>
<p>The same mechanism applies for users and groups.</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>See
<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/tree/ipatests/test_xmlrpc/test_automember_plugin.py?h=ipa-4-1">test_automember_plugin.py</a>
for the list of test cases.</p>
</section>
<section id="rfe-author">
<h1>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="User:Akrivoka">akrivoka</a> (<a class="reference external" href="User_talk:Akrivoka">talk</a>)</p>
<p><a class="reference external" href="Category:FreeIPA_V4_Test_Plan">Category:FreeIPA V4 Test Plan</a>
<a class="reference external" href="Category:FreeIPA_Test_Plan">Category:FreeIPA Test Plan</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Automember_rebuild_membership.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>