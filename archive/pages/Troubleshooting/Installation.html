<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Server Installation &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="sudo does not work for hostgroups" href="Integration.html" />
    <link rel="prev" title="Replication issues" href="Directory_Server.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>This page contains troubleshooting advice for FreeIPA server
installation. For trouble shooting other issues, refer to the index at
<a class="reference external" href="Troubleshooting">Troubleshooting</a>.</p>
<section id="server-installation">
<span id="id1"></span><h1>Server Installation<a class="headerlink" href="#server-installation" title="Permalink to this heading">¶</a></h1>
<p>When installation crashes, check installation log in
<code class="docutils literal notranslate"><span class="pre">/var/log/ipaserver-install.log</span></code>.</p>
<p>If the installation crashed on installing <a class="reference external" href="PKI">PKI</a> server (Dogtag),
check it’s logs as well. The most useful logs are the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/pki/pki-ca-spawn.$TIME_OF_INSTALLATION.log</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/pki/pki-tomcat/catalina.out</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/pki/pki-tomcat/ca/system</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/pki/pki-tomcat/ca/debug</span></code></p></li>
</ul>
</section>
<section id="pki-selinux-policy-not-loaded-properly">
<span id="id2"></span><h1>pki-selinux policy not loaded properly<a class="headerlink" href="#pki-selinux-policy-not-loaded-properly" title="Permalink to this heading">¶</a></h1>
<p>If you see in <code class="docutils literal notranslate"><span class="pre">ipaserver-install.log</span></code> line:
<code class="docutils literal notranslate"><span class="pre">/usr/bin/runcon:</span> <span class="pre">invalid</span> <span class="pre">context:</span> <span class="pre">unconfined_u:system_r:pki_ca_script_t:s0:</span></code>
<code class="docutils literal notranslate"><span class="pre">Invalid</span> <span class="pre">argument&quot;</span></code> Then the culprit might be that <code class="docutils literal notranslate"><span class="pre">pki-selinux</span></code>
failed to load its policy. The best thing to do is to force re-install
<code class="docutils literal notranslate"><span class="pre">pki-selinux</span></code> (and check for any errors in the /var/log/messages file
or journal).</p>
</section>
<section id="replica-installation">
<span id="id3"></span><h1>Replica Installation<a class="headerlink" href="#replica-installation" title="Permalink to this heading">¶</a></h1>
<p>When installation crashes, check installation log in
<code class="docutils literal notranslate"><span class="pre">/var/log/ipareplica-install.log</span></code>. When CA is being installed on a
replica, check the aforementioned <a class="reference external" href="PKI">PKI</a> logs as well.</p>
<section id="migrating-from-rhel-6-centos-6">
<span id="migrating-from-rhel-6centos-6"></span><h2>Migrating from RHEL 6/CentOS 6<a class="headerlink" href="#migrating-from-rhel-6-centos-6" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Installation of certificate server fails with:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Clone</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">have</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">required</span> <span class="n">certificates</span>
</pre></div>
</div>
<p>It indicates <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1322059">bug
1322059</a>.
Issue is that RHEL6, while creating replica file, uses
certificates from a file which was created during server
installation and potentially contains expired certificates instead
of fetching the certs from database where they are valid. It is
fixed on FreeIPA 3.2+. Recovery is to update the file with valid
certs and then run <code class="docutils literal notranslate"><span class="pre">ipa-replica-prepare</span></code> again and try replica
installation again:</p>
<ol class="arabic">
<li><p>create a /root/dbpass file containing the ‘internal’ (not
‘internaldb’) password from /etc/pki-ca/password</p></li>
<li><p>create a /root/dmpass file containing the DM password</p></li>
<li><p>run PKCS12Export:</p></li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PKCS12Export -debug -d /var/lib/pki-ca/alias -p /root/dbpass -w /root/dmpass -o /root/cacert.p12</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Installation of certificate server fails with:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="k">while</span> <span class="n">updating</span> <span class="n">security</span> <span class="n">domain</span><span class="p">:</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">IOException</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>It indicates <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1256039">bug
1256039</a>.
The issue is that certificate server users on master server has
invalid, usually expired cert, in its database entry even though
all certs tracked by certmonger are valid. Recovery is to update
the database entry with correct certificate. Run following script
or use manual method is described at <a class="reference external" href="https://www.redhat.com/archives/freeipa-users/2016-April/msg00143.html">freeipa users list
mail</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /usr/share/pki/scripts/restore-subsystem-user.py -v</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</section>
<section id="replica-installation-fails-with-invalid-credentials">
<span id="id4"></span><h2>Replica Installation fails with Invalid Credentials<a class="headerlink" href="#replica-installation-fails-with-invalid-credentials" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Installation of the replica fails with:</p></li>
</ul>
<div class="line-block">
<div class="line">``  [27/40]: setting up initial replication``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Starting replication, please wait until this has completed.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Update in progress, 15 seconds elapsed</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">`1</span></code> &lt;<a class="reference external" href="ldap://master.example.com:389">ldap://master.example.com:389</a>&gt;`__`` reports: Update failed! Status: [49  - LDAP error: Invalid credentials]``</div>
<div class="line">``  [error] RuntimeError: Failed to start replication``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Your system may be partly configured.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Run /usr/sbin/ipa-server-install --uninstall to clean up.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa.ipapython.install.cli.install_tool(CompatServerReplicaInstall): ERROR    Failed to start replication</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa.ipapython.install.cli.install_tool(CompatServerReplicaInstall): ERROR    The ipa-replica-install command failed. See /var/log/ipareplica-install.log for more information</span></code></div>
</div>
<p>This can happen when the ipa-replica-install command is called with
–no-ntp and the clocks of the master and the replica are not in sync.
Once they are synchronized (either manually or with NTP or chrony),
ipa-replica-install should succeed</p>
</section>
</section>
<section id="client-installation">
<span id="id5"></span><h1>Client Installation<a class="headerlink" href="#client-installation" title="Permalink to this heading">¶</a></h1>
<p>When installation does not work as expected, check installation log in
<code class="docutils literal notranslate"><span class="pre">/var/log/ipaclient-install.log</span></code>. You can run installation in verbose
mode if you run <code class="docutils literal notranslate"><span class="pre">ipa-client-install</span></code> with <code class="docutils literal notranslate"><span class="pre">--debug</span></code> option. (Log
files always contain debug information, so you do not need to re-run
installation with <code class="docutils literal notranslate"><span class="pre">--debug</span></code> option.)</p>
<section id="installation-breaks-on-decoding-downloading-ca-certificate">
<span id="installation-breaks-on-decodingdownloading-ca-certificate"></span><h2>Installation breaks on decoding/downloading CA certificate<a class="headerlink" href="#installation-breaks-on-decoding-downloading-ca-certificate" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>`ipa-client-install` may crash with error like</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ipalib.errors.LDAPError:</span> <span class="pre">failed</span> <span class="pre">to</span> <span class="pre">decode</span> <span class="pre">certificate:</span> <span class="pre">(SEC_ERROR_INVALID_ARGS)</span> <span class="pre">security</span> <span class="pre">library:</span> <span class="pre">invalid</span> <span class="pre">arguments.</span></code></p>
</div></blockquote>
</li>
<li><p>This may mean that <a class="reference external" href="PKI">PKI</a> CA Certificate stored in LDAP was
not properly imported during upgrade in some of the older versions</p></li>
<li><p>Verify that the CA certificate is stored correctly</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ldapsearch</span> <span class="pre">-h</span> <span class="pre">your.ipa.server.fqdn</span> <span class="pre">-x</span> <span class="pre">-b</span> <span class="pre">&quot;cn=CAcert,cn=ipa,cn=etc,dc=example,dc=test&quot;</span></code></p>
</div></blockquote>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">cACertificate;binary</span></code> should contain the encoded certificate,
typically starting with <code class="docutils literal notranslate"><span class="pre">MII</span></code> characters</p></li>
<li><p>If the certificate is missing, go to any FreeIPA master to let
updater regenerate it:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">kinit</span> <span class="pre">admin</span></code>
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ldapdelete</span> <span class="pre">-Y</span> <span class="pre">GSSAPI</span> <span class="pre">&quot;cn=CAcert,cn=ipa,cn=etc,dc=example,dc=test&quot;</span></code>
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ipa-ldap-updater</span> <span class="pre">--upgrade</span></code></p>
</div></blockquote>
</li>
</ul>
</section>
<section id="failed-to-update-dns-records">
<span id="id6"></span><h2>Failed to update DNS records<a class="headerlink" href="#failed-to-update-dns-records" title="Permalink to this heading">¶</a></h2>
<p>When client cannot update the DNS record in FreeIPA managed DNS zone:</p>
<ul class="simple">
<li><p>Make sure that the respective FreeIPA DNS zone has <em>Dynamic Updates</em>
option enabled:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">$ ipa dnszone-mod zone.name.example. --dynamic-update=TRUE</span></code></p>
<ul class="simple">
<li><p>Make sure that the FreeIPA server with DNS service has port 53 opened
for <strong>both UDP and TCP</strong> (<a class="reference external" href="https://www.redhat.com/archives/freeipa-users/2015-March/msg00693.html">related user
case</a>)</p></li>
</ul>
</section>
<section id="installation-breaks-on-joining-realm">
<span id="id7"></span><h2>Installation breaks on Joining realm<a class="headerlink" href="#installation-breaks-on-joining-realm" title="Permalink to this heading">¶</a></h2>
<p>ipa-client-install may fail with the following error:</p>
<div class="line-block">
<div class="line">`` Joining realm failed: Failed to add key to the keytab``</div>
<div class="line">`` child exited with 11``</div>
<div class="line">`` ``</div>
<div class="line">`` Installation failed. Rolling back changes.``</div>
</div>
<p>This failure may be caused by an empty /etc/krb5.keytab. In this case,
simply delete the file and restart the installation.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/Troubleshooting/Installation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>