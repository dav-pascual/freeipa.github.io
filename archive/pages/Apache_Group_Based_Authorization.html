<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>*** DRAFT VERSION - WORK IN PROGRESS TO BE COMPLETED *** &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Introduction" href="Apache_SNI_With_Kerberos.html" />
    <link rel="prev" title="&lt;no title&gt;" href="Akrivoka.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="draft-version-work-in-progress-to-be-completed">
<span id="id1"></span><h1>*** DRAFT VERSION - WORK IN PROGRESS TO BE COMPLETED ***<a class="headerlink" href="#draft-version-work-in-progress-to-be-completed" title="Permalink to this heading">¶</a></h1>
<p>Following on from the previous documentation for an IPA backend to
protect Apache it’s not unusual to require only a subset of users to
have access to a system rather than all valid users.</p>
<p>There’s two approaches that will be taken in this document - the first
will be PAM based authentication and the second will be extended the
previous kerberos configuration with LDAP groups. There are pros and
cons to each direction and each are suitable for different scenarios
dependant on the use case.</p>
<p>Using PAM authentication</p>
<p>With the EPEL repository enabled installing the mod_auth_pam package
will install teh module, add a configuration file to httpd to enable the
module and place an httpd file in /etc/pam.d for the PAM configuration.</p>
<p>The default is to use whatever is in /etc/pam.d/password-auth but this
may be overkill. To just use SSSD all that is needed is:</p>
<div class="line-block">
<div class="line">`` auth        required      pam_env.so``</div>
<div class="line">`` auth        sufficient    pam_sss.so ``</div>
<div class="line">`` auth        required      pam_deny.so``</div>
<div class="line">`` account     sufficient    pam_sss.so``</div>
<div class="line">`` account     required      pam_deny.so``</div>
</div>
<p>To allow httpd to talk to PAM with selinux enabled a boolean needs to be
set:</p>
<p>`` setsebool -P allow_httpd_mod_auth_pam on``</p>
<p>With that in place it’s simple enough to add user/group behaviour via
adding the appropriate entries for the directory or location concerned
in the conf files or .htaccess:</p>
<div class="line-block">
<div class="line">`` AuthPAM_Enabled on``</div>
<div class="line">`` AuthType Basic``</div>
<div class="line">`` AuthName “Group Restricted  Server”``</div>
<div class="line">`` require valid-user``</div>
</div>
<p>Pros</p>
<p>This will work with the HBAC options/pages in IPA (add httpd as a
service) so allow for testing of rules. A user won’t be considered
‘valid’ unless it can pass the HBAC tests. This way controls can be
centralized with a standardized httpd config or standard users have very
simple copy/paste to go into .htaccess over multiple servers very
easily. This also does not require any sort of ldap service user to bind
as (and consequently any plain text passwords anywhere) since it is the
system carrying out the check via the secure kerberos/ldap mechanism
through SSSD. Optionally rather than require valid-user require group
can be used - with the downside this wouldn’t be visible in the IPA UI
and HBAC would still need to be completed so it could confuse in
troubleshooting.</p>
<p>Cons</p>
<p>Depending on httpd activity this has the potential for being fairly
heavy on load - principally due to HBAC having a fairly short cache
time. This may or may not be a problem depending on the use case of the
httpd server. This only offers basic auth so no single sign on would be
available - if that’s a desirable feature.</p>
<p>Using LDAP groups alongside Kerberos Authentication</p>
<p><a class="reference external" href="Apache_SNI_With_Kerberos">With Kerberos already working</a> we can add
LDAP groups via mod_authnz_ldap which is included in the base httpd
install. The important lines to look at for basic lockdown via groups
are:</p>
<div class="line-block">
<div class="line">`` AuthLDAPURL   ``</div>
<div class="line">`` AuthLDAPBindDN    ``</div>
<div class="line">`` AuthLDAPBindPassword  ``</div>
<div class="line">`` require ldap-group``</div>
</div>
<p>The bind user and password are only required if anonymous lookups are
disabled (which is preferred in general).</p>
<p>First a dedicated system user should be created to use to bind with. To
do this create a file (eg httpbind.ldif) containing the following:</p>
<div class="line-block">
<div class="line">`` dn: uid=httpbind,cn=sysaccounts,cn=etc,dc=example,dc=com``</div>
<div class="line">`` changetype: add``</div>
<div class="line">`` objectclass: account``</div>
<div class="line">`` objectclass: simplesecurityobject``</div>
<div class="line">`` uid: httpbind``</div>
<div class="line">`` userPassword: ohaimakethissimethingtoughtobreak``</div>
<div class="line">`` passwordExpirationTime: 20380119031407Z``</div>
<div class="line">`` nsIdleTimeout: 0``</div>
</div>
<p>This can then be imported by:</p>
<p>`` ldapmodify -h ipa01.example.com -p 389 -x -D “cn=Directory  Manager” -w <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">`` -f httpbind.ldif</span></code></p>
<p>Now the configuration can be carried out. Full details can be found
<a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html">here</a> but
in brief…</p>
<div class="line-block">
<div class="line">`` AuthLDAPURL   <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">```ldaps://ipa01.example.com:636/dc=example,dc=com</span></code> &lt;ldaps://ipa01.example.com:636/dc=example,dc=com&gt;`__</div>
<div class="line">`` AuthLDAPBindDN    uid=httpbind,cn=sysaccounts,cn=etc,dc=example,dc=com``</div>
<div class="line">`` AuthLDAPBindPassword  ohaimakethissimethingtoughtobreak``</div>
<div class="line">`` require ldap-group``</div>
<div class="line">`` LDAPTrustedGlobalCert CA_BASE64 /etc/httpd/certs/ca.crt``</div>
<div class="line">`` AuthLDAPGroupAttributeIsDN off``</div>
<div class="line">`` ``</div>
</div>
<p>Make sure that /etc/ipa/ca.crt has been copied to a location that httpd
can read (such as /etc/httpd/certs/ca.crt if following the previous
guide).</p>
<p><a class="reference external" href="Category:ImproveOrRemove">Category:ImproveOrRemove</a>
<a class="reference external" href="Category:NoLink">Category:NoLink</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Apache_Group_Based_Authorization.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>