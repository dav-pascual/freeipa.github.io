<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Enable DNSSEC support in FreeIPA &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Classless IN-ADDR.ARPA delegation" href="DNS_classless_IN-ADDR.ARPA_delegation.html" />
    <link rel="prev" title="generate user certificate for user account" href="Client_Certificate_Authentication_with_LDAP.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="enable-dnssec-support-in-freeipa">
<span id="id1"></span><h1>Enable DNSSEC support in FreeIPA<a class="headerlink" href="#enable-dnssec-support-in-freeipa" title="Permalink to this heading">¶</a></h1>
<p>Steps to enable DNSSEC support:</p>
<ul class="simple">
<li><p>choose one server which will act as DNSSEC key master</p></li>
<li><p>enable DNSSEC signing for individulal DNS zones</p></li>
</ul>
<section id="dnssec-key-master">
<span id="id2"></span><h2>DNSSEC key master<a class="headerlink" href="#dnssec-key-master" title="Permalink to this heading">¶</a></h2>
<p>To enable DNSSEC in FreeIPA topology, exactly one FreeIPA replica has to
act as <em>the DNSSEC key master</em>. This replica is responsible for proper
key generation and rotation.</p>
<p>Zone signing will not work without DNSSEC key master replica.</p>
<p>Following command will install DNSSEC key master role to a replica. This
command can be run on FreeIPA server which is already configured as
FreeIPA DNS server:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre"># ipa-dns-install --dnssec-master</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">The log file for this installation can be found in /var/log/ipaserver-install.log</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">==============================================================================</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This program will setup DNS for the FreeIPA Server.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This includes:</span></code></div>
<div class="line">``  * Configure DNS (bind)``</div>
<div class="line">``  * Configure SoftHSM (required by DNSSEC)``</div>
<div class="line">``  * Configure ipa-dnskeysyncd (required by DNSSEC)``</div>
<div class="line">``  * Configure ipa-ods-exporter (required by DNSSEC key master)``</div>
<div class="line">``  * Configure OpenDNSSEC (required by DNSSEC key master)``</div>
<div class="line">``  * Generate DNSSEC master key (required by DNSSEC key master)``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">NOTE: DNSSEC zone signing is not enabled by default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">DNSSEC support is experimental!</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Plan carefully, current version doesn't allow you to move DNSSEC</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">key master to different server and master cannot be uninstalled</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">To accept the default shown in brackets, press the Enter key.</span></code></div>
<div class="line"><strong>``Do````````you````````want````````to````````setup````````this````````IPA````````server````````as````````DNSSEC````````key````````master?````````[no]:````````yes``</strong></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Existing BIND configuration detected, overwrite? [no]: yes</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
<p>Please verify the file <em>kasp.xml</em> (<em>/etc/opendnssec/kasp.xml</em>) if it
satisfies your DNSSEC configuration requirements.</p>
</section>
<section id="enable-zone-signing">
<span id="id3"></span><h2>Enable zone signing<a class="headerlink" href="#enable-zone-signing" title="Permalink to this heading">¶</a></h2>
<p>Zones are not signed by default. Zone signing has to be enabled per zone
using following command:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa dnszone-add example.test. --dnssec=true</span></code></div>
<div class="line">``  Zone name: example.test.``</div>
<div class="line">``  Active zone: TRUE``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">. . .</span></code></div>
<div class="line">`` Allow query: any;``</div>
<div class="line">`` Allow transfer: none;``</div>
<div class="line">`` <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">**``Allow</span></code><a href="#id4"><span class="problematic" id="id5">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``in-line</span></code><a href="#id6"><span class="problematic" id="id7">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``DNSSEC</span></code><a href="#id8"><span class="problematic" id="id9">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``signing:</span></code><a href="#id10"><span class="problematic" id="id11">``</span></a><a href="#id12"><span class="problematic" id="id13">``</span></a><a href="#id14"><span class="problematic" id="id15">``</span></a>TRUE``**</div>
</div>
<p>or</p>
<p><code class="docutils literal notranslate"><span class="pre">$ ipa dnszone-mod example.test. --dnssec=true</span></code></p>
<p>To disable zone signing use command:</p>
<p><code class="docutils literal notranslate"><span class="pre">$ ipa dnszone-mod example.test. --dnssec=false</span></code></p>
</section>
</section>
<section id="signing-zones-in-freeipa">
<span id="id16"></span><h1>Signing zones in FreeIPA<a class="headerlink" href="#signing-zones-in-freeipa" title="Permalink to this heading">¶</a></h1>
<section id="add-a-zone-to-be-signed">
<span id="id17"></span><h2>Add a zone to be signed<a class="headerlink" href="#add-a-zone-to-be-signed" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ipa dnszone-add example.test. --dnssec=true</span></code></p>
<p>or</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa dnszone-add example.test.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa dnszone-mod --dnssec=true</span></code></div>
</div>
</section>
<section id="verify-if-zone-is-signed">
<span id="id18"></span><h2>Verify if zone is signed<a class="headerlink" href="#verify-if-zone-is-signed" title="Permalink to this heading">¶</a></h2>
<p>Verify using <em>dig</em> utility if answer contains RRSIG record. This may
take a few minutes until proper key are distributed to all replicas in
topology.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ dig &#64;server.ipa.test. +dnssec example.test. SOA</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; Got answer:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41379</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 3, ADDITIONAL: 2</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; OPT PSEUDOSECTION:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">; EDNS: version: 0, flags: do; udp: 4096</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; QUESTION SECTION:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;example.test.         IN  SOA</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; ANSWER SECTION:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test.      86400   IN  SOA    server.ipa.test. hostmaster.example.test. 1426005184 3600 900 1209600 3600</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test.      86400   IN  ``\</span> <span class="pre">**``RRSIG``**\</span> <span class="pre">``  SOA 8 2 86400 20150409163304 20150310153304 30144 example.test. 8Q1g1wXlJ0647pTF7rhGsZDrkxzq8QGdcviraEEityhS9/2lvMz6tem6 ...</span></code></div>
</div>
</section>
<section id="key-types-ksk-and-zsk">
<span id="id19"></span><h2>Key types: KSK and ZSK<a class="headerlink" href="#key-types-ksk-and-zsk" title="Permalink to this heading">¶</a></h2>
<p>DNSSEC zones typically contain two types of DNSSEC keys.</p>
<dl class="simple">
<dt>KSK</dt><dd><p>Key Signing Key-pair (long term)
Private key is used to sign ZSK
Public key exposed in <strong>DNSKEY 257</strong> record is used to verify
signatures over ZSK. Hash of the public KSK is stored in DS record in
the parent zone to create the chain of trust from parent to child
zones.
This key is used for signing DNSKEY records in zone.</p>
</dd>
<dt>ZSK</dt><dd><p>Zone Signing Key-pair
Private key is used to sign records
Public key exposed in <strong>DNSKEY 256</strong> record is used to verify
signatures over other resource records in the DNS zone.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ dig +rrcomments example.test. DNSKEY</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; ANSWER SECTION:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test.      86400   IN  ``\</span> <span class="pre">**``DNSKEY</span></code><a href="#id20"><span class="problematic" id="id21">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``257``**\</span> <span class="pre">`` 3 8 AwEAAbxszl5h9Mag1AG2uTsBCoR7oIgfTm3bU8H10bcaNiUrkqpPUXq+ ... ; KSK; alg = RSASHA256; key id = 60466</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test.      86400   IN  ``\</span> <span class="pre">**``DNSKEY</span></code><a href="#id22"><span class="problematic" id="id23">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``256``**\</span> <span class="pre">`` 3 8 AwEAAfxpqvJhHDzNwH9Lhm0H9qyzxRSG8Kpt2AGpg6J6RqHtBtZrYB1J ... ; ZSK; alg = RSASHA256; key id = 30144</span></code></div>
</div>
<p>On <strong>DNSSEC key master</strong> all currently used keys can be shown using
following command (replace <code class="docutils literal notranslate"><span class="pre">ods-enforcer</span></code> by <code class="docutils literal notranslate"><span class="pre">ods-ksmutil</span></code> on RHEL
7):</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ sudo -u ods SOFTHSM2_CONF=/etc/ipa/dnssec/softhsm2.conf ods-enforcer key list --verbose</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">SQLite database set to: /var/opendnssec/kasp.db</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Keys:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Zone:           Keytype:  State:  Date of next transition (to):  Size:   Algorithm: CKA_ID:                           Repository:               Keytag:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test    ZSK       active  2015-06-08 12:33:00 (retire)   2048    8          069ee3ece56beee7129ea18494331b35  SoftHSM                   30144</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test    ``\</span> <span class="pre">**``KSK``**\</span> <span class="pre">``      ``\</span> <span class="pre">**``ready``**\</span> <span class="pre">``   ``\</span> <span class="pre">**``waiting</span></code><a href="#id24"><span class="problematic" id="id25">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``for</span></code><a href="#id26"><span class="problematic" id="id27">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``ds-seen</span></code><a href="#id28"><span class="problematic" id="id29">``</span></a><a href="#id30"><span class="problematic" id="id31">``</span></a><a href="#id32"><span class="problematic" id="id33">``</span></a>(active)``**``   2048    8          7d44dc987ef258ce0b88c81550d4e319  SoftHSM                   <a href="#id34"><span class="problematic" id="id35">``</span></a><strong>``60466``</strong></div>
</div>
</section>
<section id="get-the-ds-record">
<span id="id36"></span><h2>Get the DS record<a class="headerlink" href="#get-the-ds-record" title="Permalink to this heading">¶</a></h2>
<p>The DS record of the zone, has to be uploaded to parent zone, otherwise
chain of trust can not be completed.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ dig example.test. DNSKEY &gt; dnskey.txt</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ dnssec-dsfromkey -f dnskey.txt -2 example.test</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test. IN DS ``\</span> <span class="pre">**``60466``**\</span> <span class="pre">`` 8 2 0A758A8B28B7D1A9467D3E91E9699C0ECA381E18AFFCF7C4EB7955E24ED87956</span></code></div>
</div>
<p>Output of the <em>dnssec-dsfromkey</em> is the DS record for zone
<em>example.test.</em>, which has to be uploaded to parent zone, e.g. <em>test.</em>.</p>
</section>
<section id="add-ds-record-into-parent-zone">
<span id="id37"></span><h2>Add DS record into parent zone<a class="headerlink" href="#add-ds-record-into-parent-zone" title="Permalink to this heading">¶</a></h2>
<p>Following example shows how to add DS record of <em>example.test.</em> zone
into a parent zone <em>test.</em> which is managed by IPA:</p>
<p><code class="docutils literal notranslate"><span class="pre">$ ipa dnsrecords-add test. example.test. --ns-rec=ns.example.test.  ``\</span> <span class="pre">**</span></code>–ds-rec=”60466``<a href="#id38"><span class="problematic" id="id39">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``8</span></code><a href="#id40"><span class="problematic" id="id41">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``2</span></code><a href="#id42"><span class="problematic" id="id43">``</span></a><a href="#id44"><span class="problematic" id="id45">``</span></a><a href="#id46"><span class="problematic" id="id47">``</span></a>0A758A8B28B7D1A9467D3E91E9699C0ECA381E18AFFCF7C4EB7955E24ED87956”<a href="#id48"><span class="problematic" id="id49">``</span></a><a href="#id50"><span class="problematic" id="id51">**</span></a></p>
<p>DS record has to be added to the same name as NS record (delegation)
<strong>in the parent zone</strong>.</p>
<p>The procedure to add DS record will be different if you are not using
FreeIPA for managing the parent zone but the end goal is the same - you
need to get DS records added to the parent zone to establish chain of
trust from the parent zone.</p>
</section>
<section id="confirm-ds-record-upload">
<span id="id52"></span><h2>Confirm DS record upload<a class="headerlink" href="#confirm-ds-record-upload" title="Permalink to this heading">¶</a></h2>
<p>Verify that DS record is available from the parent zone:</p>
<div class="line-block">
<div class="line"><a href="#id53"><span class="problematic" id="id54">``</span></a>$ dig +rrcomments example.test DS ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test       86400   IN  DS  ``\</span> <span class="pre">**``60466``**\</span> <span class="pre">`` 8 2 0A758A8B ...</span></code></div>
</div>
<p>After successfull DS record upload to the parent zone, the following
command has to be executed on DNSSEC key master server to enable key
rotation. Keytag value has to match KSK keytag as shown in outputs
above:</p>
<p><a href="#id55"><span class="problematic" id="id56">``</span></a>$ sudo -u ods SOFTHSM2_CONF=/etc/ipa/dnssec/softhsm2.conf ods-enforcer key ds-seen –zone example.test –keytag <a href="#id57"><span class="problematic" id="id58">``</span></a><strong>``60466``</strong></p>
<p><em>ds-seen</em> command will allow the KSK to proceed to the next state:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ sudo -u ods SOFTHSM2_CONF=/etc/ipa/dnssec/softhsm2.conf ods-enforcer key list --verbose</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">SQLite database set to: /var/opendnssec/kasp.db</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Keys:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Zone:           Keytype:  State:  Date of next transition (to):  Size:   Algorithm: CKA_ID:                           Repository:               Keytag:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test    ZSK       active  2015-06-08 12:33:00 (retire)   2048    8          069ee3ece56beee7129ea18494331b35  SoftHSM                   30144</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">example.test    ``\</span> <span class="pre">**``KSK``**\</span> <span class="pre">``       ``\</span> <span class="pre">**``ready``**\</span> <span class="pre">``   ``\</span> <span class="pre">**``2016-03-09</span></code><a href="#id59"><span class="problematic" id="id60">``</span></a><code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``11:34:38</span></code><a href="#id61"><span class="problematic" id="id62">``</span></a><a href="#id63"><span class="problematic" id="id64">``</span></a><a href="#id65"><span class="problematic" id="id66">``</span></a>(retire)``**``   2048    8          7d44dc987ef258ce0b88c81550d4e319  SoftHSM                   <a href="#id67"><span class="problematic" id="id68">``</span></a><strong>``60466``</strong></div>
</div>
</section>
<section id="verify-dnssec-chain-of-trust">
<span id="id69"></span><h2>Verify DNSSEC chain of trust<a class="headerlink" href="#verify-dnssec-chain-of-trust" title="Permalink to this heading">¶</a></h2>
<p>If DS record was successfully uploaded to parent zone, the check if
chain of trust can be established should follow, to make sure the
records from zone will pass the DNSSEC validation on DNS servers.</p>
<p>For example this can be done via <code class="docutils literal notranslate"><span class="pre">drill</span></code> utility:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">drill -TD example.test. -k /etc/trusted-key.key</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">drill -TD example.test. SOA -k /etc/trusted-key.key</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">drill -TD host.example.test. A -k /etc/trusted-key.key</span></code></div>
</div>
<p>All keys/records should be marked as [T] trusted.</p>
</section>
</section>
<section id="dnssec-in-isolated-networks">
<span id="id70"></span><h1>DNSSEC in isolated networks<a class="headerlink" href="#dnssec-in-isolated-networks" title="Permalink to this heading">¶</a></h1>
<section id="create-signed-root-zone">
<span id="id71"></span><h2>Create signed root zone<a class="headerlink" href="#create-signed-root-zone" title="Permalink to this heading">¶</a></h2>
<p>How to create the root zone is explained in article <a class="reference external" href="Howto/DNS_in_isolated_networks">DNS in isolated
networks</a>. Please note that update of
root hints will be required on all recursive clients as noted in the
linked article.</p>
<p>Do not forget to install DNSSEC key master before you enable DNSSEC
signing.</p>
<p>You can enable DNSSEC zone signing for it:</p>
<p><code class="docutils literal notranslate"><span class="pre">$ ipa dnszone-mod . --dnssec=true</span></code></p>
</section>
<section id="configure-trusted-key-on-clients">
<span id="id72"></span><h2>Configure trusted key on clients<a class="headerlink" href="#configure-trusted-key-on-clients" title="Permalink to this heading">¶</a></h2>
<p>Local resolvers need to know KSK of your root zone because it is entry
point to the chain of trust from root zone to all other zones.</p>
<p>Get the KSK key of your root zone:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ dig &#64;localhost  . DNSKEY</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; QUESTION SECTION:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;.             IN  DNSKEY</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">;; ANSWER SECTION:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">.          86400   IN  DNSKEY  256 3 8 AwEAAdsQWj6AM8dVdvgRPw87DaSWRa2w7oknABSepVwhDlOLpxicOS+n ...</span></code></div>
<div class="line"><strong>``.````````86400````````IN````````DNSKEY````````257````````3````````8````````AwEAAdsNYeNTZMVgvWYAEIv+w0PujAmWtcSF15rvsPP25X2lFkgIg+QT````````JLqHzaughLdjduMUCGJwLfG7O4IUIIhqApwLAbQ+GYfrRSaETPPc9z/X````````AGtqiOn/EYj3BcO95wJPcubXxOukHrXcZ/Pt153EkMHyBGTHcsYDA1rD````````qwN5S+IY4PxlhilSth0e427bSJx18huQogR/O0iu6hkKNoFUAflG697P````````a88FJMwL0l6BSJR3WCi/lT0HuX4c4nNKpolaJX3dJoZphGiCsFRmZ67l````````Vswrk88vkVKeD4JLZAq5wJd78IFO8Jd0gSwQY5Q0LxnArcl2yn1d2uSt````````Fcs8Xgl7E1s=``</strong></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
<p>Put your root zone KSK (denoted by flag value <strong>257</strong>) into
<em>trusted-key.key</em> file on all DNSSEC clients:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ cat /etc/trusted-key.key</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">.          86400   IN  DNSKEY  257 3 8 AwEAAdsNYeNTZMVgvWYAEIv+w0PujAmWtcSF15rvsPP25X2lFkgIg+QT JLqHzaughLdjduMUCGJwLfG7O4IUIIhqApwLAbQ+GYfrRSaETPPc9z/X AGtqiOn/EYj3BcO95wJPcubXxOukHrXcZ/Pt153EkMHyBGTHcsYDA1rD qwN5S+IY4PxlhilSth0e427bSJx18huQogR/O0iu6hkKNoFUAflG697P a88FJMwL0l6BSJR3WCi/lT0HuX4c4nNKpolaJX3dJoZphGiCsFRmZ67l Vswrk88vkVKeD4JLZAq5wJd78IFO8Jd0gSwQY5Q0LxnArcl2yn1d2uSt Fcs8Xgl7E1s=</span></code></div>
</div>
</section>
</section>
<section id="migrate-dnssec-master-to-another-ipa-server">
<span id="id73"></span><h1>Migrate DNSSEC master to another IPA server<a class="headerlink" href="#migrate-dnssec-master-to-another-ipa-server" title="Permalink to this heading">¶</a></h1>
<p>Supported on version: <strong>IPA 4.2+</strong></p>
<p>Migration is not recommended. In case of failure DNSSEC caused by
migration, DNSSEC signing may be broken and you may need to recreate new
keys.</p>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>only one DNSSEC master can be active in topology</p></li>
<li><p>DNSSEC master can be migrated only to IPA server where
<em>ipa-dnskeysyncd</em> is running (IPA 4.1+ with installed DNS)</p></li>
<li><p>you have zones with enabled DNSSEC signing</p>
<ul>
<li><p>if you do not have any zones with DNSSEC signing enabled, you can
just disable dnssec master</p></li>
</ul>
</li>
</ul>
</section>
<section id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this heading">¶</a></h2>
<section id="disable-current-dnssec-key-master">
<span id="id74"></span><h3>Disable current DNSSEC key master<a class="headerlink" href="#disable-current-dnssec-key-master" title="Permalink to this heading">¶</a></h3>
<p>To disable current DNSSEC master, please reinstall IPA DNS with
<code class="docutils literal notranslate"><span class="pre">--disable-dnssec-master</span></code> option.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre"># ipa-dns-install --disable-dnssec-master</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">The log file for this installation can be found in /var/log/ipaserver-install.log</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">==============================================================================</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This program will setup DNS for the FreeIPA Server.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This includes:</span></code></div>
<div class="line">``  * Configure DNS (bind)``</div>
<div class="line">``  * Configure SoftHSM (required by DNSSEC)``</div>
<div class="line">``  * Configure ipa-dnskeysyncd (required by DNSSEC)``</div>
<div class="line">``  * Unconfigure ipa-ods-exporter``</div>
<div class="line">``  * Unconfigure OpenDNSSEC``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">No new zones will be signed without DNSSEC key master IPA server.</span></code></div>
<div class="line"><a href="#id75"><span class="problematic" id="id76">``</span></a>Please copy file from /var/lib/ipa/ipa-kasp.db.backup after uninstallation. This file is needed on new DNSSEC key ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">master server</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">NOTE: DNSSEC zone signing is not enabled by default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">To accept the default shown in brackets, press the Enter key.</span></code></div>
<div class="line"><a href="#id77"><span class="problematic" id="id78">``</span></a>Do you want to disable current DNSSEC key master? [no]: <a href="#id79"><span class="problematic" id="id80">``</span></a><strong>``yes``</strong></div>
<div class="line"><a href="#id81"><span class="problematic" id="id82">``</span></a>Existing BIND configuration detected, overwrite? [no]: <a href="#id83"><span class="problematic" id="id84">``</span></a><strong>``yes``</strong></div>
<div class="line">`` ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
</section>
<section id="copy-kasp-db-to-safe-location">
<span id="id85"></span><h3>Copy kasp.db to safe location<a class="headerlink" href="#copy-kasp-db-to-safe-location" title="Permalink to this heading">¶</a></h3>
<p>This file will be needed on target server.</p>
<p>`` # scp /var/lib/ipa/ipa-kasp.db.backup <a class="reference external" href="mailto:me&#37;&#52;&#48;my&#46;happy&#46;place">me<span>&#64;</span>my<span>&#46;</span>happy<span>&#46;</span>place</a>:/safe/location/ipa-kasp.db.backup``</p>
</section>
<section id="install-dnssec-key-master-on-target-ipa-server">
<span id="id86"></span><h3>Install DNSSEC key master on target IPA server<a class="headerlink" href="#install-dnssec-key-master-on-target-ipa-server" title="Permalink to this heading">¶</a></h3>
<p>You need kasp.db file from disabled DNSSEC key master, to be able
restore proper key rotation for existing zones.</p>
<p>With option <code class="docutils literal notranslate"><span class="pre">--kasp-db=&lt;path</span> <span class="pre">to</span> <span class="pre">original</span> <span class="pre">kasp.db</span> <span class="pre">file&gt;</span></code> installer does
several additional steps, which. Please do not copy this file to
location where OpenDNSSEC is expecting to find this file, this will not
work.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre"># ipa-dns-install --dnssec-master --kasp-db=/safe/place/ipa-kasp.db.backup</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">The log file for this installation can be found in /var/log/ipaserver-install.log</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">==============================================================================</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This program will setup DNS for the FreeIPA Server.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This includes:</span></code></div>
<div class="line">``  * Configure DNS (bind)``</div>
<div class="line">``  * Configure SoftHSM (required by DNSSEC)``</div>
<div class="line">``  * Configure ipa-dnskeysyncd (required by DNSSEC)``</div>
<div class="line">``  * Configure ipa-ods-exporter (required by DNSSEC key master)``</div>
<div class="line">``  * Configure OpenDNSSEC (required by DNSSEC key master)``</div>
<div class="line">``  * Generate DNSSEC master key (required by DNSSEC key master)``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">NOTE: DNSSEC zone signing is not enabled by default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">DNSSEC support is experimental!</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Plan carefully, replacing DNSSEC key master is not recommended</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">To accept the default shown in brackets, press the Enter key.</span></code></div>
<div class="line"><a href="#id87"><span class="problematic" id="id88">``</span></a>Do you want to setup this IPA server as DNSSEC key master? [no]: <a href="#id89"><span class="problematic" id="id90">``</span></a><strong>``yes``</strong></div>
<div class="line"><a href="#id91"><span class="problematic" id="id92">``</span></a>Existing BIND configuration detected, overwrite? [no]: <a href="#id93"><span class="problematic" id="id94">``</span></a><strong>``yes``</strong></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
</section>
<section id="check-if-dnssec-signing-still-works">
<span id="id95"></span><h3>Check if DNSSEC signing still works<a class="headerlink" href="#check-if-dnssec-signing-still-works" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>show status if DNSSEC/DNS related services are running (except
<em>ipa-ods-exporter</em> service which is run only on-demand)</p></li>
<li><p>check if signed zones are present in OpenDNSSEC ( <a class="reference external" href="Troubleshooting#DNS_keys_are_not_generated_by_OpenDNSSEC">howto
here</a>).</p></li>
<li><p>test DNSSEC signatures of current zones using <code class="docutils literal notranslate"><span class="pre">dig</span> <span class="pre">+dnssec</span></code></p></li>
<li><p>try to add new test zone with enabled DNSSEC signing and test if it
works</p></li>
</ul>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/Howto/DNSSEC.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>