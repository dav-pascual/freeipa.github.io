<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Current &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Introduction" href="Coding_Style.html" />
    <link rel="prev" title="Introduction" href="CloudNarrative.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Long-term ongoing <a class="reference external" href="V4/Refactorings">refactoring</a> means that some
practices you see in FreeIPA’s existing code are considered obsolete.
They should not be used in new code, and old code should be updated when
they are encountered.</p>
<p>Here is a list of these, with examples of the old and new way of doing
things.</p>
<section id="current">
<h1>Current<a class="headerlink" href="#current" title="Permalink to this heading">¶</a></h1>
<section id="decorator-based-plugin-registration">
<span id="id1"></span><h2>Decorator-based plugin registration<a class="headerlink" href="#decorator-based-plugin-registration" title="Permalink to this heading">¶</a></h2>
<p>To allow registering plugins to non-default API objects, plugin
registration changed from:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">from ipalib import api</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">class myobj_mod(LDAPUpdate): ...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">api.register(myobj_mod)</span></code></div>
</div>
<p>to:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">from ipalib.plugable import Registry</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">register = Registry()</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&#64;register()</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">class myobj_mod(LDAPUpdate): ...</span></code></div>
</div>
<p>Note that it’s necessary to name the decorator <code class="docutils literal notranslate"><span class="pre">register</span></code>.</p>
</section>
<section id="split-long-translatable-strings">
<span id="id2"></span><h2>Split long translatable strings<a class="headerlink" href="#split-long-translatable-strings" title="Permalink to this heading">¶</a></h2>
<p>Long translatable strings, such as plugin modules’ <code class="docutils literal notranslate"><span class="pre">__doc__</span></code>, should
be split up by paragraph, so that if something is changed/added, only
the affected part needs to be re-translated. Example:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">__doc__ = _(&quot;&quot;&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Foo Plugin</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;) + _(&quot;&quot;&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This plugin allows management of enterprise foos and bars.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;) + _(&quot;&quot;&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Here is a second paragraph.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;&quot;)</span></code></div>
</div>
<p>Note that the strings should <em>only</em> be split when they are changed,
because after a split all parts have to be re-translated.</p>
</section>
<section id="do-not-use-star-imports">
<span id="id3"></span><h2>Do not use star imports<a class="headerlink" href="#do-not-use-star-imports" title="Permalink to this heading">¶</a></h2>
<p>Star imports make it more difficult to see where names come from, and
names newly added to the imported module can unintentionally shadow
variables elsewhere.</p>
<p>Instead of</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">from baseldap import *</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">class tank_create(LDAPCreate):</span></code></div>
</div>
<p>use</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">from ipalib.plugins import baseldap</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">class tank_create(baseldap.LDAPCreate):</span></code></div>
</div>
<p>or</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">from ipalib.plugins.baseldap import LDAPCreate</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">class tank_create(LDAPCreate):</span></code></div>
</div>
<p>See <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2653">https://fedorahosted.org/freeipa/ticket/2653</a>, and PEP8</p>
</section>
<section id="use-the-admintool-framework-for-installation-management-scripts">
<span id="use-the-admintool-framework-for-installationmanagement-scripts"></span><h2>Use the admintool framework for installation/management scripts<a class="headerlink" href="#use-the-admintool-framework-for-installation-management-scripts" title="Permalink to this heading">¶</a></h2>
<p>There is a framework that standardizes common tasks such as argument
parsing, logging, error handling, interactive prompting. Use it.</p>
<p>For a simple example, see the implementation of
<code class="docutils literal notranslate"><span class="pre">ipa-server-certinstall</span></code>.</p>
<p>Related design concerning the CLI changes: <a class="reference external" href="V3/Logging_and_output">V3/Logging and
output</a></p>
</section>
</section>
<section id="finished">
<h1>Finished<a class="headerlink" href="#finished" title="Permalink to this heading">¶</a></h1>
<p>For these items, all code in IPA was updated and, if applicable, the old
way of doing things was disabled.</p>
<section id="ldapentry-dict-like-api">
<span id="id4"></span><h2>LDAPEntry dict-like API<a class="headerlink" href="#ldapentry-dict-like-api" title="Permalink to this heading">¶</a></h2>
<p>See
<a class="reference external" href="HowTo/Migrate_your_code_to_the_new_LDAP_API">HowTo/Migrate_your_code_to_the_new_LDAP_API</a></p>
<p>A LDAPEntry no longer unpacks to a tuple:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre"># Old code</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn, attrs = entry</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">values = attrs[attrname]</span></code></div>
</div>
<p>Instead, the entry is a dict-like object:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre"># New code</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn = entry.dn</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">values = entry[attrname]</span></code></div>
</div>
<p>To highlight errors, a LDAPEntry currently cannot be iterated.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Coding_Best_Practices.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>