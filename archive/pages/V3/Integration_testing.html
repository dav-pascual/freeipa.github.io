<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Integration_with_provisioning_systems.html" />
    <link rel="prev" title="What are RIDs and RID ranges" href="ID_Ranges.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>__NOTOC__</p>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Ticket: <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3621">#3621</a>
Integrated Automation Testing.</p>
<p>Make it possible to write and run multi-host integration tests (such as:
install master &amp; replica, add user on replica, verify it’s added on
master).</p>
<p>These tests will be run from continuous integration. Any developer can
also run them manually.</p>
</section>
<section id="use-cases">
<span id="use-cases120"></span><h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<section id="continuous-integration">
<span id="id1"></span><h2>Continuous integration<a class="headerlink" href="#continuous-integration" title="Permalink to this heading">¶</a></h2>
<p>The developer team at Red Hat will run a Jenkins continuous integration
server that will run the tests automatically (after each commit if
resources are available).</p>
<p>The CI results will be posted publicly.</p>
</section>
<section id="developer-testing">
<span id="id2"></span><h2>Developer testing<a class="headerlink" href="#developer-testing" title="Permalink to this heading">¶</a></h2>
<p>Anyone is be able to run integration tests without advanced
infrastructure, only a number of virtual machines to run the tests on is
needed.</p>
</section>
<section id="beaker-integration">
<span id="id3"></span><h2>Beaker integration<a class="headerlink" href="#beaker-integration" title="Permalink to this heading">¶</a></h2>
<p>The tests will run seamlessly inside
<a class="reference external" href="http://beaker-project.org/">Beaker</a>/<a class="reference external" href="https://fedoraproject.org/wiki/QA/RHTS">RHTS</a>.
A special option enables reporting via BeakerLib.</p>
</section>
</section>
<section id="non-goals">
<span id="id4"></span><h1>Non-goals<a class="headerlink" href="#non-goals" title="Permalink to this heading">¶</a></h1>
<p>A complete testing/continuous integration setup needs some steps that
will not be included in IPA’s test suite:</p>
<ul class="simple">
<li><p>Building the code</p></li>
<li><p>VM provisioning</p></li>
<li><p>Configuring the basic system, installing the packages</p></li>
</ul>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>The Python package with the IPA test suite is renamed to <code class="docutils literal notranslate"><span class="pre">ipatests</span></code>,
and packaged for RPM-based systems as <code class="docutils literal notranslate"><span class="pre">freeipa-tests</span></code>. Eventually the
package will be included in Fedora.</p>
<p>Integration tests will be controlled from a single machine, and executed
on a number of “remote” machines that act as servers, replicas, clients,
etc. The controlling machine communicates with the others via the SSH
protocol. (The controlling machine may be the same as one of the
“remote” ones.)</p>
<p>Integration tests are included in the main IPA set suite, and configured
using environment variables. If the variables are missing, all
integration tests are skipped. If an insufficient number of hosts is
configured for a test, the individiual test will be skipped.</p>
<p>A tool is provided to run installed tests.</p>
<p>The remote machines used for integration testing are required to have
relevant IPA packages installed, firewall opened up, any needed
workarounds applied (RPM downgrades, SELinux mode,…), and sshd set up
to allow root login. The test runner will connect to these machines,
install IPA, perform the tests, and then uninstall IPA &amp; return the
systems to their previous state.</p>
<p>A plugin for integration with BeakerLib is provided.</p>
</section>
<section id="test-configuration">
<span id="id5"></span><h1>Test configuration<a class="headerlink" href="#test-configuration" title="Permalink to this heading">¶</a></h1>
<p>Tests are configured using these environment variables. For any
additional information, see man ipa-test-config.</p>
<section id="host-configuration">
<span id="id6"></span><h2>Host configuration<a class="headerlink" href="#host-configuration" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt>$MASTER</dt><dd><p>FQDN of the first IPA server</p>
</dd>
<dt>$REPLICA</dt><dd><p>FQDNs of other IPA servers (space-separated)</p>
</dd>
<dt>$CLIENT</dt><dd><p>FQDNs of IPA clients (space-separated)</p>
</dd>
<dt>$MASTER_env2, $REPLICA_env2, $CLIENT_env2, $MASTER_env3, …</dt><dd><p>can be used for additional domains when needed</p>
</dd>
<dt>$BEAKER_env, e.g. $BEAKERREPLICA1_env1</dt><dd><p>the external hostname of the given host; the test framework will
connect using this name
Default: same as the internal FQDN</p>
</dd>
<dt>$BEAKER_IP_env, e.g. $BEAKERREPLICA1_IP_env1</dt><dd><p>the IP address of the given host
Default: resolved via <code class="docutils literal notranslate"><span class="pre">gethostbyname</span></code> (or DNS if $IPv6SETUP is set)</p>
</dd>
<dt>$AD_env1, $AD_env2, $AD_env3, $AD_env4, …</dt><dd><p>can be used to define Active Directory domains. Please note that
these
domains are not treated as separate from the IPA domains, so please
use an
unique environment suffix for each of your Active Directory domains,
e.g. MASTER_env1 and AD_env2</p>
</dd>
</dl>
<p>DNS needs to be set up so that IP addresses can be obtained for these
hosts.</p>
<section id="additional-roles">
<span id="id7"></span><h3>Additional roles<a class="headerlink" href="#additional-roles" title="Permalink to this heading">¶</a></h3>
<p>You can define any additional custom roles that are required by the
tests using the following environment variables.</p>
<dl class="simple">
<dt>$TESTHOST__env, e.g. $TESTHOST_LEGACY_CLIENT_env1</dt><dd><p>FQDN(s) of the -th machine with the extra role</p>
</dd>
<dt>$BEAKER_env, e.g. $BEAKERLEGACY_CLIENT_env1</dt><dd><p>the external hostname(s)</p>
</dd>
<dt>$BEAKER_IP_env, e.g. $BEAKERLEGACY_CLIENT_IP_env1</dt><dd><p>IP address(es) of the machine of the extra role</p>
</dd>
</dl>
<p>If multiple hosts of the same role are needed, separate the values with
a space, e.g.
<code class="docutils literal notranslate"><span class="pre">TESTHOST_LEGACY_CLIENT_env1='lc1.ipa.example.com</span> <span class="pre">lc2.ipa.example.com'</span></code>.</p>
<p>The role name may not end with a number.</p>
</section>
</section>
<section id="basic-configuration">
<span id="id8"></span><h2>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt>$IPATEST_DIR</dt><dd><p>Directory for test data on the remote hosts
Default: /root/ipatests</p>
</dd>
<dt>$DNSFORWARD</dt><dd><p>IP of a DNS forwarder
Default: 8.8.8.8</p>
</dd>
<dt>$IPA_ROOT_SSH_PASSWORD</dt><dd><p>root password for the remote machines
Used if <code class="docutils literal notranslate"><span class="pre">$IPA_ROOT_SSH_KEY</span></code> is not set.</p>
</dd>
<dt>$IPA_ROOT_SSH_KEY</dt><dd><p>name of a file containing the private RSA key for root on the remote
machines
Default: ~/.ssh/id_rsa</p>
</dd>
</dl>
</section>
<section id="test-customization">
<span id="id9"></span><h2>Test customization<a class="headerlink" href="#test-customization" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt>$DOMAIN</dt><dd><p>IPA domain name
Default: taken from $MASTER</p>
</dd>
<dt>$NISDOMAIN</dt><dd><p>NIS domain name
Default: ipatest</p>
</dd>
<dt>$NTPSERVER</dt><dd><p>NIS domain name
Default: ipatest</p>
</dd>
<dt>$IPv6SETUP</dt><dd><p>Set to TRUE for IPv6-only connectivity</p>
</dd>
<dt>$IPADEBUG</dt><dd><p>Set to enable test debugging</p>
</dd>
<dt>$ADMINID</dt><dd><p>Admin username
Default: admin</p>
</dd>
<dt>$ADMINPW</dt><dd><p>Admin user password
Default: Secret123</p>
</dd>
<dt>$ADADMINID</dt><dd><p>Active Directory Administrator username
Default: Administrator</p>
</dd>
<dt>$ADADMINPW</dt><dd><p>Active Directory Administrator password
Default: Secret123</p>
</dd>
<dt>$ROOTDN</dt><dd><p>Directory manager DN
Default: cn=Directory Manager</p>
</dd>
<dt>$ROOTDNPWD</dt><dd><p>Directory manager password
Default: Secret123</p>
</dd>
</dl>
</section>
</section>
<section id="supporting-tools">
<span id="id10"></span><h1>Supporting tools<a class="headerlink" href="#supporting-tools" title="Permalink to this heading">¶</a></h1>
<section id="ipa-test-config">
<span id="id11"></span><h2>ipa-test-config<a class="headerlink" href="#ipa-test-config" title="Permalink to this heading">¶</a></h2>
<p>This tool reads the configuration variables above and outputs a Bash
script that sets a much more complete set of variables for easy
shell-based testing or test set-up.</p>
<p>Without arguments, <code class="docutils literal notranslate"><span class="pre">ipa-test-config</span></code> outputs information specific to
the host it is run on. When given a hostname, it prints config for that
host. With the <code class="docutils literal notranslate"><span class="pre">--global</span></code> flag, it outputs configuration common to all
hosts.</p>
</section>
<section id="ipa-run-tests">
<span id="id12"></span><h2>ipa-run-tests<a class="headerlink" href="#ipa-run-tests" title="Permalink to this heading">¶</a></h2>
<p>This tool is a wrapper arount <code class="docutils literal notranslate"><span class="pre">nosetests</span></code> and accepts the same
arguments as Nose. It loads any additional plugins and runs tests from
the system-installed IPA test suite.</p>
</section>
<section id="ipa-test-task">
<span id="id13"></span><h2>ipa-test-task<a class="headerlink" href="#ipa-test-task" title="Permalink to this heading">¶</a></h2>
<p>Run a test task, respecting to the configuration variables listed above.</p>
<p>The tasks this tool can perform are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">install-topo</span></code>: install IPA on the configured hosts in a chosen
topology</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list-topos</span></code>: list available topologies for <code class="docutils literal notranslate"><span class="pre">install-topo</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">install-master</span></code>: install an initial IPA master <em>(invokes
``ipa-server-install`` on the master)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">install-replica</span></code>: install a IPA replica <em>(invokes
``ipa-replica-install`` on a given replica or all replicas)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">install-client</span></code>: install a IPA client <em>(invokes
``ipa-client-install`` on a given client or all clients)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uninstall-server</span></code>: uninstall an IPA master or replica (invokes
<code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code> on a given server or all
servers)’’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uninstall-client</span></code>: uninstall an IPA client <em>(invokes
``ipa-client-install –uninstall`` on a given client or all clients)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uninstall-all</span></code>: uninstall all servers and clients + clean up</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connect-replica</span></code>: connect two IPA replicas <em>(invokes
``ipa-replica-manage connect`` on a given replica)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">disconnect-replica</span></code>: disconnect two IPA replicas <em>(invokes
``ipa-replica-manage disconnect`` on a given replica)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup</span></code>: clean up a host – restore hostname, resolv.conf, etc.
<em>(this is also called by the ``uninstall-*`` subcommands)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">others</span></code>: see man ipa-test-task for the full list</p></li>
</ul>
<p>Like <code class="docutils literal notranslate"><span class="pre">ipa-run-tests</span></code>, the tool should be run from a dedicated machine
(or “master”).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--with-beakerlib</span></code> option turns on BeakerLib logging, similar to
<code class="docutils literal notranslate"><span class="pre">ipa-run-tests</span></code>.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>Test cases are implemented as Nose test classes, with
installation/uninstallation as class setup/teardown.</p>
<p>A BeakerLib plugin is provided that starts/ends Beaker phases for Nose
test contexts and cases, issues a Beaker assertion (rlPass/rlFail) for
each test case, and collects and submits relevant logs.</p>
<p>A separate plugin will be provided to collect logs outside of a Beaker
environment.</p>
</section>
<section id="ordering-of-the-tests">
<span id="id14"></span><h1>Ordering of the tests<a class="headerlink" href="#ordering-of-the-tests" title="Permalink to this heading">¶</a></h1>
<p>The Nose test classes are by default executed in the alphabetical order.</p>
<p>The test methods within each class are executed in the order they were
defined (the integration testing framework makes use of OrderedTests
nose plugin that achieves this). This gets more complicated with
inheritance. To allow creating new test classes by overriding a few
selected method of the parent class, the methods within one class (this
includes both over-ridden and inherited methods) are executed in the
order of the classes they were first defined in the inheritance chain.
Methods that were introduced in the same class, are executed in the
order they were defined within that class.</p>
</section>
<section id="example-instructions">
<span id="id15"></span><h1>Example instructions<a class="headerlink" href="#example-instructions" title="Permalink to this heading">¶</a></h1>
<p>To run the test called <code class="docutils literal notranslate"><span class="pre">test_integration/test_simple_replication.py</span></code>,
which needs to run with two masters, follow these instructions.</p>
<p>Install the IPA server packages on two machines, and do any preparations
necessary to install IPA (e.g. configure/disable the firewall).</p>
<p>Then, install the <code class="docutils literal notranslate"><span class="pre">freeipa-tests</span></code> package on the machine that will run
the tests (this may be one of the machines above, or preferably a
different one). Set MASTER and REPLICA environment variables to the
fully qualified hostnames of the two machines prepared earlier. Also set
any other relevant variables listed in <a class="reference external" href="#Test_configuration">Test
configuration</a>. You may run
<code class="docutils literal notranslate"><span class="pre">ipa-test-config</span> <span class="pre">--global</span></code> to verify how the test configuration will
be handled.</p>
<p>The next steps depend on whether the test will run within a BeakerLib
session or not.</p>
<section id="with-beakerlib">
<span id="id16"></span><h2>With BeakerLib<a class="headerlink" href="#with-beakerlib" title="Permalink to this heading">¶</a></h2>
<p>Set up a BeakerLib test (e.g. <code class="docutils literal notranslate"><span class="pre">rlJournalStart</span></code>), and run:</p>
<p>``   ipa-run-tests –with-beakerlib –no-skip test_integration/test_simple_replication.py``</p>
<p>The output is somewhat messy as BeakerLib logs are printed to standard
error. Not that output from external hosts is buffered, so installation
may appear hung.</p>
<p>Archive any relevant data (e.g. with <code class="docutils literal notranslate"><span class="pre">rlJournalPrintText</span></code>), and end
the BeakerLib session (<code class="docutils literal notranslate"><span class="pre">rlJournalEnd</span></code>).</p>
</section>
<section id="without-beakerlib">
<span id="id17"></span><h2>Without BeakerLib<a class="headerlink" href="#without-beakerlib" title="Permalink to this heading">¶</a></h2>
<p>Run:</p>
<p>``   ipa-run-tests test_integration/test_simple_replication.py``</p>
<p>As with other Nose tests, no output is shown for test setup
(installation) if nothing goes wrong, so there may be a long time
without output. A summary is printed at the end of the test run.</p>
</section>
</section>
<section id="feature-managment">
<span id="id18"></span><h1>Feature Managment<a class="headerlink" href="#feature-managment" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
<p>See above</p>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>See instructions above.</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
<p>(Note: The tests can theoretically be used to drive hosts with other
versions of IPA packages to test backward/forward compatibility.)</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>The freeipa-test package will depend on some libraries that are already
used for unit tests and other test-related tasks:</p>
<ul class="simple">
<li><p>python-nose</p></li>
<li><p>python-paste</p></li>
<li><p>python-coverage</p></li>
<li><p>python-polib</p></li>
</ul>
<p>Integration testing brings in a dependency on a library for the SSH
protocol:</p>
<ul class="simple">
<li><p>python-paramiko</p></li>
</ul>
<p>Naturally, the new dependencies are not needed in a production
environment.</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>Cooperation with QE is underway.</p>
</section>
<section id="ad-integration">
<span id="id19"></span><h1>AD integration<a class="headerlink" href="#ad-integration" title="Permalink to this heading">¶</a></h1>
<p>A subpage dedicated to the AD integration testing can be found here:
<a class="reference external" href="V3/Integration_testing/AD">V3/Integration_testing/AD</a></p>
</section>
<section id="design-author">
<span id="id20"></span><h1>Design author<a class="headerlink" href="#design-author" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="User:pviktorin">Petr Viktorin</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V3/Integration_testing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>