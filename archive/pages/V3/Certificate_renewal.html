<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>IPA Certificate Renewal &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Configurable_SID_Blacklists.html" />
    <link rel="prev" title="Overview" href="Cert_find.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="ipa-certificate-renewal">
<span id="id1"></span><h1>IPA Certificate Renewal<a class="headerlink" href="#ipa-certificate-renewal" title="Permalink to this heading">¶</a></h1>
<p>{{ admon/important | | This is a design page for a specific feature.
As project evolves it will become outdated and will not be maintained.
It is already known that FreeIPA 3.1 does not exactly work this way. }}</p>
<p>Certificates are valid for a varying period of time, capped by the
validity time of the root CA itself. The server certificates that IPA
issues are automatically renewed by certmonger before they expire. There
is currently no mechanism to renew the CA itself or the certificates it
requires.</p>
<p>The following certificates are issued for our two CA types.</p>
<section id="dogtag-ca">
<span id="id2"></span><h2>Dogtag CA<a class="headerlink" href="#dogtag-ca" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>the root certificate itself (8 years in initial implementation, 15+
years when <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3315">#3315</a>
was implemented )</p>
<ul class="simple">
<li><p>subject name CN=Certificate Authority,O=$REALM</p></li>
<li><p>enrolled using caCACert profile</p></li>
<li><p>private key in /var/lib/$CAINSTANCE/alias as “caSigningCert
cert-$CAINSTANCE”</p></li>
<li><p>exported to /root/cacert.p12 for use on replicas</p></li>
<li><p>stored in CS.cfg as ca.signing.cert</p></li>
<li><p>nickname in CS.cfg as ca.signing.nickname</p></li>
<li><p>copies stored in</p>
<ul>
<li><p>/var/lib/$CAINSTANCE/alias as “caSigningCert cert-$CAINSTANCE”</p></li>
<li><p>/etc/httpd/alias as “$REALM IPA CA”</p></li>
<li><p>/etc/dirsrv/slapd-PKI-CA as “$REALM IPA CA”</p></li>
<li><p>/etc/dirsrv/slapd-$DSINSTANCE as “$REALM IPA CA”</p></li>
<li><p>/etc/ipa/ca.crt</p></li>
</ul>
</li>
</ul>
</li>
<li><p>the OCSP subsystem certificate (2 years)</p>
<ul class="simple">
<li><p>subject name CN=OCSP Subsystem,O=$REALM</p></li>
<li><p>enrolled using caOCSPCert profile</p></li>
<li><p>private key in /var/lib/$CAINSTANCE/alias as “ocspSigningCert
cert-$CAINSTANCE”</p></li>
<li><p>exported to /root/cacert.p12 for use on replicas</p></li>
<li><p>stored in CS.cfg as ca.ocsp_signing.cert</p></li>
<li><p>nickname in CS.cfg as ca.ocsp_signing.nickname</p></li>
</ul>
</li>
<li><p>the CA SSL services certificate (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caServerCert profile</p></li>
<li><p>private key in /var/lib/$CAINSTANCE/alias as “Server-Cert
cert-$CAINSTANCE”</p></li>
<li><p>stored in CS.cfg as ca.sslserver.cert</p></li>
<li><p>nickname in CS.cfg as ca.sslserver.nickname</p></li>
</ul>
</li>
<li><p>CA subsystem certificate (2 years)</p>
<ul class="simple">
<li><p>subject name CN=CA Subsystem,O=$REALM</p></li>
<li><p>enrolled using caServerCert profile</p></li>
<li><p>private key in /var/lib/$CAINSTANCE/alias as “subsystemCert
cert-$CAINSTANCE”</p></li>
<li><p>exported to /root/cacert.p12 for use on replicas</p></li>
<li><p>stored in CS.cfg as ca.subsystem.cert</p></li>
<li><p>nickname in CS.cfg as ca.subsystem.nickname</p></li>
<li><p>published to uid=CA-rapier.bos.redhat.com-9443,ou=people,o=ipaca</p></li>
</ul>
</li>
<li><p>CA audit log certificate (2 years)</p>
<ul class="simple">
<li><p>subject name CN=CA Audit,O=$REALM</p></li>
<li><p>enrolled using caSignedLogCert profile</p></li>
<li><p>private key in /var/lib/$CAINSTANCE/alias as “auditSigningCert
cert-$CAINSTANCE”</p></li>
<li><p>exported to /root/cacert.p12 for use on replicas</p></li>
<li><p>stored in CS.cfg as ca.audit_signing.cert</p></li>
<li><p>nickname in CS.cfg as ca.audit_signing.nickname</p></li>
</ul>
</li>
<li><p>IPA CA agent (2 years)</p>
<ul class="simple">
<li><p>subject name CN=ipa-ca-agent,O=$REALM</p></li>
<li><p>enrolled using caAdminCert profile</p></li>
<li><p>exported to /root/ca-agent.p12</p></li>
<li><p>published to uid=admin,ou=people,o=ipaca</p></li>
</ul>
</li>
<li><p>IPA RA agent (2 years)</p>
<ul class="simple">
<li><p>subject name CN=IPA RA,O=$REALM</p></li>
<li><p>enrolled using caServerCert profile</p></li>
<li><p>private key in /etc/httpd/alias as “ipaCert”</p></li>
<li><p>published to uid=ipara,ou=people,o=ipaca</p></li>
</ul>
</li>
<li><p>IPA service (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caIPAserviceCert profile</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>revoked by IPA RA agent, superseded</p></li>
</ul>
</li>
<li><p>IPA service (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caIPAserviceCert profile</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>revoked by IPA RA agent, superseded</p></li>
</ul>
</li>
<li><p>IPA service (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caIPAserviceCert profile</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>revoked by IPA RA agent, superseded</p></li>
</ul>
</li>
<li><p>CA jar signing (4 years)</p>
<ul class="simple">
<li><p>subject name CN=Object Signing Cert,O=$REALM</p></li>
<li><p>enrolled using caJarSigningCert profile</p></li>
<li><p>private key in /etc/httpd/alias as “Signing-Cert”</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>used to sign browser auto-configuration jar</p></li>
</ul>
</li>
<li><p>IPA service (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caIPAserviceCert profile</p></li>
<li><p>private key in /etc/dirsrv/slapd-$DSINSTANCE as “Server-Cert”</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>monitored by certmonger</p></li>
</ul>
</li>
<li><p>IPA service (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caIPAserviceCert profile</p></li>
<li><p>private key in /etc/dirsrv/slapd-PKI-IPA as “Server-Cert”</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>monitored by certmonger</p></li>
</ul>
</li>
<li><p>IPA service (2 years)</p>
<ul class="simple">
<li><p>subject name CN=$fqdn,O=$REALM</p></li>
<li><p>enrolled using caIPAserviceCert profile</p></li>
<li><p>private key in /etc/httpd/alias as “Server-Cert”</p></li>
<li><p>issued by IPA RA agent</p></li>
<li><p>monitored by certmonger</p></li>
</ul>
</li>
</ol>
</section>
<section id="selfsign-ca">
<span id="id3"></span><h2>Selfsign CA<a class="headerlink" href="#selfsign-ca" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>the root certificate itself (10 years)</p>
<ul class="simple">
<li><p>subject name CN=$REALM Certificate Authority</p></li>
<li><p>private key in /etc/httpd/alias as “$REALM IPA CA”</p></li>
<li><p>copies stored in</p>
<ul>
<li><p>/etc/dirsrv/slapd-$DSINSTANCE as “$REALM IPA CA”</p></li>
<li><p>/etc/ipa/ca.crt</p></li>
</ul>
</li>
</ul>
</li>
<li><p>CA jar signing (10 years)</p>
<ul class="simple">
<li><p>subject name CN=Object Signing Cert,O=$REALM</p></li>
<li><p>enrolled using caJarSigningCert profile</p></li>
<li><p>private key in /etc/httpd/alias as “Signing-Cert”</p></li>
<li><p>used to sign browser auto-configuration jar</p></li>
</ul>
</li>
</ol>
<p>This document is going to focus on renewing Dogtag CA certificates. The
solutions are broken into short, medium and long-term, moving from more
manual to more automated.</p>
</section>
<section id="short-term-plan">
<span id="id4"></span><h2>Short term plan<a class="headerlink" href="#short-term-plan" title="Permalink to this heading">¶</a></h2>
<section id="warn">
<h3>Warn<a class="headerlink" href="#warn" title="Permalink to this heading">¶</a></h3>
<p>certmonger can track certificates and make a note into a file what
certificate(s) need to be renewed. IPA can read this file and display
the contents on any ipa CLI or UI command when the user is in the admins
group. This will put the renewal front and center to any administrator.</p>
<p>We will warn at a configurable interval, storing the warning value in
cn=ipaconfig.</p>
<p>Manual instructions will be provided to users to handle renewing the
certificates and installing the result in the appropriate locations(s).</p>
<p>Information on renewals can be found at:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://docs.redhat.com/docs/en-US/Red_Hat_Certificate_System/8.1/html/Admin_Guide/Renewing_Certificates.html">http://docs.redhat.com/docs/en-US/Red_Hat_Certificate_System/8.1/html/Admin_Guide/Renewing_Certificates.html</a></p></li>
<li><p><a class="reference external" href="http://docs.redhat.com/docs/en-US/Red_Hat_Certificate_System/8.1/html/Admin_Guide/renewing-certificates.html">http://docs.redhat.com/docs/en-US/Red_Hat_Certificate_System/8.1/html/Admin_Guide/renewing-certificates.html</a></p></li>
</ul>
</section>
</section>
<section id="medium-term-plan">
<span id="id5"></span><h2>Medium term plan<a class="headerlink" href="#medium-term-plan" title="Permalink to this heading">¶</a></h2>
<section id="renew">
<h3>Renew<a class="headerlink" href="#renew" title="Permalink to this heading">¶</a></h3>
<p>certmonger will be trained to talk directly to the CA and can renew all
but the CA root certificate. This renewal will only happen on the master
doing the CRL generation.</p>
<p>All CA system certificates have specific but different requirements.
Renewal enrollments allow one to submit serial number of a certificate
to be renewed. The CA recovers original certificate request and profile
used to generate original system certificate based on certificate serial
number provided in a renewal request. Knowing the original profile
allows the CA to regenerate an identical system certificate.</p>
<p>There is currently no way to determine the profile or request ID
required for renewing these CA certificates. A mechanism will need to be
created (where is TBD, though likely in the CA) to reconcile this.
Whatever process we come up with will need to work with existing
installations that did not store this information.</p>
<p>The certmonger on other IPA servers can use the EE public interface post
renewal time to see if updated certificates are available. If they are
it will retrieve them and install them as appropriate.</p>
<p>The time for doing the renewal should be configurable in IPA. certmonger
already has this as a configuration. I’m not sure if we want to tweak
that file on the fly or have certmonger query IPA in cn=ipaconfig. The
renewal time should be &gt; than the warning time to give renewal a chance
to occur before we start warning users of expiration.</p>
<p>There is also the issue of what machine renews these shared
certificates. The convention will be the CRL master will do this.
certmonger will periodically check to see if new certificates exist. We
will not revoke old CA subsystem certificates when a new one is issued.
This differs from what we do with IPA host and service certificates that
we issue.</p>
<section id="renewing-the-agent-cert">
<span id="id6"></span><h4>Renewing the agent cert<a class="headerlink" href="#renewing-the-agent-cert" title="Permalink to this heading">¶</a></h4>
<p>Renewing the RA agent cert requires an additional step. The public key
is stored in the PKI-IPA LDAP database and will need to be updated when
the certificate is renewed. If it isn’t then the agent will fail to
authenticate.</p>
</section>
</section>
</section>
<section id="long-term-plan">
<span id="id7"></span><h2>Long term plan<a class="headerlink" href="#long-term-plan" title="Permalink to this heading">¶</a></h2>
<section id="renewing-the-ca-certificate">
<span id="id8"></span><h3>Renewing the CA certificate<a class="headerlink" href="#renewing-the-ca-certificate" title="Permalink to this heading">¶</a></h3>
<p>Renewing the CA is a special case because it will require refreshing all
clients and servers in IPA. The renewal process is expected always to be
a manual process.</p>
<p>Updating the CA in the shared NSS database in /etc/pki/nssdb may be
handled by SSSD.</p>
</section>
<section id="subordinate-ca-renewal">
<span id="id9"></span><h3>Subordinate CA renewal<a class="headerlink" href="#subordinate-ca-renewal" title="Permalink to this heading">¶</a></h3>
<p>If the CA is installed as a subordinate of another then by definition
this is going to be a manual renewal process. The same problems of
sharing the updated CA certificate apply.</p>
</section>
</section>
<section id="special-cases">
<span id="id10"></span><h2>Special cases<a class="headerlink" href="#special-cases" title="Permalink to this heading">¶</a></h2>
<section id="rekeying-the-ca">
<span id="id11"></span><h3>Rekeying the CA<a class="headerlink" href="#rekeying-the-ca" title="Permalink to this heading">¶</a></h3>
<p>Rekeying of the CA requires a new CA install. This may also be
necessary/desired as the CA ages and certificates are revoked, unused,
etc, as maintenance. We will need a way to install a new CA alongside
the old one and slowly migrate all users to the new one.</p>
</section>
<section id="rekeying-a-server-cert">
<span id="id12"></span><h3>Rekeying a server cert<a class="headerlink" href="#rekeying-a-server-cert" title="Permalink to this heading">¶</a></h3>
<p>If an IPA service wants new keys it can do this now using either
certmonger or can generate a CSR and use the ipa cert-request command.</p>
</section>
</section>
</section>
<section id="tickets">
<h1>Tickets<a class="headerlink" href="#tickets" title="Permalink to this heading">¶</a></h1>
<section id="ipa">
<h2>IPA<a class="headerlink" href="#ipa" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://fedorahosted.org/freeipa/ticket/1985">1985 Email notify Admin prior to CA certificate
expiration</a></p></li>
<li><p><a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2803">2803 RFE: Auto-renew IPA subsystem
certificates</a></p></li>
</ul>
<p><a class="reference external" href="Category:NoLink">Category:NoLink</a>
<a class="reference external" href="Category:CheckUpdate">Category:CheckUpdate</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V3/Certificate_renewal.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>