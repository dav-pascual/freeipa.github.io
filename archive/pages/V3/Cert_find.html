<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="IPA Certificate Renewal" href="Certificate_renewal.html" />
    <link rel="prev" title="Overview" href="CA-less_install.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>__NOTOC__</p>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>The original CA integration didn’t specify a mechanism to search for
existing certificates. It only specified a way to retrieve a single cert
based on serial number.</p>
<p>This RFE is being worked as <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2528">https://fedorahosted.org/freeipa/ticket/2528</a></p>
</section>
<section id="use-cases">
<span id="use-cases112"></span><h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>The pki cert-find output can be used to compare the output against the
ipa cert-find output. They should be the same with only formatting
differences.</p>
<ul class="simple">
<li><p>Bare find: return all certificates</p></li>
<li><p>Short subject: search certs by short hostname. Using the IPA server
hostname should return &gt; 1</p></li>
<li><p>Exact subject: search certs by short hostname and –exactly set.
Should return nothing</p></li>
<li><p>Exact subject: search certs by FQDN and –exactly set. Should return
correct list</p></li>
<li><p>Using the full list as a starting point, try to bisect the list by
serial number to be sure that the limits are applied</p></li>
<li><p>Revoke a certificate then search by revocation reason.</p></li>
<li><p>Search for invalid revocation reasons (letters, &gt; 10)</p></li>
<li><p>Search for unused revocation reasons, should return nothing</p></li>
<li><p>Search by notbefore/notafter dates</p></li>
<li><p>Search by issuedon dates</p></li>
</ul>
<p>One thing explicitly not done is comparing begin and end dates when
searching. This is left as an exercise for the user.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<section id="dogtag-capabilities">
<span id="id1"></span><h2>Dogtag capabilities<a class="headerlink" href="#dogtag-capabilities" title="Permalink to this heading">¶</a></h2>
<p>This will be implemented in dogtag 10+ only, and using only the new
RESTful interface.</p>
<p>The interface provides 32 different search options:</p>
<ul class="simple">
<li><p>certTypeSecureEmail &lt;on|off&gt; : Certifiate Type: Secure Email</p></li>
<li><p>certTypeSSLClient &lt;on|off&gt; : Certifiate Type: SSL Client</p></li>
<li><p>certTypeSSLServer &lt;on|off&gt; : Certifiate Type: SSL Server</p></li>
<li><p>certTypeSubEmailCA &lt;on|off&gt; : Certifiate type: Subject Email CA</p></li>
<li><p>certTypeSubSSLCA &lt;on|off&gt; : Certificate type: Subject SSL CA</p></li>
<li><p>country : Subject’s country</p></li>
<li><p>email : Subject’s email address</p></li>
<li><p>input : File containing the search constraints</p></li>
<li><p>issuedBy : Issued by</p></li>
<li><p>issuedOn : Date issued</p></li>
<li><p>locality : Subject’s locality</p></li>
<li><p>matchExactly : Match exactly with the details provided</p></li>
<li><p>maxSerialNumber : Maximum serial number</p></li>
<li><p>minSerialNumber : Minimum serial number</p></li>
<li><p>name : Subject’s common name</p></li>
<li><p>org : Subject’s organization</p></li>
<li><p>orgUnit : Subject’s organization unit</p></li>
<li><p>revocationReason : Reason for revocation</p></li>
<li><p>revokedBy : Certificate revoked by</p></li>
<li><p>revokedOnFrom : Revoked on or after this date</p></li>
<li><p>revokedOnTo : Revoked on or before this date</p></li>
<li><p>size : Page size</p></li>
<li><p>start : Page start</p></li>
<li><p>state : Subject’s state</p></li>
<li><p>uid : Subject’s userid</p></li>
<li><p>validityCount : Validity count</p></li>
<li><p>validityOperation : Validity operation: “&lt;=” or “&gt;=”</p></li>
<li><p>validityUnit : Validity unit</p></li>
<li><p>validNotAfterFrom : Valid not after start date</p></li>
<li><p>validNotAfterTo : Valid not after end date</p></li>
<li><p>validNotBeforeFrom : Valid not before start date</p></li>
<li><p>validNotBeforeTo : Valid not before end date</p></li>
</ul>
</section>
<section id="what-ipa-will-provide">
<span id="id2"></span><h2>What IPA will provide<a class="headerlink" href="#what-ipa-will-provide" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Serial number range (min/max/none)</p></li>
<li><p>Issued On</p></li>
<li><p>revoked certificates</p></li>
<li><p>subject</p></li>
<li><p>valid not after from</p></li>
<li><p>valid not after to</p></li>
<li><p>valid not before from</p></li>
<li><p>valid not before to</p></li>
</ul>
<p>Some of these can be overlapping, for example you can search for a
revoked certificate for a given host within a serial number range.</p>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this heading">¶</a></h2>
<p>In the initial implementation and to save cycles we’ll just display what
dogtag returns:</p>
<ul class="simple">
<li><p>Serial Number (dec and hex)</p></li>
<li><p>Subject DN</p></li>
<li><p>Status</p></li>
</ul>
<p>In order to display more details we’d need to look up each serial number
one at a time which would be agonizingly slow.</p>
<p>Like all IPA commands, a bare find command should return all
certificates. In this case we have no control over the search limit. We
may still want to impose a limit on the amount of data returned to the
client.</p>
</section>
<section id="access-control">
<span id="id3"></span><h2>Access Control<a class="headerlink" href="#access-control" title="Permalink to this heading">¶</a></h2>
<p>Issued certificates are considered public so no additional
roles/permissions are planned. As with other commands one will need to
be an authenticated IPA user to execute the command.</p>
<p>The interface is available internally on port 8080 which is not a port
we advertise as needing to be open generally.</p>
</section>
<section id="dogtag-details">
<span id="id4"></span><h2>Dogtag details<a class="headerlink" href="#dogtag-details" title="Permalink to this heading">¶</a></h2>
<p>There is a command-line tool, pki, which seems modeled on the ipa tool.
The cert-find command is what we’re interested in.</p>
<p>The interface is not currently documented but it is easy to snoop on the
request using ssltap.</p>
<p>In order to make a request, POST to /ca/rest/certs/search</p>
<p>The content of the request is XML, as is the content of the response.</p>
<p>I snooped using two terminals.</p>
<p>terminal 1: <code class="docutils literal notranslate"><span class="pre">ssltap</span> <span class="pre">localhost:8080</span></code></p>
<p>terminal 2: <code class="docutils literal notranslate"><span class="pre">pki</span> <span class="pre">cert-find</span> <span class="pre">-p</span> <span class="pre">1924</span></code></p>
<p>The requests are made and received in XML.</p>
<p>There are a series of boolean elements that control how the search is
done, in addition to optional extra elements depending on what you are
searching for (subject, revocation reason, etc).</p>
</section>
<section id="current-bugs">
<span id="id5"></span><h2>Current bugs<a class="headerlink" href="#current-bugs" title="Permalink to this heading">¶</a></h2>
<p>Date parsing is broken. <a class="reference external" href="https://fedorahosted.org/pki/ticket/416">https://fedorahosted.org/pki/ticket/416</a>
Certificate dates are not returned in find output.
<a class="reference external" href="https://fedorahosted.org/pki/ticket/498">https://fedorahosted.org/pki/ticket/498</a></p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>Any additional requirements or changes discovered during the
implementation phase.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<p>The UI should be similar to the command line. It is unclear how date
formatting will be handled but bare text boxes would be usable for a
first attempt.</p>
<p>Unlike other object-find pages there are some additional ways of
narrowing down the terms, by adding dates, serial numbers, etc. The
searchs are all AND, there is no way to do an OR (limitation of CS).</p>
<p>Overview of the CLI commands</p>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>Nothing beyond cert-find. Command only works with dogtag CA backend.</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>None</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>None</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>Date parsing works in current dogtag 10 in F-18, but output currently
limited by ticket #498.</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>None</p>
<section id="future">
<h2>Future<a class="headerlink" href="#future" title="Permalink to this heading">¶</a></h2>
<p>As more certificate types are added this can easily be extended to
search for those types without impacting backwards compatibility. It
seems like overkill to do that now.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V3/Cert_find.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>