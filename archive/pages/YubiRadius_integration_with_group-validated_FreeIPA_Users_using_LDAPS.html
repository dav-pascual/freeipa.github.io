<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Step 1. Create our Group to be used for user validation &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Prerequisite:" href="Zimbra_Collaboration_Server_7.2_Authentication_and_GAL_lookups_against_FreeIPA.html" />
    <link rel="prev" title="Windows authentication against FreeIPA" href="Windows_authentication_against_FreeIPA.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><strong>YubiRadius integration with group-validated FreeIPA Users using
LDAPS</strong></p>
<p><em>Provided by Dale Macartney</em></p>
<p>This page is a copy of the original post that can be found here.
` &lt;<a class="reference external" href="https://www.dalemacartney.com/2012/07/13/yubiradius-integration-with-group-validated-freeipa-users-using-ldaps/">https://www.dalemacartney.com/2012/07/13/yubiradius-integration-with-group-validated-freeipa-users-using-ldaps/</a>&gt;`__<a class="reference external" href="https://www.dalemacartney.com/2012/07/13/yubiradius-integration-with-group-validated-freeipa-users-using-ldaps/">https://www.dalemacartney.com/2012/07/13/yubiradius-integration-with-group-validated-freeipa-users-using-ldaps/</a></p>
<p>This article will show you how to set up the YubiRadius Virtual
Appliance (v. 3.5.1) for User validation against a FreeIPA
infrastructure on Red Hat Enterprise Linux 6.3.</p>
<p>You can obtain the YubiRadius Virtual Appliance from the good people
over at Yubico, or just click here</p>
<p>This guide is not meant to show you how to configure a virtual appliance
in your choice of Virtualization technology, although as I am using KVM,
a special thanks to Gavin Spurgeon for getting this VA converted and
working smoothly (even with virtio for the icing on the cake).</p>
<p>For details in configuring the Virtual Appliance you can reference the
Yubico’s provided documentation here if you wish.</p>
<p>Now, before we begin, the details for the purpose of this article are as
follows.</p>
<p><code class="docutils literal notranslate"><span class="pre">IPA server: ds01.example.com (10.0.1.11)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">YubiRadius VA: yubiradius01.example.com (10.0.1.31)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Group to be used for validation: &quot;yubikey&quot;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">YubiRadius LDAP Bind Account: &quot;yubiradius&quot;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Example Users: euser1, euser2, euser3, euser4, euser5</span></code></p>
<section id="step-1-create-our-group-to-be-used-for-user-validation">
<span id="id1"></span><h1>Step 1. Create our Group to be used for user validation<a class="headerlink" href="#step-1-create-our-group-to-be-used-for-user-validation" title="Permalink to this heading">¶</a></h1>
<p>On your FreeIPA server, run the following:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]# ipa group-add</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Group name: yubikey</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Description: YubiKey validation group</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">---------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Added group &quot;yubikey&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">---------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Group name: yubikey</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Description: YubiKey validation group</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">GID: 1870200005</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]#</span></code></div>
</div>
</section>
<section id="step-2-add-users-to-your-new-group">
<span id="id2"></span><h1>Step 2. Add users to your new group.<a class="headerlink" href="#step-2-add-users-to-your-new-group" title="Permalink to this heading">¶</a></h1>
<p>As I have already created my users, I will add them to the group I have
just created.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]# ipa group-add-member yubikey</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[member user]: euser1,euser2,euser3,euser4,euser5</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[member group]:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Group name: yubikey</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Description: YubiKey validation group</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">GID: 1870200005</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Member users: euser1, euser2, euser3, euser4, euser5</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Number of members added 5</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">-------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]#</span></code></div>
</div>
</section>
<section id="step-3-create-an-ldap-bind-account">
<span id="id3"></span><h1>Step 3, Create an LDAP bind account.<a class="headerlink" href="#step-3-create-an-ldap-bind-account" title="Permalink to this heading">¶</a></h1>
<p>Create a text file called “yubiradius.ldif” with the following content.</p>
<p>Be sure to change the password to something secure. In this example I
have used “redhat123”</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn: uid=yubiradius,cn=sysaccounts,cn=etc,dc=example,dc=com</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">changetype: add</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectclass: account</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectclass: simplesecurityobject</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">uid: yubiradius</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">userPassword: redhat123</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">passwordExpirationTime: 20380119031407Z</span></code></div>
<div class="line"><a href="#id4"><span class="problematic" id="id5">``</span></a>nsIdleTimeout: 0 ``</div>
</div>
<p>Now, import yubiradius.ldif into FreeIPA. You will need to enter your
Directory Manager password, as you are making additions to LDAP.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]# ldapmodify -h ds01.example.com -p 389 -x -D &quot;cn=Directory  Manager&quot; -W -f yubiradius.ldif</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Enter LDAP Password:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">adding new entry &quot;uid=yubiradius,cn=sysaccounts,cn=etc,dc=example,dc=com&quot;</span></code></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]#</span></code></p>
</section>
<section id="step-4-add-your-yubiradius-server-s-hostname-to-our-dns-environment-if-you-are-using-ipa-to-manage-your-dns-do-the-following">
<span id="step-4-add-your-yubiradius-servers-hostname-to-our-dns-environment-if-you-are-using-ipa-to-manage-your-dns-do-the-following"></span><h1>Step 4. Add your YubiRadius server’s hostname to our DNS environment. If you are using IPA to manage your DNS, do the following.<a class="headerlink" href="#step-4-add-your-yubiradius-server-s-hostname-to-our-dns-environment-if-you-are-using-ipa-to-manage-your-dns-do-the-following" title="Permalink to this heading">¶</a></h1>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]# ipa dnsrecord-add example.com yubiradius01 --a-rec 10.0.1.31</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Record name: yubiradius01</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">A record: 10.0.1.31</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]# ipa dnsrecord-add 1.0.10.in-addr.arpa. 31 --ptr-rec   yubiradius01.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Record name: 31</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">PTR record: yubiradius01.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ds01 ~]#</span></code></div>
</div>
</section>
<section id="step-5-start-to-configure-your-yubiradius-through-the-webmin-management-page">
<span id="id6"></span><h1>Step 5. Start to configure your YubiRadius through the webmin management page.<a class="headerlink" href="#step-5-start-to-configure-your-yubiradius-through-the-webmin-management-page" title="Permalink to this heading">¶</a></h1>
<p>Start by logging into your Yubiradius.</p>
<p>Browse to <a class="reference external" href="https://:10000">https://:10000</a></p>
<p>Log in with these details</p>
<p>Username: yubikey</p>
<p>Password: yubico</p>
<p>See attached screen shot</p>
<figure class="align-default" id="id9">
<img alt="Webmin_Login.png" src="../../_images/Webmin_Login.png" />
<figcaption>
<p><span class="caption-text">Webmin_Login.png</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="step-6-create-a-domain">
<span id="id7"></span><h1>Step 6. Create a domain.<a class="headerlink" href="#step-6-create-a-domain" title="Permalink to this heading">¶</a></h1>
<p>The first page you will be presented with, will be the Domain page,
before continuing, enter your domain name and click the “Add Domain”
button.</p>
<p>In my example, it is “example.com”</p>
</section>
<section id="step-7-import-users-from-freeipa">
<span id="id8"></span><h1>Step 7. Import Users from FreeIPA<a class="headerlink" href="#step-7-import-users-from-freeipa" title="Permalink to this heading">¶</a></h1>
<p>Once you have created your domain, it will appear in the Domains list.
Click your domain to enter the configuration.</p>
<p>You will see there is currently no users configured. Click on the “Users
Import” tab to continue.</p>
<p>Use the following details to configure your User Import. You will notice
I am using Secure LDAP lookups. This stops the usernames and passwords
from being transmitted in clear text. I HIGHLY recommend you do the
same.</p>
<p>Use Secure Connection? = Yes</p>
<p>LDAP/AD Server Address or Host Name = ds01.example.com</p>
<p>Backup LDAP/AD Server Address or Host Name = (leave blank)</p>
<p>Port (use 0 or blank to use the default port) = 636</p>
<p>Directory Type = OpenLDAP</p>
<p>LDAP Version = 3</p>
<p>Base DN = cn=users,cn=accounts,dc=example,dc=com</p>
<p>User DN = uid=yubiradius,cn=sysaccounts,cn=etc,dc=example,dc=com</p>
<p>Password = redhat123</p>
<p>Schedule = Hourly</p>
<p>Timeout (Seconds) = 0</p>
<p>Filter = (memberOf=cn=yubikey,cn=groups,cn=accounts,dc=example,dc=com)</p>
<p>Notes = Blank</p>
<p>Login Name Identifier = uid</p>
<p>Once you have filled in all the relevant details. Click the “save”
button. Once you have saved your configuration. Click the “Import Users”
button.</p>
<p>You will be presented with a window that should look as follows. If you
receive an error, you may have made an error in your configuration in
this step. You will want to go back to double check.</p>
<p>See attached screen shot</p>
<figure class="align-default" id="id10">
<img alt="UserImportSuccessful.png" src="../../_images/UserImportSuccessful.png" />
<figcaption>
<p><span class="caption-text">UserImportSuccessful.png</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Once this has completed, click “Return to previous page”, and then click
the “Users/Groups” tab at the top.</p>
</section>
<section id="step-8-assign-yubikey-s-to-your-user-s">
<span id="step-8-assign-yubikeys-to-your-users"></span><h1>Step 8. Assign Yubikey(s) to your User(s)<a class="headerlink" href="#step-8-assign-yubikey-s-to-your-user-s" title="Permalink to this heading">¶</a></h1>
<p>You should now see a list of users. These users will be a member of the
“Yubikey” group. Note that there are no others users in the list.</p>
<p>To assign a Yubikey, you will need.. you guessed it, a Yubikey. Click
the “Assign Yubikey” button</p>
<p>You will need to provide the username of one of your Users. For example,
I have used “euser1”</p>
<p>You will also need to provide an OTP from the Yubikey you wish to
assign. Insert the Yubikey into a USB socket, and press the Golden
button once the light comes on. (Press for 1 second).</p>
<p>Pressing the Yubikey will also issue the “Enter” key command. So it
should complete the process itself. If for some reason it does not,
click the “Create” button.</p>
<p>Now lets go back to our Users/Group list. Click “YubiRADIUS Virtual
Appliance” on the left side panel, and then click on your domain.</p>
<p>Your Users/Group list will now show you have assigned One Yubikey</p>
<p>See attached screen shot</p>
<figure class="align-default" id="id11">
<img alt="UserList.png" src="../../_images/UserList.png" />
<figcaption>
<p><span class="caption-text">UserList.png</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="step-9-verify-your-user-s-radius-authentication">
<span id="step-9-verify-your-users-radius-authentication"></span><h1>Step 9. Verify your User’s Radius authentication.<a class="headerlink" href="#step-9-verify-your-user-s-radius-authentication" title="Permalink to this heading">¶</a></h1>
<p>Click “YubiRADIUS Virtual Appliance” on the left side panel once more,
then click the “Troubleshoot” tab.</p>
<p>In the “RadTest” section, enter the username, password and OTP (another
1 second press of the yubikey” and click the “Send Request” button.</p>
<p>This should successfully validate your radius, your OTP with the
YubiCloud service hosted by Yubico, as well as your username and
password credentials.</p>
<p>See attached screen shot</p>
<figure class="align-default" id="id12">
<img alt="RedTest.png" src="../../_images/RedTest.png" />
<figcaption>
<p><span class="caption-text">RedTest.png</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>You can see here that the user’s password and OTP are joined together.
The Example User1’s password is RedHat123, and the OTP consists of the
KeyID + a OTP.</p>
<p>That’s it folks. You can now use the YubiRadius to authenticate normal
Radius requests with your Yubikey as Two Factor Authentication</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/YubiRadius_integration_with_group-validated_FreeIPA_Users_using_LDAPS.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>