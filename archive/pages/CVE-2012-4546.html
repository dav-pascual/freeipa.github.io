<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CVE-2012-4546: Incorrect CRLs publishing &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CVE-2012-5484: MITM Attack during Join process" href="CVE-2012-5484.html" />
    <link rel="prev" title="CVE-2008-3274" href="CVE-2008-3274.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="cve-2012-4546-incorrect-crls-publishing">
<span id="id1"></span><h1>CVE-2012-4546: Incorrect CRLs publishing<a class="headerlink" href="#cve-2012-4546-incorrect-crls-publishing" title="Permalink to this heading">¶</a></h1>
</section>
<section id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h1>
<p>It was found that the current default configuration of IPA servers did
not publish correct CRLs (Certificate Revocation Lists). The default
configuration specifies that every replica is to generate its own CRL,
however this can result in inconsistencies in the CRL contents provided
to clients from different Identity Management replicas. More
specifically, if a certificate is revoked on one Identity Management
replica, it will not show up on another Identity Management replica.</p>
<p>To avoid this inconsistency, the solution is to configure CRL generation
to only take place on one Identity Management server. To do so, the CRL
configuration must be changed on all Identity Management servers.</p>
</section>
<section id="affected-versions">
<span id="id2"></span><h1>Affected Versions<a class="headerlink" href="#affected-versions" title="Permalink to this heading">¶</a></h1>
<p>All 2.x and 3.x versions using multiple CA replicas</p>
</section>
<section id="impact">
<h1>Impact<a class="headerlink" href="#impact" title="Permalink to this heading">¶</a></h1>
<p>Low</p>
</section>
<section id="acknowledgements">
<h1>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this heading">¶</a></h1>
<p>The bug was found by the FreeIPA team during an internal review.</p>
</section>
<section id="upgrade-instructions">
<span id="id3"></span><h1>Upgrade Instructions<a class="headerlink" href="#upgrade-instructions" title="Permalink to this heading">¶</a></h1>
<p>Upgrading to the latest 3.0 or 3.1 FreeIPA versions should be sufficient
to resolve the issue.</p>
</section>
<section id="manual-instructions">
<span id="id4"></span><h1>Manual Instructions<a class="headerlink" href="#manual-instructions" title="Permalink to this heading">¶</a></h1>
<p>To manually resolve the problem the CRL configuration must be changed on
all Identity Management servers. One IPA master needs to be picked as
the CRL generator. It does not matter which master, and the following
procedure should be used:</p>
<p>On the non-CRL generating masters:</p>
<ol class="arabic simple">
<li><p>Configure the clones to point to the CRL generator to get the CRL:</p></li>
</ol>
<p>1a. Edit /etc/httpd/conf.d/ipa-pki-proxy.conf 1b. Add
“<a href="#id5"><span class="problematic" id="id6">|</span></a>^/ca/ee/ca/getCRL” to the end of the first LocationMatch. After
editing, the first LocationMatch entry in ipa-pki-proxy.conf should look
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">LocationMatch</span>
<span class="s2">&quot;^/ca/ee/ca/checkRequest|^/ca/ee/ca/getCertChain|^/ca/ee/ca/getTokenInfo|^/ca/ee/ca/tokenAuthenticate|^/ca/ocsp|^/ca/ee/ca/updateNumberRange|^/ca/ee/ca/getCRL&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>1c. At the end of this file add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RewriteRule ^/ipa/crl/MasterCRL.bin
https://$FQDN/ca/ee/ca/getCRL?op=getCRL&amp;crlIssuingPoint=MasterCRL
[L,R=301,NC]
</pre></div>
</div>
<p>1d. Replace $FQDN with the hostname of the IPA master picked as the CRL
generator. 1e. The httpd service will need to be restarted after making
this change:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service httpd restart</span>
</pre></div>
</div>
<p>2. Update the CRL generator to include certificates revoked from other
masters in its CRL:</p>
<p>2a. Edit the CA configuration file in /var/lib/pki-ca/conf/CS.cfg: These
two settings should be true by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ca</span><span class="o">.</span><span class="n">crl</span><span class="o">.</span><span class="n">MasterCRL</span><span class="o">.</span><span class="n">enableCRLCache</span><span class="o">=</span><span class="n">true</span>
<span class="n">ca</span><span class="o">.</span><span class="n">crl</span><span class="o">.</span><span class="n">MasterCRL</span><span class="o">.</span><span class="n">enableCRLUpdates</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>2b. Set this directive to true (This can be appended to the end of
CS.cfg):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ca</span><span class="o">.</span><span class="n">listenToCloneModifications</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>2c. The CA will need to be restarted after making this change:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service pki-cad restart</span>
</pre></div>
</div>
<p>It may be noted that this configuration creates a single point of
failure. If the CRL generator server goes down then the other IPA
masters will not be able to retrieve a CRL and one will not be
generated. In this case one would need to choose a new master as the CRL
generator and perform the steps above. It is recommended that a DNS
CNAME be created to refer to the server that provides the CRL (with a
relatively short TTL). This will provide flexibility in case the CRL
generator needs to be changed, and without reconfiguring any clients
that need to retrieve the CRL.</p>
</section>
<section id="patches">
<h1>Patches<a class="headerlink" href="#patches" title="Permalink to this heading">¶</a></h1>
<p>A patch to resolve this issue is available through our git repository:
<a class="reference external" href="http://git.fedorahosted.org/cgit/freeipa.git/commit/?id=392097f20673708a684da168aec302da7ccda9a6">http://git.fedorahosted.org/cgit/freeipa.git/commit/?id=392097f20673708a684da168aec302da7ccda9a6</a></p>
<p><a class="reference external" href="Category:CVEs">Category:CVEs</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/CVE-2012-4546.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>