<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Overview" href="Samba_4_SID_Allocation_using_DNA_Plugin.html" />
    <link rel="prev" title="Overview" href="Samba_4_Refactoring_ProvisionBackend.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>This page describes how to setup Samba replica using Fedora DS as a
backend.</p>
<p>This document uses the following environment:</p>
<ul class="simple">
<li><p>Domain name: domain1.com</p></li>
<li><p>Samba master: samba2.domain1.com</p></li>
<li><p>Samba replica: samba2.domain1.com</p></li>
</ul>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h1>
<p>See <a class="reference external" href="Obsolete:Samba_4_Installation">Samba Installation</a>.</p>
</section>
<section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h1>
<p>Create /usr/local/samba/etc/smb.conf for the replica:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">globals</span><span class="p">]</span>
        <span class="n">netbios</span> <span class="n">name</span>    <span class="o">=</span> <span class="n">samba2</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="provisioning-fedora-ds-backend">
<span id="id1"></span><h1>Provisioning Fedora DS Backend<a class="headerlink" href="#provisioning-fedora-ds-backend" title="Permalink to this heading">¶</a></h1>
<p>Setup Fedora DS instance for the replica:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">samba</span><span class="o">/</span><span class="n">source4</span>
<span class="o">%</span> <span class="n">setup</span><span class="o">/</span><span class="n">provision</span><span class="o">-</span><span class="n">backend</span> <span class="o">--</span><span class="n">realm</span><span class="o">=</span><span class="n">DOMAIN1</span><span class="o">.</span><span class="n">COM</span> <span class="o">--</span><span class="n">domain</span><span class="o">=</span><span class="n">DOMAIN1</span> <span class="o">--</span><span class="n">server</span><span class="o">-</span><span class="n">role</span><span class="o">=</span><span class="s1">&#39;domain controller&#39;</span> \
<span class="o">--</span><span class="n">ldap</span><span class="o">-</span><span class="n">admin</span><span class="o">-</span><span class="k">pass</span><span class="o">=</span><span class="n">Secret123</span> <span class="o">--</span><span class="n">ldap</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">fedora</span><span class="o">-</span><span class="n">ds</span>
</pre></div>
</div>
<p>Edit /usr/local/samba/private/ldap/fedorads.inf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">General</span><span class="p">]</span>
<span class="n">FullMachineName</span>         <span class="o">=</span> <span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span>
<span class="n">SuiteSpotUserID</span>         <span class="o">=</span> <span class="n">nobody</span>
<span class="n">SuiteSpotGroup</span>          <span class="o">=</span> <span class="n">nobody</span>
<span class="n">ServerRoot</span>              <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span>

<span class="n">ConfigDirectoryLdapURL</span>  <span class="o">=</span> <span class="n">ldap</span><span class="p">:</span><span class="o">//</span><span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span>
<span class="n">ConfigDirectoryAdminID</span>  <span class="o">=</span> <span class="n">admin</span>
<span class="n">ConfigDirectoryAdminPwd</span> <span class="o">=</span> <span class="n">Secret123</span>

<span class="n">AdminDomain</span>             <span class="o">=</span> <span class="n">domain1</span><span class="o">.</span><span class="n">com</span>

<span class="p">[</span><span class="n">slapd</span><span class="p">]</span>
<span class="n">ServerPort</span>              <span class="o">=</span> <span class="mi">390</span>
<span class="n">ServerIdentifier</span>        <span class="o">=</span> <span class="n">samba</span>
<span class="n">Suffix</span>                  <span class="o">=</span> <span class="n">DC</span><span class="o">=</span><span class="n">domain1</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>

<span class="n">RootDN</span>                  <span class="o">=</span> <span class="n">cn</span><span class="o">=</span><span class="n">Directory</span> <span class="n">Manager</span>
<span class="n">RootDNPwd</span>               <span class="o">=</span> <span class="n">Secret123</span>

<span class="n">ldapifilepath</span>           <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">ldapi</span>

<span class="n">start_server</span>            <span class="o">=</span> <span class="mi">0</span>
<span class="n">install_full_schema</span>     <span class="o">=</span> <span class="mi">0</span>

<span class="n">SchemaFile</span>              <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="mi">99</span><span class="n">_ad</span><span class="o">.</span><span class="n">ldif</span>
<span class="n">ConfigFile</span>              <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">fedorads</span><span class="o">-</span><span class="n">partitions</span><span class="o">.</span><span class="n">ldif</span>

<span class="n">inst_dir</span>                <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span>
<span class="n">config_dir</span>              <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span>
<span class="n">schema_dir</span>              <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">schema</span>
<span class="n">lock_dir</span>                <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">lock</span>
<span class="n">log_dir</span>                 <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">logs</span>
<span class="n">run_dir</span>                 <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">logs</span>
<span class="n">db_dir</span>                  <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">db</span>
<span class="n">bak_dir</span>                 <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">bak</span>
<span class="n">tmp_dir</span>                 <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">tmp</span>
<span class="n">ldif_dir</span>                <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">ldif</span>
<span class="n">cert_dir</span>                <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span>
</pre></div>
</div>
<p>Edit /usr/local/samba/private/ldap/99_ad.ldif, replace
1.3.6.1.4.1.1466.115.121.1.44 with 1.3.6.1.4.1.1466.115.121.1.26.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span>
<span class="o">%</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">ds</span><span class="o">.</span><span class="n">pl</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">fedorads</span><span class="o">.</span><span class="n">inf</span>
</pre></div>
</div>
</section>
<section id="starting-fedora-ds">
<span id="id2"></span><h1>Starting Fedora DS<a class="headerlink" href="#starting-fedora-ds" title="Permalink to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span>
<span class="o">%</span> <span class="n">slapd</span><span class="o">-</span><span class="n">samba</span><span class="o">/</span><span class="n">start</span><span class="o">-</span><span class="n">slapd</span>
</pre></div>
</div>
</section>
<section id="configuring-multi-master-replication">
<span id="id3"></span><h1>Configuring Multi-Master Replication<a class="headerlink" href="#configuring-multi-master-replication" title="Permalink to this heading">¶</a></h1>
<p>Samba uses 3 databases in Fedora DS. They require separate replication
agreements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">perl</span><span class="o">-</span><span class="n">LDAP</span>
</pre></div>
</div>
<p>Download <a class="reference external" href="Media:mmr.txt">mmr.pl</a> script to configure MMR:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">mmr</span><span class="o">.</span><span class="n">pl</span> \
<span class="o">--</span><span class="n">host1</span> <span class="n">samba1</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">host2</span> <span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">port</span> <span class="mi">390</span> \
<span class="o">--</span><span class="n">host1_id</span> <span class="mi">1</span> <span class="o">--</span><span class="n">host2_id</span> <span class="mi">2</span> \
<span class="o">--</span><span class="n">binddn</span> <span class="s1">&#39;cn=Directory Manager&#39;</span> \
<span class="o">--</span><span class="n">bindpw</span> <span class="n">Secret123</span> \
<span class="o">--</span><span class="n">repmanpw</span> <span class="n">Secret123</span> \
<span class="o">--</span><span class="n">base</span> <span class="n">dc</span><span class="o">=</span><span class="n">domain1</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span> \
<span class="o">--</span><span class="n">create</span>

<span class="o">%</span> <span class="n">mmr</span><span class="o">.</span><span class="n">pl</span> \
<span class="o">--</span><span class="n">host1</span> <span class="n">samba1</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">host2</span> <span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">port</span> <span class="mi">390</span> \
<span class="o">--</span><span class="n">host1_id</span> <span class="mi">1</span> <span class="o">--</span><span class="n">host2_id</span> <span class="mi">2</span> \
<span class="o">--</span><span class="n">binddn</span> <span class="s1">&#39;cn=Directory Manager&#39;</span> \
<span class="o">--</span><span class="n">bindpw</span> <span class="n">Secret123</span> \
<span class="o">--</span><span class="n">repmanpw</span> <span class="n">Secret123</span> \
<span class="o">--</span><span class="n">base</span> <span class="n">cn</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">domain1</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span> \
<span class="o">--</span><span class="n">create</span>

<span class="o">%</span> <span class="n">mmr</span><span class="o">.</span><span class="n">pl</span> \
<span class="o">--</span><span class="n">host1</span> <span class="n">samba1</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">host2</span> <span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">port</span> <span class="mi">390</span> \
<span class="o">--</span><span class="n">host1_id</span> <span class="mi">1</span> <span class="o">--</span><span class="n">host2_id</span> <span class="mi">2</span> \
<span class="o">--</span><span class="n">binddn</span> <span class="s1">&#39;cn=Directory Manager&#39;</span> \
<span class="o">--</span><span class="n">bindpw</span> <span class="n">Secret123</span> \
<span class="o">--</span><span class="n">repmanpw</span> <span class="n">Secret123</span> \
<span class="o">--</span><span class="n">base</span> <span class="n">cn</span><span class="o">=</span><span class="n">Schema</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">domain1</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span> \
<span class="o">--</span><span class="n">create</span>
</pre></div>
</div>
</section>
<section id="provisioning-samba">
<span id="id4"></span><h1>Provisioning Samba<a class="headerlink" href="#provisioning-samba" title="Permalink to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">setup</span><span class="o">/</span><span class="n">provision</span> <span class="o">--</span><span class="n">realm</span><span class="o">=</span><span class="n">DOMAIN1</span><span class="o">.</span><span class="n">COM</span> <span class="o">--</span><span class="n">domain</span><span class="o">=</span><span class="n">DOMAIN1</span> \
<span class="o">--</span><span class="n">adminpass</span><span class="o">=</span><span class="n">Secret123</span> \
<span class="o">--</span><span class="n">ldap</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">fedora</span><span class="o">-</span><span class="n">ds</span> \
<span class="o">--</span><span class="n">ldap</span><span class="o">-</span><span class="n">backend</span><span class="o">=</span><span class="n">ldapi</span><span class="p">:</span><span class="o">///</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">ldapi</span> \
<span class="o">--</span><span class="n">partitions</span><span class="o">-</span><span class="n">only</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span> <span class="n">Role</span><span class="p">:</span>    <span class="n">domain</span> <span class="n">controller</span>
<span class="n">Hostname</span><span class="p">:</span>       <span class="n">samba2</span>
<span class="n">NetBIOS</span> <span class="n">Domain</span><span class="p">:</span> <span class="n">DOMAIN1</span>
<span class="n">DNS</span> <span class="n">Domain</span><span class="p">:</span>     <span class="n">domain1</span><span class="o">.</span><span class="n">com</span>
<span class="n">DOMAIN</span> <span class="n">SID</span><span class="p">:</span>     <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">3010954269</span><span class="o">-</span><span class="mi">3145692404</span><span class="o">-</span><span class="mi">1112636010</span>
<span class="n">Admin</span> <span class="n">password</span><span class="p">:</span> <span class="n">Secret123</span>
</pre></div>
</div>
</section>
<section id="joining-samba-domain">
<span id="id5"></span><h1>Joining Samba Domain<a class="headerlink" href="#joining-samba-domain" title="Permalink to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">%</span> <span class="n">net</span> <span class="n">join</span> <span class="n">DOMAIN1</span> <span class="n">BDC</span> <span class="o">-</span><span class="n">U</span> <span class="n">Administrator</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="n">Secret123</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Joined</span> <span class="n">domain</span> <span class="n">DOMAIN1</span> <span class="p">(</span><span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">1030068324</span><span class="o">-</span><span class="mi">2126043060</span><span class="o">-</span><span class="mi">2085863383</span><span class="p">)</span>
</pre></div>
</div>
<p>Generate UUID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">uuidgen</span>
</pre></div>
</div>
<p>Create a file containing the following entry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">NTDS</span> <span class="n">Settings</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">SAMBA2</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Servers</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Default</span><span class="o">-</span><span class="n">First</span><span class="o">-</span><span class="n">Site</span><span class="o">-</span><span class="n">Name</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Sites</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">domain1</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
<span class="n">objectClass</span><span class="p">:</span> <span class="n">top</span>
<span class="n">objectClass</span><span class="p">:</span> <span class="n">applicationSettings</span>
<span class="n">objectClass</span><span class="p">:</span> <span class="n">nTDSDSA</span>
<span class="n">cn</span><span class="p">:</span> <span class="n">NTDS</span> <span class="n">Settings</span>
<span class="n">options</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">showInAdvancedViewOnly</span><span class="p">:</span> <span class="n">TRUE</span>
<span class="n">systemFlags</span><span class="p">:</span> <span class="mi">33554432</span>
<span class="n">dMDLocation</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Schema</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Configuration</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">domain1</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">com</span>
<span class="n">invocationId</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">UUID</span><span class="o">&gt;</span>
<span class="n">msDS</span><span class="o">-</span><span class="n">Behavior</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Add the entry to Samba master:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">%</span> <span class="o">./</span><span class="n">ldbadd</span> <span class="o">-</span><span class="n">H</span> <span class="n">ldap</span><span class="p">:</span><span class="o">//</span><span class="n">samba1</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">U</span> <span class="n">Administrator</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="n">Secret123</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="starting-samba-replica">
<span id="id6"></span><h1>Starting Samba Replica<a class="headerlink" href="#starting-samba-replica" title="Permalink to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">sbin</span>
<span class="o">%</span> <span class="o">./</span><span class="n">samba</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">M</span> <span class="n">single</span> <span class="o">-</span><span class="n">d</span> <span class="mi">3</span>
</pre></div>
</div>
</section>
<section id="enable-change-log">
<span id="id7"></span><h1>Enable Change Log<a class="headerlink" href="#enable-change-log" title="Permalink to this heading">¶</a></h1>
<p>Copy changelog schema into
/usr/local/schema/private/ldap/slapd-samba/schema.</p>
<p>Enable Retro Changelog plugin on replica:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ldapmodify</span> <span class="o">-</span><span class="n">h</span> <span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">p</span> <span class="mi">390</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">D</span> <span class="s2">&quot;cn=Directory Manager&quot;</span> <span class="o">-</span><span class="n">w</span> <span class="n">Secret123</span>
<span class="n">dn</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">Retro</span> <span class="n">Changelog</span> <span class="n">Plugin</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">plugins</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">config</span>
<span class="n">changetype</span><span class="p">:</span> <span class="n">modify</span>
<span class="n">replace</span><span class="p">:</span> <span class="n">nsslapd</span><span class="o">-</span><span class="n">pluginEnabled</span>
<span class="n">nsslapd</span><span class="o">-</span><span class="n">pluginEnabled</span><span class="p">:</span> <span class="n">on</span>
<span class="o">-</span>
</pre></div>
</div>
<p>Restart DS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">ldap</span><span class="o">/</span><span class="n">slapd</span><span class="o">-</span><span class="n">samba</span>
<span class="o">%</span> <span class="n">stop</span><span class="o">-</span><span class="n">slapd</span>
<span class="o">%</span> <span class="n">start</span><span class="o">-</span><span class="n">slapd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ldapsearch</span> <span class="o">-</span><span class="n">h</span> <span class="n">samba2</span><span class="o">.</span><span class="n">domain1</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">p</span> <span class="mi">390</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">D</span> <span class="s2">&quot;cn=Directory Manager&quot;</span> <span class="o">-</span><span class="n">w</span> <span class="n">Secret123</span> <span class="o">-</span><span class="n">b</span> <span class="s2">&quot;cn=changelog&quot;</span>
</pre></div>
</div>
</section>
<section id="dns">
<h1>DNS<a class="headerlink" href="#dns" title="Permalink to this heading">¶</a></h1>
<p>The DNS needs to be configured such that it points to both master and
replica. So if the master fails, the client will be able to find the
replica automatically.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ORIGIN domain1.com.
$TTL 1W
@               IN SOA  domain1.com. root.domain1.com. (
                                2009070913   ; serial
                                2D           ; refresh
                                4H           ; retry
                                6W           ; expiry
                                1W )         ; minimum
                IN NS   dns2

                IN A    192.168.1.101
                IN A    192.168.1.102

dns2            IN A    192.168.1.100
samba1          IN A    192.168.1.101
samba2          IN A    192.168.1.102

gc._msdcs       IN CNAME        samba1
ff3b280e-6caa-11de-ab0a-e44b8f038cdc._msdcs     IN CNAME        samba1

_gc._tcp        IN SRV 0 100 3268       samba1
_gc._tcp.Default-First-Site-Name._sites IN SRV 0 100 3268       samba1

_ldap._tcp.gc._msdcs    IN SRV 0 100 389        samba1
_ldap._tcp.Default-First-Site-Name._sites.gc._msdcs     IN SRV 0 100 389 samba1

_ldap._tcp              IN SRV 0 100 389        samba1
_ldap._tcp              IN SRV 0 100 389        samba2

_ldap._tcp.dc._msdcs    IN SRV 0 100 389        samba1
_ldap._tcp.dc._msdcs    IN SRV 0 100 389        samba2

_ldap._tcp.pdc._msdcs   IN SRV 0 100 389        samba1

_ldap._tcp.ff3b2587-6caa-11de-ab0a-e44b8f038cdc IN SRV 0 100 389        samba1
_ldap._tcp.ff3b2587-6caa-11de-ab0a-e44b8f038cdc IN SRV 0 100 389        samba2

_ldap._tcp.ff3b2587-6caa-11de-ab0a-e44b8f038cdc.domains._msdcs          IN SRV 0 100 389 samba1
_ldap._tcp.ff3b2587-6caa-11de-ab0a-e44b8f038cdc.domains._msdcs          IN SRV 0 100 389 samba2

_ldap._tcp.Default-First-Site-Name._sites               IN SRV 0 100 389 samba1
_ldap._tcp.Default-First-Site-Name._sites               IN SRV 0 100 389 samba2

_ldap._tcp.Default-First-Site-Name._sites.dc._msdcs     IN SRV 0 100 389 samba1
_ldap._tcp.Default-First-Site-Name._sites.dc._msdcs     IN SRV 0 100 389 samba2

_kerberos._tcp          IN SRV 0 100 88         samba1
_kerberos._tcp          IN SRV 0 100 88         samba2

_kerberos._tcp.dc._msdcs        IN SRV 0 100 88 samba1
_kerberos._tcp.dc._msdcs        IN SRV 0 100 88 samba2

_kerberos._tcp.Default-First-Site-Name._sites   IN SRV 0 100 88 samba1
_kerberos._tcp.Default-First-Site-Name._sites   IN SRV 0 100 88 samba2

_kerberos._tcp.Default-First-Site-Name._sites.dc._msdcs IN SRV 0 100 88 samba1
_kerberos._tcp.Default-First-Site-Name._sites.dc._msdcs IN SRV 0 100 88 samba2

_kerberos._udp          IN SRV 0 100 88         samba1
_kerberos._udp          IN SRV 0 100 88         samba2

_kerberos-master._tcp           IN SRV 0 100 88         samba1
_kerberos-master._tcp           IN SRV 0 100 88         samba2

_kerberos-master._udp           IN SRV 0 100 88         samba1
_kerberos-master._udp           IN SRV 0 100 88         samba2

_kpasswd._tcp           IN SRV 0 100 464        samba1
_kpasswd._tcp           IN SRV 0 100 464        samba2

_kpasswd._udp           IN SRV 0 100 464        samba1
_kpasswd._udp           IN SRV 0 100 464        samba2

_kerberos               IN TXT  DOMAIN1.COM
</pre></div>
</div>
<p>See also <a class="reference external" href="Obsolete:Samba_4_DNS">DNS</a>.</p>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>[<a class="reference external" href="http://technet.microsoft.com/en-us/library/cc755994(WS.10).aspx">http://technet.microsoft.com/en-us/library/cc755994(WS.10).aspx</a> How
Active Directory Replication Topology Works]</p></li>
<li><p><a class="reference external" href="http://www.improve.dk/blog/2008/03/02/setting-up-and-testing-active-directory-failover">Setting up and testing Active Directory
failover</a></p></li>
<li><p><a class="reference external" href="http://us1.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html">Backup Domain
Control</a></p></li>
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/FSMO">Flexible Single Master of
Operation</a></p></li>
<li><p><a class="reference external" href="http://support.microsoft.com/kb/255504">Using Ntdsutil.exe to transfer or seize FSMO roles to a domain
controller</a></p></li>
<li><p>[<a class="reference external" href="http://msdn.microsoft.com/en-us/library/cc964399(PROT.13).aspx">http://msdn.microsoft.com/en-us/library/cc964399(PROT.13).aspx</a>
Windows Server Protocols]</p></li>
<li><p><a class="reference external" href="http://www.centos.org/docs/5/html/CDS/ag/8.0/Managing_Replication-Configuring-Replication-cmd.html">Configuring Replication from the Command
Line</a></p></li>
<li><p><a class="reference external" href="http://www.centos.org/docs/5/html/CDS/cli/8.0/Configuration_Command_File_Reference-Core_Server_Configuration_Reference-Core_Server_Configuration_Attributes_Reference.html#Configuration_Command_File_Reference-Core_Server_Configuration_Attributes_Reference-cnchangelog5">Core Server Configuration Attributes Reference -
cn=changelog5</a></p></li>
</ul>
<p><a class="reference external" href="Category:Obsolete">Category:Obsolete</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Samba_4_Replication.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>