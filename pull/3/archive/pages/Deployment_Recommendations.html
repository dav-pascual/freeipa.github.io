<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Infrastructure &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="Developer_documentation.html" />
    <link rel="prev" title="Infrastructure" href="Demo.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Some decisions made before FreeIPA is deployed and adopted are very hard
to be fixed later, if not impossible. This article therefore digs in the
most important decisions needed for a successful deployment.</p>
<section id="infrastructure">
<h1>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this heading">¶</a></h1>
<section id="dns">
<h2>DNS<a class="headerlink" href="#dns" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="DNS">DNS</a> is deliberately listed first as DNS plays an important
role in identity management functionality, especially
<a class="reference external" href="Kerberos">Kerberos</a>.</p>
<section id="domain">
<h3>Domain<a class="headerlink" href="#domain" title="Permalink to this heading">¶</a></h3>
<p>FreeIPA should always have own primary domain, e.g. <code class="docutils literal notranslate"><span class="pre">example.com</span></code> or
<code class="docutils literal notranslate"><span class="pre">ipa.example.com</span></code> which should not be shared with other
<a class="reference external" href="Kerberos">Kerberos</a> based identity management system as otherwise
there will be collisions on Kerberos system level. For example, if both
FreeIPA and Active Directory use the same domain, <a class="reference external" href="trusts">trusts</a>
will be never possible, as well as automatic client server discovery via
<a class="reference external" href="DNS">DNS</a> SRV records.</p>
<p>Client machines do not need to be in the same domain as FreeIPA servers.
For example, FreeIPA may be a domain <code class="docutils literal notranslate"><span class="pre">ipa.example.com</span></code> and clients in
domain <code class="docutils literal notranslate"><span class="pre">clients.example.com</span></code>, there just need to be a clear mapping
between DNS domain and Kerberos realm. Standard method to create the
mapping are
<code class="docutils literal notranslate"><span class="pre">`_kerberos</span></code> &lt;<a class="reference external" href="https://web.mit.edu/kerberos/krb5-1.15/doc/admin/realm_config.html#mapping-hostnames-onto-kerberos-realms">https://web.mit.edu/kerberos/krb5-1.15/doc/admin/realm_config.html#mapping-hostnames-onto-kerberos-realms</a>&gt;`__
TXT DNS records. (FreeIPA DNS adds these automatically.)</p>
</section>
<section id="considerations-for-active-directory-integration">
<span id="id1"></span><h3>Considerations for Active Directory integration<a class="headerlink" href="#considerations-for-active-directory-integration" title="Permalink to this heading">¶</a></h3>
<p>Active Directory domain is a complex system. It includes logically
structured set of resources (machines, users, services, …) which
belong to potentially multiple DNS domains. Multiple DNS domains can be
part of the same AD domain (where AD domain is by definition same as AD
Kerberos realm). Multiple AD domains can be combined into a forest. The
very first AD domain created in the forest is called <strong>forest root
domain</strong>. Upper-cased name of the primary DNS domain of the AD domain is
used as AD Kerberos realm name.</p>
<p>IPA domain is a similarly complex system. It includes logically
structured set of resources (machines, users, services, …) which
belong to potentially multiple DNS domains. Unlike Active Directory, we
have a single IPA domain/realm per deployment and for Active Directory
this single IPA domain looks like a separate Active Directory forest.
Active Directory considers primary DNS domain used as a basis for
FreeIPA Kerberos realm to be a forest root domain for FreeIPA domain
(like forest root domain for Active Directory).</p>
<p>FreeIPA domain can be placed in <strong>any</strong> DNS domain which does not
directly overlap with any domain in Active Directory forest. It could
be, for example, <code class="docutils literal notranslate"><span class="pre">ipa.example.com</span></code>, if this DNS zone is not occupied
by any other AD domain in the same forest. It could be
<code class="docutils literal notranslate"><span class="pre">ipa.ad.example.com</span></code> too, it could be <code class="docutils literal notranslate"><span class="pre">example</span></code><strong>``.net``</strong> as
well – as long as there are no overlaps on the same DNS zone level.</p>
<p>The trust between two Active Directory forests is always established as
a trust between forest root domains of those forests. If FreeIPA domain
uses <code class="docutils literal notranslate"><span class="pre">ipa.ad.example.com</span></code> as the primary DNS zone, then we would be
saying about establishing forest trust between Active Directory forest
<code class="docutils literal notranslate"><span class="pre">ad.example.com</span></code> and FreeIPA domain <code class="docutils literal notranslate"><span class="pre">ipa.ad.example.com</span></code>. If there
are multiple DNS zones belonging to IPA domain, it is recommended to
place <code class="docutils literal notranslate"><span class="pre">`_kerberos</span></code> TXT
records &lt;<a class="reference external" href="https://web.mit.edu/kerberos/krb5-1.15/doc/admin/realm_config.html#mapping-hostnames-onto-kerberos-realms">https://web.mit.edu/kerberos/krb5-1.15/doc/admin/realm_config.html#mapping-hostnames-onto-kerberos-realms</a>&gt;`__
pointing to the FreeIPA realm name in each of them for proper discovery
of network resources by FreeIPA clients.</p>
</section>
<section id="dns-server">
<span id="id2"></span><h3>DNS server<a class="headerlink" href="#dns-server" title="Permalink to this heading">¶</a></h3>
<p>FreeIPA domain may be either served from an integrated <a class="reference external" href="DNS">DNS</a>
service or an external name service. A FreeIPA domain delegated to the
integrated <a class="reference external" href="DNS">DNS</a> service is a recommended approach.</p>
<p>When using external name server, identity management functionality or
<a class="reference external" href="trusts">trusts</a> will be possible, however the configuration will be
much more difficult and error prone. Full list of benefits of using the
integrated DNS service can be found in the <a class="reference external" href="DNS#Benefits_of_integrated_DNS">DNS
article</a>.</p>
</section>
</section>
<section id="kerberos-realm-name">
<span id="id3"></span><h2>Kerberos realm name<a class="headerlink" href="#kerberos-realm-name" title="Permalink to this heading">¶</a></h2>
<p>When you are installing first FreeIPA server you are always defining a
Kerberos realm name for this installation. When selecting the realm name
please follow these rules:</p>
<ul class="simple">
<li><p>The realm name must not conflict with any other existing Kerberos
realm name (e.g. name used by Active Directory).</p></li>
<li><p>The realm name should be upper-case (<code class="docutils literal notranslate"><span class="pre">EXAMPLE.COM</span></code>) version of
primary DNS domain name (<code class="docutils literal notranslate"><span class="pre">example.com</span></code>).</p></li>
<li><p>FreeIPA clients from multiple distinct DNS domains
(<code class="docutils literal notranslate"><span class="pre">example</span></code><strong>``.com``</strong>, <code class="docutils literal notranslate"><span class="pre">example</span></code><strong>``.net``</strong>,
<code class="docutils literal notranslate"><span class="pre">example</span></code><strong>``.org``</strong>) can be joined to single Kerberos realm
(<code class="docutils literal notranslate"><span class="pre">EXAMPLE</span></code><strong>``.COM``</strong>)</p></li>
<li><p>One FreeIPA installation always represents single Kerberos realm.</p></li>
</ul>
</section>
<section id="multi-site-deployment-awareness">
<span id="id4"></span><h2>Multi-site deployment awareness<a class="headerlink" href="#multi-site-deployment-awareness" title="Permalink to this heading">¶</a></h2>
<p>FreeIPA servers and clients may be distributed in various geographical
locations. <a class="reference external" href="V4/DNS_Location_Mechanism">DNS Location mechanism</a> allows
to split topology into separated areas called <em>locations</em> (mapping to
geographical areas). Clients using DNS SRV records (like SSSD) in a
particular location then use the servers from the same location as the
first (the closest FreeIPA servers) and servers from different locations
as the backup (remote FreeIPA servers). For more details please refer to
<a class="reference external" href="Howto/IPA_locations">FreeIPA DNS Locations HowTo document</a>.</p>
<p>When planning deployment, it is important to keep in mind that DNS
locations feature in FreeIPA require at least one DNS server in each
location. If it is necessary, multiple DNS views on external DNS servers
can be used instead of deploying DNS server for each location but such
setups are typically less resilient.</p>
</section>
<section id="pki">
<h2>PKI<a class="headerlink" href="#pki" title="Permalink to this heading">¶</a></h2>
<p>When <a class="reference external" href="PKI">PKI</a> service is configured, FreeIPA hosts and services may
obtain signed certificates from FreeIPA CA. Certificates can then be
used for authentication or secure authentication in configured services.</p>
<p>Currently, there are 3 types how FreeIPA can blend in a existent
certificate environment:</p>
<ol class="arabic simple">
<li><p>No blending - FreeIPA is simply installed with own <a class="reference external" href="PKI">PKI</a>
service and a self-signed CA certificate</p></li>
<li><p>External CA - FreeIPA is installed with own <a class="reference external" href="PKI">PKI</a>, but it’s
CA certificate is signed with external certificate authority (Active
Directory Certificate Service or other custom Certificate Service).
This requires the external CA to allow sub CAs.</p></li>
<li><p><a class="reference external" href="V3/CA-less_install">CA-less installation</a> - FreeIPA does not
configure own CA, but uses signed host certificates from external CA.</p></li>
</ol>
</section>
<section id="servers-replicas">
<h2>Servers/Replicas<a class="headerlink" href="#servers-replicas" title="Permalink to this heading">¶</a></h2>
<section id="freeipa-server-exclusivity">
<span id="id5"></span><h3>FreeIPA server exclusivity<a class="headerlink" href="#freeipa-server-exclusivity" title="Permalink to this heading">¶</a></h3>
<p>It is highly recommended to avoid deploying other applications or
services on the FreeIPA server virtual machine/bare metal machine, from
several primary reasons:</p>
<ul class="simple">
<li><p>Performance reasons - FreeIPA server can be exhaustive to the
plaform, especially when the number of LDAP objects is high</p></li>
<li><p>Stability - FreeIPA is integrated in the system and if 3rd party
application changes configuration or services FreeIPA depends on,
FreeIPA can break</p></li>
<li><p>It is easier to migrate the FreeIPA server to newer platform
(affecting for example RHEL-6 and RHEL-7 deployments)</p></li>
</ul>
</section>
<section id="number-of-servers">
<span id="id6"></span><h3>Number of servers<a class="headerlink" href="#number-of-servers" title="Permalink to this heading">¶</a></h3>
<p>FreeIPA runs in a replicated multi-master environment. The number of
servers depends on several factors:</p>
<ul class="simple">
<li><p>How many entries are in the system?</p></li>
<li><p>How many different geographically dispersed datacenters you have?</p></li>
<li><p>How active are applications and clients regarding authentications and
LDAP lookups.</p></li>
</ul>
<p>Generally it is recommended to have at least 2-3 replicas in each
datacenter. There should be at least one replica in each datacenter with
additional FreeIPA services like <a class="reference external" href="PKI">PKI</a> or <a class="reference external" href="DNS">DNS</a> if used.
Note that it is not recommended to have more than 4 replication
agreements per replica. Following example demonstrated the recommended
infrastructure:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/Topology-16.png"><img alt="Deployment example with 16 FreeIPA servers" src="../../_images/Topology-16.png" style="width: 300px;" /></a>
</figure>
<p>Deployment example with 16 FreeIPA servers</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/Topology-12.png"><img alt="Deployment example with 12 FreeIPA servers" src="../../_images/Topology-12.png" style="width: 300px;" /></a>
</figure>
<p>Deployment example with 12 FreeIPA servers</p>
</section>
</section>
<section id="clients">
<h2>Clients<a class="headerlink" href="#clients" title="Permalink to this heading">¶</a></h2>
<p>Every client should have at least 2 <a class="reference external" href="DNS">DNS</a> servers configured in
<code class="docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code> for resiliency. Update resolv.conf and <em>DHCPd</em>
configuration accordingly.</p>
<p>Enrolling each client using ipa-client-install requires access to port
443 (HTTPS) on IPA master. This is because once enrolled, client uploads
own SSH keys and performs few more operations. IPA CLI also uses the
same port to communicate to IPA master. Thus, it is required to have
access to HTTPS (443) from a client side.</p>
</section>
</section>
<section id="disaster-recovery">
<span id="id7"></span><h1>Disaster recovery<a class="headerlink" href="#disaster-recovery" title="Permalink to this heading">¶</a></h1>
<p>Please refer to <a class="reference external" href="Backup_and_Restore">Backup and Restore</a> article.</p>
</section>
<section id="active-directory-integration">
<span id="id8"></span><h1>Active Directory Integration<a class="headerlink" href="#active-directory-integration" title="Permalink to this heading">¶</a></h1>
<p>In order to be able to configure <a class="reference external" href="trusts">trusts</a>, <a class="reference external" href="DNS">DNS</a>
needs to be configured properly, FreeIPA must have an own primary DNS
domain matching it’s <a class="reference external" href="Kerberos">Kerberos</a> realm name. DNS domain and
realm have to be different from Active Directory DNS domain.</p>
<p>Another important requirement is IPv6 stack. Recommended way for
contemporary networking applications is to only open IPv6 sockets for
listening because IPv4 and IPv6 share the same port range locally.
FreeIPA uses Samba as part of its Active Directory integration and Samba
<strong>requires enabled IPv6 stack</strong> on the machine.</p>
<p><strong>DO NOT</strong> use <code class="docutils literal notranslate"><span class="pre">ipv6.disable=1</span></code> on the kernel commandline: It disables
the whole IPv6 stack and breaks Samba.</p>
<p>If necessary, adding <code class="docutils literal notranslate"><span class="pre">ipv6.disable_ipv6=1</span></code> will keep the IPv6 stack
functional but will not assign IPv6 addresses to any of your network
devices except the loopback. This is recommeneded approach for cases
when you don’t use IPv6 networking.</p>
<p>Creating and adding following lines to for example
/etc/sysctl.d/ipv6.conf will avoid assigning IPv6 addresses to a
specific network interface:</p>
<div class="line-block">
<div class="line">`` net.ipv6.conf.all.disable_ipv6 = 1``</div>
<div class="line">`` # Disabling “all” does not apply to interfaces that are already “up” when sysctl settings are applied. ``</div>
<div class="line">`` net.ipv6.conf.``<code class="docutils literal notranslate"><span class="pre">.disable_ipv6 = 1</span></code></div>
<div class="line">`` # Interface lo must have IPv6 enabled``</div>
<div class="line">`` net.ipv6.conf.lo.disable_ipv6 = 0``</div>
</div>
<p>where <em>interface0</em> is your specialized interface. Note that all we are
requiring is that IPv6 stack is enabled at the kernel level and this is
recommended way to develop networking applications for a long time
already.</p>
</section>
<section id="migration">
<h1>Migration<a class="headerlink" href="#migration" title="Permalink to this heading">¶</a></h1>
<p>FreeIPA can already <a class="reference external" href="Howto/Migration">migrate</a> from a general LDAP
server or NIS. It cannot, however, automatic migration from a pure
Kerberos solution or from other FreeIPA deployment (see tickets
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3656">#3656</a> and
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/4285">#4285</a>).</p>
</section>
<section id="extending-freeipa">
<span id="id9"></span><h1>Extending FreeIPA<a class="headerlink" href="#extending-freeipa" title="Permalink to this heading">¶</a></h1>
<p>Both FreeIPA schema, CLI and <a class="reference external" href="Web_UI">Web UI</a> can be extended.
<a class="reference external" href="Directory_Server">Directory Server</a> schema needs to be extended
manually on one server via LDAP manipulation tools. On the other hand,
both CLI and Web UI can be extended with plugins shipped together with
vanilla FreeIPA packages. See <a class="reference external" href="Documentation">Documentation</a> for
additional resources on how to write the extensions.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Deployment_Recommendations.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>