<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Design documentation for Second Round of UI" href="Second_Round_Of_UI_design.html" />
    <link rel="prev" title="Introduction" href="Permissions.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>In a large authentication infrastructure upgrading can be difficult. Not
all servers can be brought down and upgraded at once. Instead a rolling
upgrade is preferred where the new version is installed incrementally
across the infrastructure, aka a rolling upgrade.</p>
<p>Therefore we need to be able to always provide smooth upgrades where a
few servers are upgraded in groups between point releases. All servers
should be brought into the same version as quickly as possible,
preferably hours or days and not weeks.</p>
<p>It may not be possible to upgrade any release to any other release.
Intermediate steps may be required (e.g. upgrade v2.1 to 2.3 to 3.0)</p>
</section>
<section id="what-is-a-server">
<span id="id1"></span><h1>What is a server?<a class="headerlink" href="#what-is-a-server" title="Permalink to this heading">¶</a></h1>
<p>We use the phrase “IPA server” a lot but in fact there is no IPA server.
IPA is a mechanism to get a lot of moving parts (389-ds, MIT Kerberos,
DNS, dogtag) to work well together. Careless upgrading of any of these
can cause problems.</p>
<p>On top of this sits the IPA management framework to manage identity
data.</p>
</section>
<section id="upgrade-strategy">
<span id="id2"></span><h1>Upgrade Strategy<a class="headerlink" href="#upgrade-strategy" title="Permalink to this heading">¶</a></h1>
<p>IPA will use a so-called “split brain” strategy for upgrades. With this
the infrastructure will actually be running two different versions of
the software for a brief period while the upgrade is being rolled out.
Replication will be disabled to incompatible servers, preventing
upgraded data from flowing to non-upgraded servers.</p>
<p>This is the split condition. Data will not be replicated between
dissimilar servers until they are running the same version. Changes on
these servers will queue up until the servers either reconnect or the
changelog fills, potentially causing lost updates.</p>
<section id="version">
<h2>Version<a class="headerlink" href="#version" title="Permalink to this heading">¶</a></h2>
<p>In this context Version means data version for the purposes of
determining if an upgrade is incompatible. Not every IPA update may
change the version.</p>
<p>The version will be compiled into the IPA binaries and will be stored in
two places:</p>
<ul class="simple">
<li><p>ipalib/constants.py for the management framework</p></li>
<li><p>hardcoded in a new DS version plugin</p></li>
</ul>
<p>This version is literally hardcoded into the binaries and lets us
determine if the installed version is compatible with other IPA
replicas. We have no way of preventing a server to be installed with a
particular set of binaries. We do have a way from preventing that
version from interfering with other servers.</p>
<p>The 389-ds replication plugin will add hooks to be able to register a
version. The IPA plugin will use those hooks to register the version.</p>
</section>
<section id="version-format">
<span id="id3"></span><h2>Version format<a class="headerlink" href="#version-format" title="Permalink to this heading">¶</a></h2>
<p>The version will be stored as a date which will make comparisons a lot
easier (e.g. 201003081732).</p>
</section>
<section id="ipa-management-utilities">
<span id="id4"></span><h2>IPA management utilities<a class="headerlink" href="#ipa-management-utilities" title="Permalink to this heading">¶</a></h2>
<p>The IPA management utilities will send their installed version when they
communicate to the IPA XML-RPC server. The server will use this version
to decide if it will work with the client (this is the purpose of
putting the IPA version into <code class="docutils literal notranslate"><span class="pre">ipalib/constants.py</span></code>)</p>
</section>
</section>
<section id="the-upgrade-process">
<span id="id5"></span><h1>The Upgrade Process<a class="headerlink" href="#the-upgrade-process" title="Permalink to this heading">¶</a></h1>
<p>Each instance will be upgraded separately. The basic process is:</p>
<ul class="simple">
<li><p>Stop IPA services (<code class="docutils literal notranslate"><span class="pre">/usr/sbin/ipactl</span> <span class="pre">stop</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">update</span> <span class="pre">ipa-*</span></code></p>
<ul>
<li><p>we may want a %pretrans to stop the yum process if IPA is still
running</p></li>
<li><p>in %post we will call <code class="docutils literal notranslate"><span class="pre">setup-ds</span> <span class="pre">-u</span></code> to apply updates via ldif
snippets</p></li>
</ul>
</li>
<li><p>Start IPA service (<code class="docutils literal notranslate"><span class="pre">/usr/sbin/ipactl</span> <span class="pre">start</span></code>)</p></li>
</ul>
<p>The process of upgrading a set of IPA servers does not have to happen at
once but should happen relatively quickly. While there are incompatible
versions of IPA in a network replication will not work between them.
Changes will be queued in the 389-ds changelog but the more changes
there are the more likelihood that MMR will need to determine winners
and losers.</p>
</section>
<section id="changes-to-replica-installation-process">
<span id="id6"></span><h1>Changes to Replica Installation Process<a class="headerlink" href="#changes-to-replica-installation-process" title="Permalink to this heading">¶</a></h1>
<p>Early in the IPA replica installer we will need to do a version check to
ensure that a different version replica isn’t added. We don’t want old
servers to be added to an IPA domain. The initial replication population
would fail anyway due to the version checking.</p>
</section>
<section id="types-of-incompatibilities">
<span id="id7"></span><h1>Types of Incompatibilities<a class="headerlink" href="#types-of-incompatibilities" title="Permalink to this heading">¶</a></h1>
<p>Here is a brief list of changes that would probably require the version
to increase:</p>
<ul class="simple">
<li><p>New Directory Server plugin</p></li>
<li><p>Enhanced Directory Server plugin, not backwards compatible</p></li>
<li><p>New IPA management plugin</p></li>
<li><p>Enhanced IPA management plugin, not backwards compatible</p></li>
<li><p>Updated schema on existing entries</p></li>
<li><p>Updated DIT</p></li>
<li><p>Update to a component</p></li>
</ul>
</section>
<section id="clients">
<h1>Clients<a class="headerlink" href="#clients" title="Permalink to this heading">¶</a></h1>
<p>A client using the management framework will have its own local copy of
the server plugins to know what information to gather for a given
request. This too can become out-of-date. The ipa client will need to
send a version in each XML-RPC request and the server will decide if it
can honor the request.</p>
<p>There are three scenarios:</p>
<ol class="arabic simple">
<li><p>A newer client talking to an older server</p></li>
<li><p>An older client talking to a newer server</p></li>
<li><p>A client talking the same version</p></li>
</ol>
<p>A newer client talking to an older server will need to be handled by
code within the framework. It is possible that the conversation can’t
happen at all if the remote server is too old.</p>
<p>An older client talking with a newer server MAY be supported but will
need to be handled on a case-by-case basis. Chances are that not every
plugin will be updated on every update so some should work fine with
older clients. It is possible that some requests will be rejected as too
old a client.</p>
</section>
<section id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>DS add version interface to replication plugin</p></li>
<li><p>IPA implement a version plugin</p></li>
<li><p>IPA add version checks to replica installer</p></li>
<li><p>IPA enhance ipactl command</p></li>
<li><p>IPA add version to XML-RPC protocol</p></li>
<li><p>IPA management framework enforce version</p></li>
<li><p>IPA update rpm installation scriptlets to:</p>
<ul>
<li><p>Check for running services and abort install</p></li>
<li><p>Automatically apply updates post-install</p></li>
</ul>
</li>
<li><p>IPA use DS upgrade mechanism (setup-ds.pl -u)</p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V2/RollingUpgrade.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>