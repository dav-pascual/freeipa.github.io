<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Common variables &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scope" href="External_Collaboration_Domains.html" />
    <link rel="prev" title="Introduction" href="Entitlements_Design.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Authenticating via Apache will set a number of environment variables,
depending on the configuration and the authentication method. I’m
skipping digest authentication because that is not commonly used.</p>
<section id="common-variables">
<span id="id1"></span><h1>Common variables<a class="headerlink" href="#common-variables" title="Permalink to this heading">¶</a></h1>
<p>A number of useful variables are set by Apache itself, they include:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>DOCUMENT_ROOT</p></td>
<td><p>The directory the current file/script is
executing</p></td>
</tr>
<tr class="row-even"><td><p>HTTP_ACCEPT</p></td>
<td><p>Contents of Accept: header</p></td>
</tr>
<tr class="row-odd"><td><p>HTTP_HOST</p></td>
<td><p>Contents of Host: header</p></td>
</tr>
<tr class="row-even"><td><p>HTTP_USER_AGENT</p></td>
<td><p>Contents of User-Agent: header</p></td>
</tr>
<tr class="row-odd"><td><p>QUERY_STRING</p></td>
<td><p>The query string, if any</p></td>
</tr>
<tr class="row-even"><td><p>REMOTE_ADDR</p></td>
<td><p>The IP address of the client</p></td>
</tr>
<tr class="row-odd"><td><p>REMOTE_PORT</p></td>
<td><p>The port of the client machine</p></td>
</tr>
<tr class="row-even"><td><p>REQUEST_METHOD</p></td>
<td><p>The HTTP request method</p></td>
</tr>
<tr class="row-odd"><td><p>REQUEST_SCHEME</p></td>
<td><p>The scheme of the reqeust (e.g. http)</p></td>
</tr>
<tr class="row-even"><td><p>REQUEST_URI</p></td>
<td><p>The requested URI</p></td>
</tr>
<tr class="row-odd"><td><p>SERVER_ADDR</p></td>
<td><p>The IP address of the server</p></td>
</tr>
<tr class="row-even"><td><p>SERVER_NAME</p></td>
<td><p>The hostname of the server or virtual host</p></td>
</tr>
<tr class="row-odd"><td><p>SERVER_PORT</p></td>
<td><p>The port on the server</p></td>
</tr>
<tr class="row-even"><td><p>SERVER_PROTOCOL</p></td>
<td><p>Name and version of the request protocol</p></td>
</tr>
<tr class="row-odd"><td><p>SERVER_SIGNATURE</p></td>
<td><p>Server version and virtual host name added to
server-generated pages</p></td>
</tr>
<tr class="row-even"><td><p>SERVER_SOFTWARE</p></td>
<td><p>Server identification string</p></td>
</tr>
<tr class="row-odd"><td><p>UNIQUE_ID</p></td>
<td><p>ID set to be unique across requests.
mod_unique_id</p></td>
</tr>
</tbody>
</table>
</section>
<section id="basic-authentication">
<span id="id2"></span><h1>Basic Authentication<a class="headerlink" href="#basic-authentication" title="Permalink to this heading">¶</a></h1>
<p>Basic authentication is managed by Apache.</p>
<ul class="simple">
<li><p>AUTH_TYPE=Basic</p></li>
<li><p>REMOTE_USER=username</p></li>
</ul>
<p>The configuration may look something like:</p>
<div class="line-block">
<div class="line">`` AuthType Basic``</div>
<div class="line">`` AuthName “Restricted Files”``</div>
<div class="line">`` AuthBasicProvider file``</div>
<div class="line">`` AuthUserFile /etc/httpd/conf/passwords``</div>
<div class="line">`` Require valid-user``</div>
</div>
<p>The user database would be created with this:</p>
<p><code class="docutils literal notranslate"><span class="pre">htpasswd -c /etc/httpd/conf/passwords testuser</span></code></p>
</section>
<section id="kerberos-authentication">
<span id="id3"></span><h1>Kerberos Authentication<a class="headerlink" href="#kerberos-authentication" title="Permalink to this heading">¶</a></h1>
<p>Kerberos authentication is managed by mod_auth_gssapi or mod_auth_kerb.</p>
<ul class="simple">
<li><p>AUTH_TYPE=Negotiate</p></li>
<li><p><a class="reference external" href="mailto:REMOTE_USER=admin&#37;&#52;&#48;EXAMPLE&#46;COM">REMOTE_USER=admin<span>&#64;</span>EXAMPLE<span>&#46;</span>COM</a></p></li>
</ul>
<p>If delegation is enabled in the client and the server configuration
includes KrbSaveCredentials on, then KRB5CCNAME will be set pointing to
the user’s keytab.</p>
<p>The configuration may look something like</p>
<div class="line-block">
<div class="line">`` AuthType GSSAPI``</div>
<div class="line">`` AuthName “Kerberos Login”``</div>
<div class="line">`` GssapiCredStore keytab:/etc/http.keytab``</div>
</div>
<p>for mod_auth_gssapi or for mod_auth_kerb:</p>
<div class="line-block">
<div class="line">`` AuthType Kerberos``</div>
<div class="line">`` AuthName “Kerberos Login”``</div>
<div class="line">`` KrbMethodNegotiate on``</div>
<div class="line">`` KrbMethodK5Passwd off``</div>
<div class="line">`` KrbServiceName HTTP``</div>
<div class="line">`` KrbAuthRealms EXAMPLE.COM``</div>
<div class="line">`` Krb5KeyTab /etc/httpd/conf/ipa.keytab``</div>
<div class="line">`` KrbSaveCredentials on``</div>
</div>
</section>
<section id="x-509-authentication">
<span id="id4"></span><h1>X.509 Authentication<a class="headerlink" href="#x-509-authentication" title="Permalink to this heading">¶</a></h1>
<p>X.509 authentication is managed by either mod_nss or mod_ssl (or
mod_gnutls about which I know very little).</p>
<p>No specific AUTH_TYPE is set, see
<a class="reference external" href="https://issues.apache.org/bugzilla/show_bug.cgi?id=45058">https://issues.apache.org/bugzilla/show_bug.cgi?id=45058</a></p>
<p>The value of REMOTE_USER is dependent upon the configuration. If
SSLUserName or NSSUserName is set then that component of the client
certificate DN is set. The exception is when FakeBasicAuth is set, in
which case the full DN is set.</p>
<p>By default only the standard CGI environment variables are included,
plus HTTPS.</p>
<p>A number of SSL-specific variables are set if ExportCertData is enabled
in SSLOptions or NSSOptions.</p>
<p>There may be some slight differences in the variables available in
mod_ssl and mod_nss. For example, SSL_TLS_SNI is not available in
mod_nss.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;Directory &quot;/var/www/secure&quot;&gt;</span></code></div>
<div class="line">``    NSSOptions +StdEnvVars``</div>
<div class="line">``    NSSVerifyClient Require``</div>
</div>
<p>The mod_ssl configuration is similar. Replace NSS with SSL.</p>
<p>The variables are named the same between mod_ssl and mod_nss though the
contents may differ slightly. The set of variables available in httpd
2.4 are.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>HTTPS</p></td>
<td><p>HTTPS is being used.</p></td>
</tr>
<tr class="row-even"><td><p>SSL_PROTOCOL</p></td>
<td><p>The SSL protocol version (SSLv2, SSLv3,
TLSv1, TLSv1.1, TLSv1.2)</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SESSION_ID</p></td>
<td><p>The hex-encoded SSL session id</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CIPHER</p></td>
<td><p>The cipher specification name</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CIPHER_EXPORT</p></td>
<td><p>true if cipher is an export cipher</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CIPHER_USEKEYSIZE</p></td>
<td><p>Number of cipher bits (actually used)</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CIPHER_ALGKEYSIZE</p></td>
<td><p>Number of cipher bits (possible)</p></td>
</tr>
<tr class="row-even"><td><p>SSL_COMPRESS_METHOD</p></td>
<td><p>SSL compression method negotiated</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_VERSION_INTERFACE</p></td>
<td><p>The mod_ssl program version</p></td>
</tr>
<tr class="row-even"><td><p>SSL_VERSION_LIBRARY</p></td>
<td><p>The OpenSSL program version</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_M_VERSION</p></td>
<td><p>The version of the client certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_M_SERIAL</p></td>
<td><p>The serial of the client certificate</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_S_DN</p></td>
<td><p>Subject DN in client’s certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_S_DN_x509</p></td>
<td><p>Component of client’s Subject DN</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_I_DN</p></td>
<td><p>Issuer DN of client’s certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_I_DN_x509</p></td>
<td><p>Component of client’s Issuer DN</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_V_START</p></td>
<td><p>Validity of client’s certificate (start
time)</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_V_END</p></td>
<td><p>Validity of client’s certificate (end
time)</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_V_REMAIN</p></td>
<td><p>Number of days until client’s certificate
expires</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_A_SIG</p></td>
<td><p>Algorithm used for the signature of
client’s certificate</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_A_KEY</p></td>
<td><p>Algorithm used for the public key of
client’s certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_CERT</p></td>
<td><p>PEM-encoded client certificate</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_CLIENT_CERT_CHAIN_n</p></td>
<td><p>PEM-encoded certificates in client
certificate chain</p></td>
</tr>
<tr class="row-even"><td><p>SSL_CLIENT_VERIFY</p></td>
<td><p>NONE, SUCCESS, GENEROUS or FAILED:reason</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SERVER_M_VERSION</p></td>
<td><p>The version of the server certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_SERVER_M_SERIAL</p></td>
<td><p>The serial of the server certificate</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SERVER_S_DN</p></td>
<td><p>Subject DN in server’s certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_SERVER_S_DN_x509</p></td>
<td><p>Component of server’s Subject DN</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SERVER_I_DN</p></td>
<td><p>Issuer DN of server’s certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_SERVER_I_DN_x509</p></td>
<td><p>Component of server’s Issuer DN</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SERVER_V_START</p></td>
<td><p>Validity of server’s certificate (start
time)</p></td>
</tr>
<tr class="row-even"><td><p>SSL_SERVER_V_END</p></td>
<td><p>Validity of server’s certificate (end
time)</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SERVER_A_SIG</p></td>
<td><p>Algorithm used for the signature of
server’s certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_SERVER_A_KEY</p></td>
<td><p>Algorithm used for the public key of
server’s certificate</p></td>
</tr>
<tr class="row-odd"><td><p>SSL_SERVER_CERT</p></td>
<td><p>PEM-encoded server certificate</p></td>
</tr>
<tr class="row-even"><td><p>SSL_TLS_SNI</p></td>
<td><p>Contents of the SNI TLS extension (if
supplied with ClientHello)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="ldap-authentication">
<span id="id5"></span><h1>LDAP authentication<a class="headerlink" href="#ldap-authentication" title="Permalink to this heading">¶</a></h1>
<p>Apache provides the module mod_authnz_ldap to perform authentication and
authorization over LDAP.</p>
<p>A simple configuration looks like:</p>
<div class="line-block">
<div class="line">``   AuthType Basic``</div>
<div class="line">``   AuthName “LDAP Protected”``</div>
<div class="line">``   AuthBasicProvider ldap``</div>
<div class="line">``   AuthLDAPURL <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">```ldap://127.0.0.1/dc=example,dc=com?uid?one</span></code> &lt;<a class="reference external" href="ldap://127.0.0.1/dc=example,dc=com?uid">ldap://127.0.0.1/dc=example,dc=com?uid</a>?one&gt;`__</div>
<div class="line">``   Require valid-user``</div>
</div>
<p>Authorization can be done by specifying the allowed users, groups,
attribute with in an entry or even a filter.</p>
<p>Attributes can be specified in the AuthLDAPURL value such that those
values are set as environment variables of the form “<a href="#id9"><span class="problematic" id="id10">AUTHENTICATE_</span></a>”, so
any arbitrary list of values may be provided.</p>
</section>
<section id="proposed-additional-variables">
<span id="id6"></span><h1>Proposed Additional Variables<a class="headerlink" href="#proposed-additional-variables" title="Permalink to this heading">¶</a></h1>
<p>When Apache module is used for authentication, the authentication result
is passed to the application typically in the form of environment
variable REMOTE_USER. Current web applications however want and need to
create the user record in their internal databases so that foreign keys
validate, and applications also want to do access control checks
(authorizations) – applications typically don’t rely on Apache modules
for authorization.</p>
<p>We are in need of a way for Apache modules to pass information about the
authenticated user beyond the login name (in REMOTE_USER) to the
application. That way the applications do not need to implement all
possible authentication mechanisms (Kerberos, SAML, LDAP, …) and can
depend on specialized <a href="#id11"><span class="problematic" id="id12">mod_auth_</span></a>* modules to do it, while being able to
know what user to populate and maintain in their internal user database.</p>
<p>We propose Apache modules that wish to pass information about users to
applications adopt the following environment variable names:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Variable name</p></th>
<th class="head"><p>Semantics</p></th>
<th class="head"><p>Possible
source</p></th>
<th class="head"><p>Example
<a href="#id7"><span class="problematic" id="id8">`</span></a>mod_l
ookup_identity</p>
<blockquote>
<div><p>&lt;<a class="reference external" href="http://www.a">http://www.a</a></p>
</div></blockquote>
<p>delton.com/apa
che/mod_lookup
_identity/&gt;`__
configuration</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>REMO
TE_USER_GROUPS</p></td>
<td><p>c
olon-separated
list of group
names the user
is in</p></td>
<td><p>POSIX call
getgrouplist;
sssd dbus call
o
rg.freedesktop
.sssd.infopipe
.GetUserGroups</p></td>
<td><p>Look
upOutputGroups
REMO
TE_USER_GROUPS
:</p></td>
</tr>
<tr class="row-odd"><td><p>REMOTE
_USER_GROUP_N,
REMOTE
_USER_GROUP_1,
REMOTE
_USER_GROUP_2,
…</p></td>
<td><p>number of user
groups and
individual
group names</p></td>
<td><p>alternate way
to get the
list of
groups,
avoiding the
split needed
with
REMO
TE_USER_GROUPS</p></td>
<td><p>Lookup
UserGroupsIter
REM
OTE_USER_GROUP</p></td>
</tr>
<tr class="row-even"><td><p>REM
OTE_USER_GECOS</p></td>
<td><p>Equivalent of
the GECOS
value from the
password file,
could be full
name.</p></td>
<td><p>pw_gecos field
of result of
POSIX call
getpwname; IPA
attribute
gecos, sssd
dbus call
org.freedeskt
op.sssd.infopi
pe.GetUserAttr
gecos</p></td>
<td><p>L
ookupUserGECOS
REM
OTE_USER_GECOS
or
LookupUserAttr
gecos
REM
OTE_USER_GECOS</p></td>
</tr>
<tr class="row-odd"><td><p>REMO
TE_USER_DOMAIN</p></td>
<td><p>domain the
user was
authenticated
in (could be
the domain in
sssd, nss,
LDAP, etc.)</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>REM
OTE_USER_EMAIL</p></td>
<td><p>user’s email
address</p></td>
<td><p>IPA attribute
mail,
sssd-dbus
attribute mail</p></td>
<td><p>LookupUserAttr
mail
REM
OTE_USER_EMAIL</p></td>
</tr>
<tr class="row-odd"><td><p>REMOTE_US
ER_GROUPS_JSON</p></td>
<td><p>list of groups
the user is
in, formatted
as JSON string</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a href="#id13"><span class="problematic" id="id14">REMOTE_</span></a>
USER_FIRSTNAME</p></td>
<td><p>user’s first
name</p></td>
<td><p>IPA attribute
givenname,
sssd-dbus
attribute
givenname</p></td>
<td><p>LookupUserAttr
givenname
<a href="#id15"><span class="problematic" id="id16">REMOTE_</span></a>
USER_FIRSTNAME</p></td>
</tr>
<tr class="row-odd"><td><p>REMOTE_U
SER_MIDDLENAME</p></td>
<td><p>user’s middle
name</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>REMOTE
_USER_LASTNAME</p></td>
<td><p>user’s last
name</p></td>
<td><p>IPA attribute
sn, sssd-dbus
attribute sn</p></td>
<td><p>LookupUserAttr
sn
REMOTE
_USER_LASTNAME</p></td>
</tr>
<tr class="row-odd"><td><p>REMOTE
_USER_FULLNAME</p></td>
<td><p>user’s full
name formatted
as one string
(similar to
and possibly
the same as
REMO
TE_USER_GECOS)</p></td>
<td><p>IPA attribute
cn or
displayname,
sssd-dbus
attribute cn
or displayname</p></td>
<td><p>LookupUserAttr
cn
REMOTE
_USER_FULLNAME
or
LookupUserAttr
displayname
REMOTE
_USER_FULLNAME</p></td>
</tr>
<tr class="row-even"><td><p>REMOT
E_USER_ORGUNIT</p></td>
<td><p>organizational
unit to which
the user
belongs</p></td>
<td><p>IPA attribute
ou, sssd-dbus
attribute ou</p></td>
<td><p>LookupUserAttr
ou
REMOT
E_USER_ORGUNIT</p></td>
</tr>
<tr class="row-odd"><td><p>REMOTE_US
ER_EXTERNAL_ID</p></td>
<td><p>SID, GUID, or
other unique
identifier
from the
external
identity
provider; used
to reconcile
account after
login change</p></td>
<td><p>IPA attribute
ipaUniqueId,
389 DS
attribute
nsUniqueID, AD
attribute
objectSid</p></td>
<td><p>LookupUserAttr
ipaUniqueId
REMOTE_US
ER_EXTERNAL_ID</p></td>
</tr>
<tr class="row-even"><td><p>EXTER
NAL_AUTH_ERROR</p></td>
<td><p>when external
authentication
fails (and
REMOTE_USER is
not set), this
variable can
contain error
describing the
reason</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The character set for values should be UTF-8.</p>
<p>The list above is not exhaustive, authentication and identity modules
can provide additional variables with other values and meanings and
applications are welcome to use them.</p>
<p>Module mod_lookup_identity
(<a class="reference external" href="http://www.adelton.com/apache/mod_lookup_identity/">documentation</a>,
<a class="reference external" href="http://fedorapeople.org/cgit/adelton/public_git/mod_lookup_identity.git/">git
repo</a>)
has been created as a proof of concept for this way of information
passing. The full functionality depends on the sssd-dbus package (not
yet released, in testing).</p>
<p>Module mod_intercept_form_submit
(<a class="reference external" href="http://www.adelton.com/apache/mod_intercept_form_submit/">documentation</a>,
<a class="reference external" href="http://fedorapeople.org/cgit/adelton/public_git/mod_intercept_form_submit.git/">git
repo</a>)
has been created as a proof of concept for PAM authentication based on
form submission and it supports the REMOTE_USER and EXTERNAL_AUTH_ERROR
outputs, plus mod_lookup_identity can work based on the
mod_intercept_form_submit authentication result (latest versions of both
modules required).</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Environment_Variables.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>