<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="AD_Users_Login.html" />
    <link rel="prev" title="Overview" href="ACME.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Currently the ability of FreeIPA/SSSD to resolve and authenticate AD
users by their short names is quite limited. While
<code class="docutils literal notranslate"><span class="pre">default_domain_suffix</span></code> option in <code class="docutils literal notranslate"><span class="pre">sssd.conf</span></code> can be used to resolve
short names incoming from single AD domain, it quickly becomes unusable
if the same functionality is desired for users from multiple trusted
forests. Moreover, being a local setting, each node has to be configured
manually which does not scale in larger deployments.</p>
<p>In order to further improve the integration with Active
Directory-managed deployments, this design proposes a centrally managed
mechanism that can be used by clients (SSSD) to resolve short names to
fully-qualified identifiers, use them to authenticate users and cache
the results.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>FreeIPA Administrator manages access to Unix resources for AD users
coming from multiple forests/domains. In order to improve UX for
these users he wishes to have a mechanism that permits them to log
into FreeIPA-enrolled machines using their short name only</p></li>
<li><p>The administrator also wishes to have the ability to manually set the
trusted forest/domain priority during user lookup so that the AD
forest whose users are accessing IPA-managed machines most often is
resolved first thus increasing performance</p></li>
<li><p>The administrator also wishes to manage the domain list centrally on
FreeIPA masters. The changes should be immediately seen and consumed
by all SSSD clients in the topology which have the capability to
resolve AD users by short name.</p></li>
<li><p>the administrator wishes to have both a global settings and a local
overrides applicable to selected hosts/hostgroups when a more
fine-grained short name resolution is required</p></li>
</ul>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>NOTE: This design concerns mostly the server-side implementation and
management of data consumable by SSSD client.</p>
<p>The ordered list of domains used for resolution of user short name to
the full-qualified form will be referred to as domain resolution order
in the rest of this document.</p>
<section id="domain-resolution-order-storage-and-interpretation">
<span id="id1"></span><h2>Domain resolution order storage and interpretation<a class="headerlink" href="#domain-resolution-order-storage-and-interpretation" title="Permalink to this heading">¶</a></h2>
<p>The domain resolution order will be stored as a part of Global
configuration object. If the attribute exists and is not empty ( i.e.
contains at least one domain) the client shall extract the ordered list
of domains from it and used them to resolve an incoming short name
iteratively until a matching user is found. If the short name occurs in
multiple forests/domains (e.g. Administrator), the first matching entry
is used during authentication. If such behavior is undesired, the
affected user must specify his fully-qualified name upon login.</p>
<p>Any domain which is not contained in domain resolution order will not be
used in short name resolution. Any user belonging to such domain has to
use his fully-qualified name to login to IPA domain.</p>
<p>By the extension of the previous rule, empty domain resolution order can
imply that all users (even those in FreeIPA domain) have to use
fully-qualified names to log into enrolled machines. The exact
interpretation of these rule can, however, be left on the client
application.</p>
</section>
<section id="global-vs-local-domain-resolution-order-settings">
<span id="id2"></span><h2>Global vs. local domain resolution order settings<a class="headerlink" href="#global-vs-local-domain-resolution-order-settings" title="Permalink to this heading">¶</a></h2>
<p>There will be a means to manage a global domain resolution order
applicable for all enrolled hosts in the IPA domain. The global settings
can be overriden for selected hosts/hostgroups by attaching a local
configuration to a specific ID view object. The override can be created
also when no global definition is set so that the feature can first be
tested on selected hostgroup and then applied globally when desired.</p>
</section>
<section id="domain-resolution-order-management">
<span id="id3"></span><h2>Domain resolution order management<a class="headerlink" href="#domain-resolution-order-management" title="Permalink to this heading">¶</a></h2>
<p>The feature will provide a simple API for the management of the domain
resolution order. More sophisticated API may be provided later if demand
for better user experience arises. For example, the following high-level
operations may be considered in the future:</p>
<ul class="simple">
<li><p>prepending and appending selected domains to the list</p></li>
<li><p>inserting the domains before and after other domain which is already
in the list</p></li>
<li><p>moving the domains at the beginning and the end of the list</p></li>
<li><p>moving the domains before another domain already in the list</p></li>
<li><p>removing domain names present in the list</p></li>
<li><p>refreshing the domain list: this operation will check whether all
domains present are active or exist in the trust objects and remove
stale entries</p></li>
</ul>
<p>Additionally, the commands that retrieve trusted domain information
(<code class="docutils literal notranslate"><span class="pre">trust-fetch-domains</span></code>) and manipulate trusted domains
(<code class="docutils literal notranslate"><span class="pre">trustdomain-disable</span></code>, <code class="docutils literal notranslate"><span class="pre">trustdomain-del</span></code>) may query domain
resolution order and remove stale domains from it when the trusted
domain was removed or disabled.</p>
</section>
<section id="domain-resolution-order-validation">
<span id="id4"></span><h2>Domain resolution order validation<a class="headerlink" href="#domain-resolution-order-validation" title="Permalink to this heading">¶</a></h2>
<p>Finally, any modification of the domain resolution order must ensure
that each of the specified domain names corresponds either to that of
FreeIPA domain or to one of the trusted AD domains stored in LDAP
backend. In the case of trusted domains, the domain must not be marked
as disabled.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>The LDAP schema of the global config object
(<code class="docutils literal notranslate"><span class="pre">cn=ipaConfig,cn=etc,$SUFFIX</span></code>) and ID view objects will be extended
by a new objectclass providing the attribute which stores the domain
resolution:</p>
<div class="line-block">
<div class="line">``   objectclasses: ( 2.16.840.1.113730.3.8.12.39  NAME ‘ipaNameResolutionData’ DESC ‘Data used to resolve short names``</div>
<div class="line">``   to fully-qualified form’ SUP top AUXILIARY MAY ( ipaDomainResolutionOrder ) X-ORIGIN ‘IPA v4.5’ )``</div>
</div>
<div class="line-block">
<div class="line">``   attributeTypes: ( 2.16.840.1.113730.3.8.11.77 NAME ‘ipaDomainResolutionOrder’ DESC ‘List of domains used to resolve ``</div>
<div class="line">``   a short name’ EQUALITY caseIgnoreIA5Match SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 SINGLE-VALUE X-ORIGIN ‘IPA v4.5’ )``</div>
</div>
<p>The value of the <code class="docutils literal notranslate"><span class="pre">ipaDomainResolutionOrder</span></code> consist of a
colon-separated list of domain names (e.g
<code class="docutils literal notranslate"><span class="pre">domain1.test:ad.domain2.test:ad.domain3.test</span></code>. The client is
responsible to retrieve and parse this value in order to decode the list
of domains it should consult for short name resolution.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>The WebUI should provide a way to view and manipulate the domain
resolution order under the <code class="docutils literal notranslate"><span class="pre">Configuration</span></code> tab.</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">config</span></code> object will gain <code class="docutils literal notranslate"><span class="pre">domain-resolution-order</span></code> option which
contains the raw attribute value which can be displayed by
<code class="docutils literal notranslate"><span class="pre">config-show</span></code> and (re-)set by <code class="docutils literal notranslate"><span class="pre">config-mod</span></code>.</p>
<p>Higher level commands may be considered in the future if there is a
demand for better user experience.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>The feature is considered disabled if the domain resolution order is
absent in the configuration and applied ID view. In this case the client
shall retain the default behavior when handling incoming users.</p>
<p>If the domain resolution order (or its override) is present and empty,
then the client may either keep the default behavior or force all users
to use fully qualified names to access resources in FreeIPA domain.</p>
</section>
</section>
<section id="upgrade">
<h1>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this heading">¶</a></h1>
<p>Upon upgrade the LDAP schema will be updated and the ipaConfig object
will be augmented by the new objectclass.</p>
<p>Since updating the objectclasses of all ID View objects can potentially
be costly, the existing ID views will be updated on-demand by the
framework code. ID views created after the upgrade will include the new
objectclass automatically.</p>
<p>The feature is considered backwards compatible since the old client
which do not understand domain resolution order will simply ignore it
and keep original behavior.</p>
</section>
<section id="how-to-use">
<h1>How to Use<a class="headerlink" href="#how-to-use" title="Permalink to this heading">¶</a></h1>
<p>Consider the following scenario as an example:</p>
<p>FreeIPA domain ‘ipa.test’ is trusting a forest ‘ad.forest.test’ which
has two child domains (‘child1.ad.forest.test’,
‘child2.ad.forest.test’).</p>
<p>To allow users from both FreeIPA domain and from the trusted AD forest
log in using short name, we may do the following:</p>
<section id="example-1-create-a-global-resolution-order">
<span id="id5"></span><h2>Example 1: Create a global resolution order<a class="headerlink" href="#example-1-create-a-global-resolution-order" title="Permalink to this heading">¶</a></h2>
<p>just directly set the value of <code class="docutils literal notranslate"><span class="pre">--domain-resolution-order</span></code> attribute
to the desired value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa config-mod --domain-resolution-order=&#39;ipa.test:ad.forest.test:child1.ad.forest.test:child2.ad.forest.test&#39;
  Maximum username length: 32
  Home directory base: /home
  ...
  Domain Resolution Order: ipa.test:ad.forest.test:child1.ad.forest.test:child2.ad.forest.test
  ...
</pre></div>
</div>
</section>
<section id="example-1-more-conductive-to-automation">
<span id="id6"></span><h2>Example 1 more conductive to automation<a class="headerlink" href="#example-1-more-conductive-to-automation" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>store to FreeIPA domain name in the temporary file which will store
the entries of interest:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa env domain | awk &#39;{print $2}&#39; &gt; domain_list.txt
</pre></div>
</div>
<ul class="simple">
<li><p>append the list of trusted domains to the file:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa trustdomain-find ad.forest.test --pkey-only --raw | grep &#39;cn:&#39; | awk &#39;{ print $2}&#39; &gt;&gt; domain_list.txt
</pre></div>
</div>
<p>NOTE: if you wish the AD users to be resolved first you can just reverse
the order of operations.</p>
<ul class="simple">
<li><p>now set the <code class="docutils literal notranslate"><span class="pre">domain-resolution-order</span></code> attribute value:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa config-mod --domain-resolution-order=$(cat domain_list.txt | tr &#39;\n &#39;:&#39;)
  Maximum username length: 32
  Home directory base: /home
  ...
  Domain Resolution Order: ipa.test:ad.forest.test:child1.ad.forest.test:child2.ad.forest.test
  ...
</pre></div>
</div>
</section>
<section id="example-2-creating-local-override-of-global-resolution-order">
<span id="id7"></span><h2>Example 2: creating local override of global resolution order<a class="headerlink" href="#example-2-creating-local-override-of-global-resolution-order" title="Permalink to this heading">¶</a></h2>
<p>Let’s say that we have a machine named ‘special.ipa.test’ and we wish
that just users coming from the child domains of trusted forest
(‘child1.ad.forest.test’, ‘child2.ad.forest.test’). Since we observe
much more logins from the latter than from the former, we wish to have
this one tried out first when resolving short names.</p>
<ul class="simple">
<li><p>first we create an ID view which will hold the modified resolution
order:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa idview-add special_host_view --desc &#39;ID view for custom shortname resolution on special hosts&#39; --domain-resolution-order &#39;child2.ad.forest:test:child1.ad.forest&#39;
---------------------------------
Added ID View &quot;special_host_view&quot;
---------------------------------
  ID View Name: special_host_view
  Description: ID view for custom shortname resolution on special hosts
  Domain Resolution Order: child2.ad.forest:test:child1.ad.forest
</pre></div>
</div>
<ul class="simple">
<li><p>then we apply the view on the host</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa idview-apply special_host_view --hosts special.ipa.test
-----------------------------------
Applied ID View &quot;special_host_view&quot;
-----------------------------------
  hosts: special.ipa.test
---------------------------------------------
Number of hosts the ID View was applied to: 1
---------------------------------------------
</pre></div>
</div>
</section>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>Test scenarios that will be transformed to test cases for FreeIPA
<a class="reference external" href="V3/Integration_testing">Continuous Integration</a> during
implementation or review phase. This can be also link to <a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/">source in
cgit</a> with the test,
if appropriate.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/AD_User_Short_Names.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>