<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The CAPTCHA &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="DNSSEC.html" />
    <link rel="prev" title="Overview" href="Community_Portal.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="the-captcha">
<span id="id1"></span><h1>The CAPTCHA<a class="headerlink" href="#the-captcha" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Several forms on the Community Portal site have the potential for abuse.
A warped-characters captcha forms the first line of defense against
automated spam. While probably not sufficient to ward off a determined
and sophisticated adversary, the captcha will deter untargeted, drive-by
spam and casual targetted attacks.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h2>
<p>A captcha is present on each form with the potential for abuse, namely
the self-service user registration form and the password reset
initiation form. The password reset completion form is probably not
susceptible to abuse and does not need a captcha.</p>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h2>
<p>1.) The user requests a form protected with a captcha.</p>
<p>2.) A random string of 4 characters is generated. The string is fed to
the python captcha library, which returns a BytesIO object representing
the captcha image, which is then turned straightaway into a bytes
object. The string is also mixed with a secret key to form an HMAC
string. The HMAC and a timestamp are stored in a database.</p>
<p>3.) The image, as a data-uri, and the HMAC string, as a hexidecimal text
string, are sent to the client as part of the web form being protected.
The HMAC is placed into a hidden form field to be submitted with the
form. The user solves the captcha and enters the solution into a field
in the protected form. The form is submitted by the user.</p>
<p>4.) Before any processing is done on form data, the captcha is verified
by mixing the user’s solution with the secret key from step 2 and
compared securely to the HMAC. If the two match, a correct solution has
been found. The HMAC is then looked up in the database and, if found, is
deleted, regardless of a correct solution or not, to prevent multiple
attempts at the same captcha.</p>
<p>5.) If the solution does not match the HMAC or the HMAC is not found in
the database, the user is returned to the form and informed that their
captcha solution is incorrect. If the captcha is correct, processing of
form data begins and the rest of the form’s workflow is carried out.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h2>
<p>The captcha system depends on a python library called captcha, which
does not current appear to be available in the Fedora package repos, but
is available through pip.</p>
<p>Old captcha data will be periodically expired and deleted from the
database with a script run regularly by cron.</p>
</section>
<section id="feature-management">
<span id="feature-management23"></span><h2>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h2>
<p>The secret key for the HMAC is currently hard-coded into the program,
but will be read from a configuration file in the future.</p>
</section>
<section id="how-to-test">
<span id="how-to-test23"></span><h2>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">¶</a></h2>
<p>Automated unit tests will be written.</p>
<p><a class="reference external" href="Category:FreeIPA_Community_Portal">Category:FreeIPA Community
Portal</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Community_Portal_Captcha.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>