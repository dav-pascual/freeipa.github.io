<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="RFC_2818_certificate_compliance.html" />
    <link rel="prev" title="Overview" href="Promotion_to_CRL_generation_master.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>During FreeIPA development, existing test cases are often broken by
seemingly unrelated changes in the code. Manual testing of all use cases
isn’t feasible. Running the integration test suite manually is not
simple and very time consuming, and thus often skipped. This causes
frequent regressions and malfunctioning code in the master branch.</p>
<p>A proposed solution is to implement on pull-request (PR) continuous
integration (CI) that will run a large portion of the existing test
suite. Currently, we are running single host test on every pull request.
The goal of this effort is to extend our on-PR CI to also execute
multi-host tests. Running the extended test suite should help us to
discover broken test cases early on and stabilize our master branch.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>As a FreeIPA contributor,</p>
<ul>
<li><p>I open a pull request on GitHub against the project. FreeIPA core
developer verifies no malicious code will be executed during the
test runs and approves it for testing and PR is automatically
queued for test execution.</p></li>
<li><p>I update the pull-request. The changes have to be approved by a
core developer once again before the code is queued for test
execution.</p></li>
</ul>
</li>
<li><p>As a white-listed FreeIPA contributor,</p>
<ul>
<li><p>I open a pull request on GitHub against the project. This PR is
automatically queued for test execution.</p></li>
<li><p>I update the pull request’s code. This PR is automatically queued
for test execution.</p></li>
</ul>
</li>
</ul>
<p>Once the test execution finishes, I can see the test results directly in
the PR along with links to publicly accessible logs I can inspect to
debug failures.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>The main goal of this feature is to enable execution of multi-host tests
on GitHub PRs. The following has to be addressed in this design:</p>
<ul class="simple">
<li><p>Multi-host environment provisioning</p></li>
<li><p>GitHub integration</p></li>
<li><p>Task execution</p></li>
<li><p>Publishing test results and artifcats</p></li>
<li><p>Deployment of test runners</p></li>
</ul>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Test results and logs are easily accessible to developers and
community</p>
<ul>
<li><p>It is crucial to be able to track down which test case has failed
and why</p></li>
<li><p>The results must be publicly accessible</p></li>
</ul>
</li>
<li><p>All test results are available under 1.5 hours</p>
<ul>
<li><p>Rapid feedback is a priority, even if that results in a smaller
test-suite</p></li>
<li><p>Up to 3 PRs can be tested simultaneously. Additional PRs may
increase the time.</p></li>
</ul>
</li>
</ul>
</section>
<section id="overview-1">
<span id="id1"></span><h2>Overview<a class="headerlink" href="#overview-1" title="Permalink to this heading">¶</a></h2>
<p>Collection of machines called <em>test runners</em> are monitoring GitHub PRs.
Test runners can be running anywhere, they just need to have credentials
for GitHub, access to the internet and must support virtualization. If
the test runner itself is a virtual machine, it has to support nested
virtualization.</p>
<p>A prioritized queue of tasks is constructed from the PRs. These tasks
are builds and individual test suites that are executed atomically. Test
runner picks up a task with the highest priority and starts executing
it. This is announced through <a class="reference external" href="https://developer.github.com/v3/repos/statuses/">GitHub commit
status</a> update to
avoid collisions with other test runners.</p>
<p>Once the task is finished, a publicly accessible URL with links to the
artifacts (rpms, logs) is announced along with the task result in a
commit status.</p>
</section>
<section id="multi-host-environment-provisioning">
<span id="id2"></span><h2>Multi-host environment provisioning<a class="headerlink" href="#multi-host-environment-provisioning" title="Permalink to this heading">¶</a></h2>
<p>Hosts are provisioned as virtual machines (VM). To speed up the
provisioning and to alleviate issues with broken dependencies, VM
templates will be created and kept up-to-date. libvirt was chosen as the
provider and the templates themselves will be vargant boxes. The boxes
are published and accessible on <a class="reference external" href="https://atlas.hashicorp.com/freeipa">HashiCorp
Atlas</a>.</p>
</section>
<section id="github-integration">
<span id="id3"></span><h2>GitHub integration<a class="headerlink" href="#github-integration" title="Permalink to this heading">¶</a></h2>
<p>Test runners communicate through with GitHub through its API. Each pull
request has a collection of <a class="reference external" href="https://developer.github.com/v3/repos/statuses/">GitHub commit
statuses</a> associated
with it. These are used for all communication. This was inspired by the
<a class="reference external" href="https://github.com/cockpit-project/cockpit/tree/master/test">Cockpit
project</a>.</p>
</section>
<section id="task-execution">
<span id="id4"></span><h2>Task execution<a class="headerlink" href="#task-execution" title="Permalink to this heading">¶</a></h2>
<p>For each PR, a build and a series of test suites have to be executed.
The test runners use a common algorithm to determine the priority of all
waiting tasks for all pull requests. Idle test runner picks the
top-priority task, starts executing it, and marks it in progress.</p>
</section>
<section id="publishing-test-results-and-artifacts">
<span id="id5"></span><h2>Publishing test results and artifacts<a class="headerlink" href="#publishing-test-results-and-artifacts" title="Permalink to this heading">¶</a></h2>
<p>Once the task finishes, the artifacts (rpms, logs) are uploaded and a
URL is created. Currently, the artifacts are uploaded and stored on
<a class="reference external" href="https://fedorapeople.org/groups/freeipa/">fedorapeople.org</a>,
although any publicly accessible storage can be used.</p>
<p>The produced URL and the test result is announced by the test runner in
the GitHub commit status.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>For implementation details, see the <a class="reference external" href="https://github.com/freeipa/freeipa-pr-ci/blob/master/doc/README.md">Developer
Documentation</a>.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Pull-Request_CI.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>