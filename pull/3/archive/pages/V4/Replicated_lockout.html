<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Self Service Password Reset" href="Self_Service_Password_Reset.html" />
    <link rel="prev" title="IPA server configuration" href="Replica_Setup.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Accounts are locked or unlocked based on passwordpolicy, but the data
used to determine if an account has to be locked or unlocked are only
local (explicitely excluded from replication). So it is possible to
retry on an other server once an accout is locked. The purpose of this
design is to make the lockout global without introducing heavy
replication traffic.</p>
<p>NOTE: If only the final lockout state is replicated there still is the
opportunity to try passwords in a round robin method on all servers
before on on server the final lockout state is reached</p>
<p>NOTE: A side effect of this feature is that the lockout state can be
tracked on any server and a locked account can be unlocked on any server
(ticket 3863/2792)</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>If the login failed count is exceeded on one server it will be
impossible to login on an other server until the account is unlocked by
an admin or if the lockout duration is passed If an account is locked,
it can be unlocked on any server (solves ticket
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3863">#3863</a>)</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>To achieve a global lockout without replicating the basic lockout
attributes: krbLastFailedAuth, krbLoginFailedCount an new attribut has
to be defined: krbGlobalLockoutState with the states “locked” and
“unlocked”. This is set whenever an account gets locked or unlocked and
is repplicated to all other servers. The decision if a login attempt is
accepted checks the presence this new attribute first before continuing
with the local checks.</p>
<p>There are two other attributes required to make the lockout policy
consistent.</p>
<p>If a lockout is not permanent but has a finite duration based on the
last failed login which triggered the lockout, the time of the lockout
start now als has to be available on all servers. Since we do not want
to replicate krbLastFailedAuth whenever it is set, there has to be a new
attribute which is set and replicated together with
krbGlobalLockoutState: krbGlobalLockoutStartTime. This is one operation
and no extra replication traffic introduced.</p>
<p>The other required attribute is related to unlocking. The replication of
krbGlobalLockoutState and krbGlobalLockoutStartTime only sets these
attributes, but does not change the other attributes in the entry, eg
krbLoginFailedCount. To achieve this the lockout plugin would have to
intercept each modify operation and check if it is a change of the
lockout attributes and act upon them. This is unnecessary overhead, the
logic can be applied in the ipalockout plugin only, but has to take
special care for the unlock scenario. If the plugin detects that the
global state is “unlocked” it has to reset the local
krbLoginFailedCount, but it has to be done only once, this can be
controled by a attribute which tracks local lockout state changes:
krbLocalLockoutState. If the global state is unlocked and the local
state is locked, the failed count is reset and the local state is set to
unlocked.</p>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>The schema (60kerberos.ldif) needs to be extended to contain the new
attributes: krbGlobalLockoutState, krbLocalLockoutState,
krbGlobalLockoutStartTime</p>
<p>The logic in the pre and postp ipa-lockout plugin needs to be changed to
use and set global lockout state:
daemons/ipa-slapi-plugins/ipa-lockout/ipa_lockout.c</p>
<p>This applys also to the code in the ipa kdb driver:
./daemons/ipa-kdb/ipa_kdb_audit_as.c</p>
<p>The command line utilities : user-status, user-unlock also need to be
enhanced ./ipalib/plugins/user.py</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>How the feature will be managed via the UI will be handled in ticket
2792</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>The feature affects the following commands: ipa user-unlock ipa
user-status</p>
<p>user-unlock can now be used to unlock a user on any replica</p>
</section>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>The feature is relying on replication to have a global account lockout
policy. The new attributes krbGlobalLockoutState and
krbGlobalLockoutStartTime need to be replicated, the attribute
krbLocalLockoutState has to be excluded from replication</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>Any impact on updates and upgrades?</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="backup-and-restore">
<h1>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this heading">¶</a></h1>
<p>N/A</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>Test scenarios that will be transformed to test cases. TBD</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Replicated_lockout.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>