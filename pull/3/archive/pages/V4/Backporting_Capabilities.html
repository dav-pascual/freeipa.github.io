<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Build_system_refactoring.html" />
    <link rel="prev" title="Overview" href="Automember_rebuild_membership.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>This document specifies how backwards-incompatible changes may be
backported to maintenance branches of FreeIPA.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>The use case is fixing issues like <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1117300">RH bug
1117300</a>, in
which the fix to <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2886">ticket
2886</a> could not be
backported to IPA 3.0. Unfortunately, it is too late to backport this
particular fix.</p>
<p>The process described here, and related the changes in IPA, will make
such backports possible in the future.</p>
<p>== Design= =</p>
<p>IPA handles backwards-incompatible API changes by “capabilities”, which
mark that a feature was introduced in a certain API version. This was
implemented for <a class="reference external" href="V3/Messages">V3/Messages</a>.</p>
<p>when a client implements a capability, it unconitionally uses some new
API semantics in the request to the server. Servers use the client’s API
version to determine whether to use new or old semantics. A client that
implements a capability cannot successfully connect to a server that
does not implement the capability.</p>
<p>The above rules work with FreeIPA’s current API versioning scheme. This
design defines a way to enable backporting backwards-incompatible
features to maintenance branches, while respecting these rules.</p>
<section id="freeipa-master-branch">
<span id="id1"></span><h2>FreeIPA master branch<a class="headerlink" href="#freeipa-master-branch" title="Permalink to this heading">¶</a></h2>
<p>The master branch uses a two-element API versioning scheme, 2.x, where
‘x’ is a number that increases with each API change.</p>
<p>API versions are compared using <a class="reference external" href="http://epydoc.sourceforge.net/stdlib/distutils.version.LooseVersion-class.html">LooseVersion
rules</a>
of Python distutils.</p>
<p>Backwards-incompatible changes are recorded as *capabilities*.</p>
<p>For example, the capability ‘optional_uid_params’ was added in API
version ‘2.54’. Every client of version ‘2.54’ or greater uses the new
API. Every server of version ‘2.54’ or greater uses the client’s API
version, which is sent in each RPC call, to determine the API to use.</p>
<p>Clients of version ‘2.54’ or greater cannot connect to servers older
than ‘2.54’.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p>Client &lt; ‘2.54’</p></td>
<td><p>Client &gt;= ‘2.54</p></td>
</tr>
<tr class="row-even"><td><p>Server &lt; ‘2.54’</p></td>
<td><p>Old API*</p></td>
<td><p>Cannot connect</p></td>
</tr>
<tr class="row-odd"><td><p>Server &gt;= ‘2.54’</p></td>
<td><p>Old API</p></td>
<td><p>New API*</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>A client may not connect to a server of lower version.</p></li>
</ul>
</section>
<section id="maintenance-api-branches">
<span id="id2"></span><h2>Maintenance API branches<a class="headerlink" href="#maintenance-api-branches" title="Permalink to this heading">¶</a></h2>
<p>Currently, the API of a maintenance branch must remain fully backwards
compatible with the version it was branched from. (Alternatively it may
implement the exact same API changes as the master branch, in the same
sequence, and update the API version accordingly.)</p>
<p>This design allows a single capability at a time to be backported. When
this hapens, a ‘+’ and the name of the capability is appended to the API
version. Once branched this way, versioning of the branch is strictly
linear: additional capabilities may only be appended.</p>
<p>Only versions that already implement the ‘extra_capabilities’ capability
may be forked in this way. ‘extra_capabilities’ will be added when
support for the mechanism described here is added to FreeIPA.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h3>
<p>Let’s say the master branch is at API version ‘2.500’, and a maintenance
branch at ‘2.200’. The maintenance branch needs to backport the
capability ‘b’ which was added in version ‘2.400’. After implementing
the capability, the API version of the maintenance branch becomes
‘2.200+b’.</p>
<p>After a while the capability ‘a’, introduced in master with API version
‘2.300’, needs to be backported. When this is done, the API version
becomes ‘2.200+b+a’.</p>
<p>All further versions of the ‘2.200’ branch must start with ‘2.200+b+a’;
the version ‘2.200+a’ may never appear. .</p>
<p>A summary:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td></td>
<td><p>sema
ntics
under
stood
by
s
erver
↓</p></td>
<td></td>
<td><p>C
lient
&lt;=
‘2
.200’</p></td>
<td><p>C
lient
=
‘2.2
00+b’</p></td>
<td><p>C
lient
&gt;=
‘2
.200+
b+a’,
&lt;
‘2
.201’</p></td>
<td><p>C
lient
&gt;=
‘2.
201’,
&lt;
2.300</p></td>
<td><p>C
lient
&gt;=
‘2.
300’,
&lt;
2.400</p></td>
<td><p>C
lient
&gt;=
2.400</p></td>
</tr>
<tr class="row-even"><td><p>re
quest
sema
ntics
→</p></td>
<td></td>
<td></td>
<td><p>old</p></td>
<td><p>‘b’</p></td>
<td><p>‘a’,
‘b’</p></td>
<td><p>old</p></td>
<td><p>‘a’</p></td>
<td><p>‘a’,
‘b’</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>S
erver
&lt;=
‘2
.200’</p></td>
<td><p>old</p></td>
<td></td>
<td><p>Old
API*</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
</tr>
<tr class="row-odd"><td><p>S
erver
=
‘2.2
00+b’</p></td>
<td><p>‘b’</p></td>
<td></td>
<td><p>Old
API</p></td>
<td><p>‘b’
*</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
</tr>
<tr class="row-even"><td><p>S
erver
&gt;=
‘2
.200+
b+a’,
&lt;
‘2
.201’</p></td>
<td><p>‘a’,
‘b’</p></td>
<td></td>
<td><p>Old
API</p></td>
<td><p>‘b’</p></td>
<td><p>‘a’,
‘b’
*</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
</tr>
<tr class="row-odd"><td><p>S
erver
&gt;=
‘2.
201’,
&lt;
2.300</p></td>
<td><p>old</p></td>
<td></td>
<td><p>Old
API</p></td>
<td><p>C
annot
co
nnect
†</p></td>
<td><p>C
annot
co
nnect
†</p></td>
<td><p>Old
API
*</p></td>
<td><p>C
annot
co
nnect</p></td>
<td><p>C
annot
co
nnect</p></td>
</tr>
<tr class="row-even"><td><p>S
erver
&gt;=
‘2.
400’,
&lt;
2.400</p></td>
<td><p>‘a’</p></td>
<td></td>
<td><p>Old
API</p></td>
<td><p>C
annot
co
nnect
†</p></td>
<td><p>C
annot
co
nnect
†</p></td>
<td><p>Old
API</p></td>
<td><p>‘a’
*</p></td>
<td><p>C
annot
co
nnect</p></td>
</tr>
<tr class="row-odd"><td><p>S
erver
&gt;=
2.400</p></td>
<td><p>‘a’,
‘b’</p></td>
<td></td>
<td><p>Old
API</p></td>
<td><p>‘b’</p></td>
<td><p>‘a’,
‘b’</p></td>
<td><p>Old
API</p></td>
<td><p>‘a’</p></td>
<td><p>‘a’,
‘b’
*</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>A client may still not connect to a server of lower version.</p></li>
</ul>
<p>A version is lower than the same version with extra capability suffix
attached (e.g. ‘2.10+xy’ &lt; ‘2.10+xy+zzy’).</p>
<p>† See the “Optional suffix” section</p>
</section>
<section id="optional-suffix">
<span id="id3"></span><h3>Optional suffix<a class="headerlink" href="#optional-suffix" title="Permalink to this heading">¶</a></h3>
<p>To provide greater compatibility, the client may omit a suffix from the
API version it sends, if the semantics with and without that capability
are equivalent for that particular request. Only</p>
<p>For example, <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1117300">bug
1117300</a> only
affects a few commands, and only when the numeric user or group ID
option is set to a particular value. If a fix backported to version
‘2.30’, the client could send API version ‘2.30+optional_uid_params’
only in the case above, and otherwise keep sending ‘2.30’.</p>
<p>However, if the client version was
‘2.30+optional_uid_params+major_overhaul’, and the ‘major_overhaul’
capability changes the semantics of the call, ‘optional_uid_params’ may
not be dropped.</p>
<p>The exact mechanics are not specified here or in the implementation that
will accompany this design, since they depend on the particular feature
being backported.</p>
</section>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading">¶</a></h2>
<p>This scheme only allows “official” branches, over which the core FreeIPA
team has full control. Third-party extensions are encouraged to adopt a
private versioning scheme, and use it in parallel to the IPA core API
version.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>No additional requirements or changes were discovered during the
implementation phase.</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<p>No user-visible features to manage</p>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>No configuration options, no way to disable the feature.</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>No impact on replication.</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>No impact on updates and upgrades.</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>No new package and library dependencies.</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>No impact on other development teams and components.</p>
</section>
<section id="backup-and-restore">
<h1>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this heading">¶</a></h1>
<p>No impact on B&amp;R.</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>Will be tested by FreeIPA’s testsuite, until a concrete use case arises.
The test will check all cases in the table in the “Example” section.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V4/Backporting_Capabilities.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>