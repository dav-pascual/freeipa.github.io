<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DNS Setup" href="Setup_FreeIPA_Services_for_Mac_OS_X_10.12.html" />
    <link rel="prev" title="Details" href="Migrate_your_code_to_the_new_LDAP_API.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>In IPA 4.3 the replication topology is controlled by the topology
plugin. Connections between replicas can only be created or removed by
the</p>
<p>ipa topologysegment-[add|del]</p>
<p>commands.</p>
<p>When a replica is removed by running</p>
<p>ipa-replica-manage del</p>
<p>the removal of replication segments and corresponding replication
agreements is automatically handled by the topology plugin.</p>
<p>But to be able to propagate these changes throughout the topology all
the remaining servers need to be connected. You should be careful in the
setup of a replication topology and in the actions to remove a replica.
the following sections will make recommendations for designig a
replication topology and how to procede when a replica has to be removed</p>
</section>
<section id="designing-a-replication-topology">
<span id="id1"></span><h1>Designing a replication topology<a class="headerlink" href="#designing-a-replication-topology" title="Permalink to this heading">¶</a></h1>
<p>The replication topology deployed should follow these rules:</p>
<p>Avoid single points of failure, the unavailability of one server or one
connection between servers should not disconnect the remaining servers.</p>
<p>Avoid high replication traffic in one node.</p>
<p>This will be further explained for the following replication topology
types:</p>
<figure class="align-default" id="id5">
<img alt="Topo-types.png" src="../../../_images/Topo-types.png" />
<figcaption>
<p><span class="caption-text">Topo-types.png</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In Type 1 the replicas are connected in a string, any failing server
will disconnect the others.</p>
<p>In Type 2 the replicas are connected in a star like pattern, if replica
F is down all other replicas are disconnected, also replica F has to
manage all replicaion distribution from other servers, replica A,B ,C,D,
E will compete to update replica F, only one supplier can update a
replica at one time</p>
<p>In type 3 there is a good balance, all replicas are connected to others
vial different paths, also no replica has more than three replication
connections to handle</p>
</section>
<section id="safely-removing-a-replica">
<span id="id2"></span><h1>Safely removing a replica<a class="headerlink" href="#safely-removing-a-replica" title="Permalink to this heading">¶</a></h1>
<section id="removing-a-leaf-replica">
<span id="id3"></span><h2>Removing a “leaf” replica<a class="headerlink" href="#removing-a-leaf-replica" title="Permalink to this heading">¶</a></h2>
<p>Assuming the following replication topology:</p>
<p><code class="docutils literal notranslate"><span class="pre">A &lt;--&gt; B &lt;--&gt; C &lt;--&gt; D</span></code></p>
<p>then the replicas at the endpoints of the replication chain, A or D, can
safely be removed by:</p>
<p><code class="docutils literal notranslate"><span class="pre">ipa-replica-manage del A</span></code></p>
<p>The command removes the master entry for A and this will trigger that
the topoloy plugin removes the segment connecting A and B an will remove
the replication agreements A–&gt;B and B–&gt;A</p>
</section>
<section id="removing-an-internal-replica">
<span id="id4"></span><h2>Removing an “internal” replica<a class="headerlink" href="#removing-an-internal-replica" title="Permalink to this heading">¶</a></h2>
<p>Assume that in the above topology the internal node C should be removed.</p>
<p>If the command</p>
<p>ipa-replica-manage del C</p>
<p>is executed, the command will detect that the removal of C disconnects
the topology and rejects the command.</p>
<p>It will also list the replicas which will be no longer connected to each
other, use this information to add missing segments before finally
deleting the replica</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">checking connectivity in topology suffix 'ipaca'</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">WARNING: Removal of 'vm-110.abc.idm.lab.eng.brq.redhat.com' will lead to disconnected topology in suffix 'ipaca'</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Changes will not be replicated to all servers and data will become inconsistent.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">You need to add segments to prevent disconnection of the topology.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Errors in topology after removal:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Topology does not allow server vm-072.abc.idm.lab.eng.brq.redhat.com to replicate with servers:</span></code></div>
<div class="line">``   vm-192.abc.idm.lab.eng.brq.redhat.com``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Topology does not allow server vm-192.abc.idm.lab.eng.brq.redhat.com to replicate with servers:</span></code></div>
<div class="line">``   vm-072.abc.idm.lab.eng.brq.redhat.com``</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">NOTE: the removal of an internal node can be enforced by adding --force to the command, but it should never be done</span></code></p>
<p>There are two cases</p>
<ol class="loweralpha simple">
<li><p>node C is working and properly handling replication traffic</p></li>
</ol>
<p>Even if the node C is still operable and replicating its removal should
not be enforced. The removal of C will trigger the removal of the
connections to B and D, there can be race conditions where not all
information on topology change is replicated to D before the agreement
to D is removed.</p>
<p>And node D will be isolated after removal of C, so new segments will
have to be added. Therefore the adding of the new segment should be done
before the removal.</p>
<ol class="loweralpha simple" start="2">
<li><p>node C is inoperable and the topology is already broken.</p></li>
</ol>
<p>In this scenario there is no chance that the removal of C will be
propagated to D (if the removal is triggered on A or B) or to A,B (if
the removal is triggered from D). But the removal information is kept in
the changelog and will be sent after the topology is connected again by
adding new segments. Depending what other toplogy changes have been done
in between there could be race conditions where the late replication of
the removal could give unexpeted results.</p>
<p>As a conclusion, in both cases the topology should be extended first to
keep the topology connected, by running</p>
<p><code class="docutils literal notranslate"><span class="pre">ipa topologysegment-add --leftnode=A --rightnode=D</span></code></p>
<p>This ensures that the toplogy is fully connected again and keeps
connected after C is removed</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/HowTo/Remove_replica_in_a_managed_topology.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>