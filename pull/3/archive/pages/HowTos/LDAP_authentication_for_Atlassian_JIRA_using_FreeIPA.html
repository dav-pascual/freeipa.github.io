<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="Setting_up_Rhodecode_to_authenticate_users_against_FreeIPA.html" />
    <link rel="prev" title="DNS Setup" href="../HowTo/Setup_FreeIPA_Services_for_MacOS_X_10.12/10.13.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Draft / Work in Progress on formatting</p>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>This page describes how to integrate JIRA to a FreeIPA LDAP server. Very
likely the same approach can be taken to integrate other Atlassian
products such as Confluence to FreeIPA.</p>
<p>JIRA offers a number of different ways to integrate to LDAP.
Unfortunately FreeIPA integration is not natively supported, but once
you know how, it is not that difficult. There are probably other
solutions that work as well, but this is the one that worked for us.</p>
<p>At the time of integration we were running FreeIPA Server 4.1.0 and JIRA
6.4.7</p>
<p>See:</p>
<p><a class="reference external" href="https://confluence.atlassian.com/display/JIRA/Connecting+to+an+LDAP+Directory">https://confluence.atlassian.com/display/JIRA/Connecting+to+an+LDAP+Directory</a>
<a class="reference external" href="https://confluence.atlassian.com/display/DEV/How+to+write+LDAP+search+filters">https://confluence.atlassian.com/display/DEV/How+to+write+LDAP+search+filters</a></p>
</section>
<section id="integration-path">
<span id="id1"></span><h1>Integration Path<a class="headerlink" href="#integration-path" title="Permalink to this heading">¶</a></h1>
<p>JIRA can be integrated to an LDAP by a number of different paths
including full bi-directional sync.</p>
<p>We chose <strong>Internal Directory with LDAP Authentication</strong>, which means
that FreeIPA users and groups are copied to the JIRA internal directory
when a FreeIPA user logs in to JIRA. i.e.</p>
<ul class="simple">
<li><p>FreeIPA is used for authentication</p></li>
<li><p>FreeIPA users, and optionally groups + group membership are
replicated one-way to JIRA on user login.</p></li>
</ul>
<p>In particular this means that only a subset of the FreeIPA users will be
replicated to JIRA - only those that actually log in to JIRA.</p>
<p>See
<a class="reference external" href="https://confluence.atlassian.com/display/JIRA/Connecting+to+an+Internal+Directory+with+LDAP+Authentication">https://confluence.atlassian.com/display/JIRA/Connecting+to+an+Internal+Directory+with+LDAP+Authentication</a></p>
<p>Much of the config described below could probably be used for the other
integration paths.</p>
</section>
<section id="toolset">
<h1>Toolset<a class="headerlink" href="#toolset" title="Permalink to this heading">¶</a></h1>
<p>We used the following tools to gain insight into the structure of the
FreeIPA LDAP directory, and to understand and simulate the queries that
JIRA (might) be making against FreeIPA</p>
<ul class="simple">
<li><p><strong>Apache Directory Studio:</strong> This or any similar visual LDAP browser
is invaluable to getting into the guts of an LDAP, seeing what is
where, which attributes are available (and even making changes in
extremis). See <a class="reference external" href="https://directory.apache.org/studio/">https://directory.apache.org/studio/</a></p></li>
<li><p><strong>ldapsearch:</strong> This command line tool is your friend! Use it to
simulate queries that JIRA might be making, fine tune filters, and
see what FreeIPA returns. This approach helped us to see that we were
initially getting results from both the compat and accounts trees -
which confused JIRA, and then how to prevent this.</p></li>
<li><p><strong>FreeIPA and JIRA logs:</strong> What queries is JIRA actually making?
Although you can guesstimate based on your config, it is great to see
the actual queries.</p>
<ul>
<li><p>FreeIPA Server: <code class="docutils literal notranslate"><span class="pre">/var/log/dirsrv/slapd-*/access</span></code></p></li>
<li><p>JIRA: See
<a class="reference external" href="https://confluence.atlassian.com/display/JIRA/Logging+and+Profiling">https://confluence.atlassian.com/display/JIRA/Logging+and+Profiling</a>
We added the package
com.atlassian.crowd.directory.SpringLDAPConnector, and got partial
results.</p></li>
</ul>
</li>
</ul>
</section>
<section id="key-challenges">
<span id="id2"></span><h1>Key Challenges<a class="headerlink" href="#key-challenges" title="Permalink to this heading">¶</a></h1>
<section id="ldap-adapter-type">
<span id="id3"></span><h2>LDAP Adapter Type<a class="headerlink" href="#ldap-adapter-type" title="Permalink to this heading">¶</a></h2>
<p>While JIRA offers a wide range of LDAP Adapters, it does not (yet) offer
a FreeIPA Adapter out of the box. We chose the Generic LDAP adapter, and
were able to configure this for FreeIPA.</p>
<section id="other-candidate-adapters">
<span id="id4"></span><h3>Other Candidate Adapters<a class="headerlink" href="#other-candidate-adapters" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>FedoraDS:</strong> We did NOT use the FedoraDS adapter (even though
FedoraDS is an ancestor of FreeIPA), as this uses the compat tree due
to the <code class="docutils literal notranslate"><span class="pre">(objectclass=posixAccount)</span></code> filter. However other freeIPA
users have reported success with this adapter:
<a class="reference external" href="https://www.redhat.com/archives/freeipa-users/2015-June/msg00200.html">https://www.redhat.com/archives/freeipa-users/2015-June/msg00200.html</a></p></li>
<li><p><strong>Other Adapters:</strong> It is possible that other adapters can also be
persuaded to work, with more or less additional configuration.</p></li>
</ul>
</section>
</section>
<section id="rfc-schemas-freeipa-trees">
<span id="id5"></span><h2>RFC Schemas + FreeIPA Trees<a class="headerlink" href="#rfc-schemas-freeipa-trees" title="Permalink to this heading">¶</a></h2>
<p>There are several different LDAP RFC Schemas. FreeIPA uses the RFC
2307bis schema (with users stored under <code class="docutils literal notranslate"><span class="pre">cn=accounts,</span> <span class="pre">cn=users</span></code>), but
also offers publishes an alternative “compat” tree
<code class="docutils literal notranslate"><span class="pre">cn=users,cn=compat,dc=example,dc=com</span></code> with users in a RFC 2307
schema.</p>
<p>The chosen adapter, and the configuration applied to it, plays an
important role here in determining which of the trees returns data. Here
using <code class="docutils literal notranslate"><span class="pre">ldapsearch</span></code> was invaluable. For example it proved that in one
of our first attempt we were getting returns from both trees, and that
JIRA was using only the first return.</p>
<p>Making the query with the correct filter gave us data from the desired
tree <code class="docutils literal notranslate"><span class="pre">(cn=accounts,</span> <span class="pre">cn=users)</span></code>. The ldap.user.filter
<code class="docutils literal notranslate"><span class="pre">(objectclass=inetorgperson)</span></code> ensures that replies DO NOT come from
the compat tree (which among other things does not have the mail
attribute).</p>
<p>See <a class="reference external" href="https://www.freeipa.org/page/Directory_Server">https://www.freeipa.org/page/Directory_Server</a> and
<a class="reference external" href="https://www.redhat.com/archives/freeipa-users/2015-June/msg00547.html">https://www.redhat.com/archives/freeipa-users/2015-June/msg00547.html</a></p>
</section>
<section id="e-mail-attribute-and-bind-type">
<span id="id6"></span><h2>E-Mail Attribute and Bind Type<a class="headerlink" href="#e-mail-attribute-and-bind-type" title="Permalink to this heading">¶</a></h2>
<p>We managed to get users synced from FreeIPA, and able to authenticate
and thus log in to JIRA fairly easily. However the email field was
empty, which means that JIRA mail notification didn’t work, rendering
JIRA about as useful as a chocolate teapot. While the email field could
be updated in the JIRA user management, it always emptied every time the
user logged back on.</p>
<p>Once again <code class="docutils literal notranslate"><span class="pre">ldapsearch</span></code> proved what was going on: We had configured
the LDAP Adapter without a user: i.e. anonymous bind. Performing the
same query via simple bind: i.e. with an LDAP user, returned additional
attributes, including the all important mail attribute. We therefore
reconfigured the LDAP Adapter to use a FreeIPA user and password, and
bingo! JIRA received the mail attribute!</p>
<p>As the password of the bind user is stored in plaintext in the jira
database, make sure the user configured is a limited user (member of the
default ipa-users group is sufficient). e.g. don’t use the Directory
Manager user!</p>
</section>
<section id="replicating-users-and-groups">
<span id="id7"></span><h2>Replicating Users and Groups<a class="headerlink" href="#replicating-users-and-groups" title="Permalink to this heading">¶</a></h2>
<section id="users">
<h3>Users<a class="headerlink" href="#users" title="Permalink to this heading">¶</a></h3>
<p>It is possible to replicate only the users to JIRA, with groups managed
locally (you can configure default groups to which user are added
automatically). We did this as a first step.To get this to work change:</p>
<ul class="simple">
<li><p><strong>User Schema Settings / Additional User DN</strong> to <code class="docutils literal notranslate"><span class="pre">cn=accounts</span></code></p></li>
<li><p><strong>User Schema Settings / User Unique ID Attribute</strong> from
<code class="docutils literal notranslate"><span class="pre">entryUUID</span></code> to <code class="docutils literal notranslate"><span class="pre">uid</span></code></p></li>
</ul>
</section>
<section id="groups">
<h3>Groups<a class="headerlink" href="#groups" title="Permalink to this heading">¶</a></h3>
<p>Additionally groups, and group memberships can be replicated to JIRA. To
get this to work change:</p>
<ul class="simple">
<li><p><strong>Group Schema Settings / Additional Group DN</strong> to <code class="docutils literal notranslate"><span class="pre">cn=accounts</span></code></p></li>
<li><p><strong>Group Schema Settings / Group Object Class</strong> from
<code class="docutils literal notranslate"><span class="pre">groupOfUniqueNames</span></code> to <code class="docutils literal notranslate"><span class="pre">groupOfNames</span></code></p></li>
<li><p><strong>Group Schema Settings / Group Object Filter</strong> from
<code class="docutils literal notranslate"><span class="pre">(objectclass=groupOfUniqueNames)</span></code> to
<code class="docutils literal notranslate"><span class="pre">(objectclass=groupOfNames)</span></code></p></li>
<li><p><strong>Member Schema Settings / Group Members Attribute</strong> from
<code class="docutils literal notranslate"><span class="pre">uniqueMember</span></code> to <code class="docutils literal notranslate"><span class="pre">Member</span></code></p></li>
</ul>
</section>
</section>
</section>
<section id="the-final-configuration">
<span id="id8"></span><h1>The Final Configuration<a class="headerlink" href="#the-final-configuration" title="Permalink to this heading">¶</a></h1>
<p>Below is the config direct from the Jira database (of course we made the
config changes via the Jira admin GUI, which has a nifty Test function).</p>
<p>Note: you will need to change some values to reflect your domain,
hostname etc</p>
<p>mysql&gt; select attribute_name, attribute_value from
cwd_directory_attribute where directory_id = xxxx;</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Attribute Name</strong></p></td>
<td><p><strong>Attribute Value</strong></p></td>
</tr>
<tr class="row-even"><td><p>autoAddGroups</p></td>
<td><p>jira-users</p></td>
</tr>
<tr class="row-odd"><td><p>crowd.dele
gated.directory.auto.create.user</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>crowd.dele
gated.directory.auto.update.user</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-odd"><td><p>crowd.
delegated.directory.importGroups</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>crowd.delegated.directory.type</p></td>
<td><p>com.atlas
sian.crowd.directory.GenericLDAP</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.basedn</p></td>
<td><p>dc=my,dc=silly,dc=example,dc=com</p></td>
</tr>
<tr class="row-even"><td><p>ldap.external.id</p></td>
<td><p>uid</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.group.description</p></td>
<td><p>description</p></td>
</tr>
<tr class="row-even"><td><p>ldap.group.dn</p></td>
<td><p>cn=accounts</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.group.filter</p></td>
<td><p>(objectclass=groupOfNames)</p></td>
</tr>
<tr class="row-even"><td><p>ldap.group.name</p></td>
<td><p>cn</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.group.objectclass</p></td>
<td><p>groupOfNames</p></td>
</tr>
<tr class="row-even"><td><p>ldap.group.usernames</p></td>
<td><p>Member</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.nestedgroups.disabled</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>ldap.pagedresults</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.pagedresults.size</p></td>
<td><p>1000</p></td>
</tr>
<tr class="row-even"><td><p>ldap.password</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ldap.referral</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-even"><td><p>ldap.url</p></td>
<td><p>ldap
:/<em>/</em>.my.silly.example.com:389</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.user.displayname</p></td>
<td><p>displayName</p></td>
</tr>
<tr class="row-even"><td><p>ldap.user.dn</p></td>
<td><p>cn=accounts</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.user.email</p></td>
<td><p>mail</p></td>
</tr>
<tr class="row-even"><td><p>ldap.user.filter</p></td>
<td><p>(objectclass=inetorgperson)</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.user.firstname</p></td>
<td><p>givenName</p></td>
</tr>
<tr class="row-even"><td><p>ldap.user.group</p></td>
<td><p>memberOf</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.user.lastname</p></td>
<td><p>sn</p></td>
</tr>
<tr class="row-even"><td><p>ldap.user.objectclass</p></td>
<td><p>inetorgperson</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.user.username</p></td>
<td><p>uid</p></td>
</tr>
<tr class="row-even"><td><p>ldap.user.username.rdn</p></td>
<td><p>uid</p></td>
</tr>
<tr class="row-odd"><td><p>ldap.userdn</p></td>
<td><p>uid=,cn=users,cn=accounts,
dc=my,dc=silly,dc=example,dc=com</p></td>
</tr>
<tr class="row-even"><td><p>ldap.usermembership.use</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p>ld
ap.usermembership.use.for.groups</p></td>
<td><p>false</p></td>
</tr>
</tbody>
</table>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/HowTos/LDAP_authentication_for_Atlassian_JIRA_using_FreeIPA.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>