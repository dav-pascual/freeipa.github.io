<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NOTICE &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="Playground.html" />
    <link rel="prev" title="Prerequisites" href="Penrose_Installation.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="notice">
<h1>NOTICE<a class="headerlink" href="#notice" title="Permalink to this heading">¶</a></h1>
<p>This is a <strong>draft</strong> - the project is not yet complete - not even sure if
it will <em>work</em>.</p>
</section>
<section id="problem-definition">
<span id="id1"></span><h1>Problem Definition<a class="headerlink" href="#problem-definition" title="Permalink to this heading">¶</a></h1>
<p>Currently, there is no easy way to implement an internal cloud with
OpenShift Enterprise on RHEL/Fedora systems that can seemlessly
integrate with IPA.</p>
</section>
<section id="hope-to-achieve">
<span id="id2"></span><h1>Hope to Achieve<a class="headerlink" href="#hope-to-achieve" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Provide a way for current or potential enterprise RHEL/Fedora + IPA
users to easily implement an internal cloud using OpenShift
technology.</p></li>
<li><p>To make a Puppet module to configure and manage the state of an
OpenShift cloud implentation that integrates with an IPA instance.</p></li>
</ul>
</section>
<section id="deliverables">
<h1>Deliverables<a class="headerlink" href="#deliverables" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Puppet Module</p></li>
<li><p>Proof of Concept with mini-internal cloud</p>
<ul>
<li><p>5 Fedora 18 Machines</p>
<ul>
<li><p>IPA Server</p></li>
<li><p>Puppet Master</p></li>
<li><p>OpenShift Broker/Puppet Agent</p></li>
<li><p>OpenShift Node/Puppet Agent</p></li>
<li><p>User/Developer workstation</p></li>
</ul>
</li>
<li><p>Windows AD Trust with IPA Server</p></li>
<li><p>Demo application running on internal cloud</p></li>
</ul>
</li>
</ul>
</section>
<section id="proposed-implementation">
<span id="id3"></span><h1>Proposed Implementation<a class="headerlink" href="#proposed-implementation" title="Permalink to this heading">¶</a></h1>
<section id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>IPA Server already configured (with or without Windows AD trust)</p></li>
<li><p>Puppet Master &amp; Agents are IPA Clients</p></li>
<li><p>OpenShift Brokers &amp; Nodes are both IPA Clients and Puppet Agents</p></li>
<li><p>IPA manages Puppet Master as host/service</p></li>
<li><p>IPA manages Host SSH keys for both Broker + Node as host_keys</p></li>
<li><p>IPA manages SSH keys for User/Developer as authorized_keys</p></li>
<li><p>Puppet manages IPA Clients (Brokers/Nodes) through IPA delegated host
management</p></li>
<li><p>Puppet Agents are configured to query Master every ${x} minutes for
catalog</p></li>
</ul>
</section>
<section id="initial-setup-of-ipa-and-puppet">
<span id="id4"></span><h2>Initial Setup of IPA and Puppet<a class="headerlink" href="#initial-setup-of-ipa-and-puppet" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Enroll Puppet Master as a host + service in IPA</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">puppetmaster/puppet.${DOMAIN}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">puppet/puppet.${DOMAIN}</span></code></p></li>
</ul>
</li>
<li><p>Enroll Puppet Agent as a service in IPA</p></li>
<li><p>Generate service certificate for puppetmaster</p></li>
<li><p>Generate service certificates for the puppet agents</p></li>
<li><p>Setup the puppetmaster to use Apache with Passenger and mod_nss (<a class="reference external" href="http://jcape.name/2012/01/16/using-the-freeipa-pki-with-puppet/">see
blogpost</a>)</p></li>
<li><p>Generate keytabs for both Puppet Master and Agent</p></li>
</ul>
</section>
<section id="puppet-ipa-openshift-module-in-detail">
<span id="puppet-ipaopenshift-module-in-detail"></span><h2>Puppet IPA/OpenShift Module in Detail<a class="headerlink" href="#puppet-ipa-openshift-module-in-detail" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Puppet’s init script selects IPA setup = True</p></li>
<li><p>NTP is configured from Agent -&gt; IPA Server</p></li>
<li><p>If operating system is Fedora, then packages = `freeipa-<em>`,
otherwise, `ipa-</em>`</p></li>
<li><p>Puppet ensures that both ipa-client and ipa-admintools are present on
the system</p></li>
<li><p>Ensure that the appropriate ports are open for IPA</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">/etc/ipa/default.conf</span></code> does not exist, then execute
<code class="docutils literal notranslate"><span class="pre">ipa-client-install</span> <span class="pre">--ssh-trust-dns</span></code> command with appropriate
parameters as sudo/root.</p>
<ol class="arabic simple">
<li><p>Configures Broker as a host in IPA</p></li>
<li><p>Configures host SSH keys for IPA + SSSD</p></li>
</ol>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">/etc/krb5.keytab</span></code> (and <code class="docutils literal notranslate"><span class="pre">/etc/httpd/conf/krb5.keytab</span></code> for a
Broker machine) is not present, then Puppet Master, as a <a class="reference external" href="https://docs.fedoraproject.org/en-US/Fedora/17/html/FreeIPA_Guide/Extending_the_Permissions_of_IPA_Managed_Hosts.html#Delegating_Service_Management">delegated
host</a>,
runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kinit -kt /etc/krb5.keytab host/`hostname`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa-service-add HTTP/${broker/node}.example.com
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa-getkeytab -s `hostname` -k /etc/httpd/conf/krb5.keytab -p HTTP/${broker/node}.example.com
</pre></div>
</div>
</li>
<li><p>If the Puppet Agent is a Broker:</p>
<ol class="arabic simple">
<li><p>Now that keytab definitely exists, ensure that apache is the owner
of <code class="docutils literal notranslate"><span class="pre">/etc/httpd/conf/krb5.keytab</span></code>.</p></li>
<li><p>Ensure that the auth plugin for Apache configuration is present
using a Puppet template, including <code class="docutils literal notranslate"><span class="pre">mod_auth_kerb</span></code>.</p></li>
<li><p>Ensure <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code> is used for the Apache instance on the
Console (note: two HTTP instances, one ‘Broker’ one ‘Console’.</p></li>
<li><p>Have Broker’s DHCP + BIND plays nice with IPA’s DNS server using a
Puppet template. An
<a class="reference external" href="http://sosiouxme.wordpress.com/2012/12/31/openshift-with-dynamic-host-ips/">overview</a>
of how-to.</p></li>
</ol>
</li>
</ol>
</section>
</section>
<section id="open-questions">
<span id="id5"></span><h1>Open Questions<a class="headerlink" href="#open-questions" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Will the delegated host bit work? re: # 7 of the <a class="reference external" href="http://freeipa.org/page/Plan:_FreeIPA_and_OpenShift_Enterprise_integration_with_Puppet#Puppet_IPA.2FOpenShift_Module_in_Detail">Module in
Detail</a></p></li>
<li><p>Is the <code class="docutils literal notranslate"><span class="pre">/etc/ipa/default.conf</span></code> file enough to determine if
ipa-client is not installed? Should I catch the error of ‘ipa-client
is already installed’?</p>
<ul>
<li><p>if error of already installed, then `ipa-client-install
–uninstall`</p></li>
<li><p>remove all keytabs left behind</p></li>
<li><p>run <code class="docutils literal notranslate"><span class="pre">ipa-client-install</span> <span class="pre">--ssh-trust-dns</span></code></p></li>
</ul>
</li>
<li><p>Can databases, such as Mongo, MySQL, Postgres, be enrolled as a host
and/or service w/ IPA?</p></li>
</ul>
</section>
<section id="reference-documentation-research">
<span id="id6"></span><h1>Reference Documentation &amp; Research<a class="headerlink" href="#reference-documentation-research" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://www.dropbox.com/s/qmsd3dulckn2nnh/IPA_OpenShift.pdf">Diagram of OpenShift + IPA
Architecture</a></p></li>
<li><p><a class="reference external" href="https://www.dropbox.com/s/9ckp02q5jsy9cb3/Puppet.pdf">Diagram of Puppet
Architecture</a></p></li>
<li><p><a class="reference external" href="https://www.dropbox.com/s/s6at6enzfh8lepn/IPA_OpenShift_Puppet.pdf">Diagram of Overall Design
Architecture</a></p></li>
<li><p><a class="reference external" href="http://jcape.name/2012/01/16/using-the-freeipa-pki-with-puppet/">Blog Post re: IPA certs and
Puppet</a></p></li>
<li><p><a class="reference external" href="https://github.com/thias/puppet-modules/tree/master/modules/ipa">Skeleton Code of a Puppet Manifest for
IPA</a></p></li>
<li><p><a class="reference external" href="http://sosiouxme.wordpress.com/2012/12/31/openshift-with-dynamic-host-ips/">Dynamic host IPs with
OpenShift</a></p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Plan:_FreeIPA_and_OpenShift_Enterprise_integration_with_Puppet.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>