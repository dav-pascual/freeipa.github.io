<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Requirements: &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Using IPA services for JBoss EAP/AS" href="JBoss.html" />
    <link rel="prev" title="HowTo Integrate FreeIPA with NFS share hosted on Dell EMC Unity" href="Integrating_Dell_EMC_Unity.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><a class="reference external" href="https://www.redhat.com/archives/freeipa-users/2014-October/msg00458.html">Provided by Loris Santamaria on the freeipa-users&#64;redhat.com
list.</a></p>
<p>Samba is a popular choice for a CIFS file server in Linux and Windows
deployments, and thanks to SSSD v1.12.2+ now it is easier than ever to
integrate a Samba file server in an IPA domain, with the usual goodies
expected from IPA, such as Single Sign On and support for trusted Active
Directory users.</p>
<p><strong>NOTE</strong>: Only Kerberos authentication will work when accessing Samba
shares using this method. This means that Windows clients not joined to
Active Directory forest trusted by IPA would not be able to access the
shares. This is related to SSSD not yet being able to handle NTLMSSP
authentication.</p>
<p><strong>NOTE</strong>: When a Windows client accesses shares, Windows UI will need to
be able to resolve SIDs in access control lists. Inability to do so will
affect user experience and the way how applications are expected to work
with the share. <a class="reference external" href="https://talks.vda.li/talks/2017/SambaXP/freeipa_gc.pdf">A set of experiments in
2017</a> have
demonstrated that Microsoft does not test various fall backs around this
behavior and only consider the path used by Windows UI to communicate
with a Global Catalog service. It is also a ‘client-specific’ behavior
and thus is not subject of a protocol interoperability or being
documented anywhere. While for some applications/use cases it may work,
it will not work for many others, thus we cannot really qualify it as a
supported solution from FreeIPA side.</p>
<section id="requirements">
<h1>Requirements:<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>An IPA v3.3+ domain</p></li>
<li><p>A CentOS or RHEL 7 server, which will be configured as a Samba file
server (Fedora 21 and RHEL7.1 are preferred)</p></li>
<li><p>Optionally, one trusted AD forest</p></li>
</ul>
<p><strong>NOTE</strong>: On the IPA masters run <code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code> to configure
IPA masters to handle Samba-specific object classes and attributes.
ipa-adtrust-install is part of <code class="docutils literal notranslate"><span class="pre">freeipa-server-trust-ad</span></code> package in
Fedora (<code class="docutils literal notranslate"><span class="pre">ipa-server-trust-ad</span></code> in RHEL 7 or CentOS).</p>
<p><strong>‘’IMPORTANT NOTE</strong>’’: On the samba file server it is necessary to
install <strong>sssd v1.12.2+</strong>, available in <strong>RHEL7.1/CentOS7.1</strong> or
<strong>Fedora 21</strong>. The packages sssd-libwbclient and libwbclient(from samba)
use alternatives to switch between these libraries. Packaging can be
different on other distributions and thus it needn’t work even with
sssd-libwbclient v1.12+.</p>
<ol class="arabic simple">
<li><p>Install required packages packages:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">-y</span> <span class="pre">install</span> <span class="pre">ipa-client</span> <span class="pre">sssd-libwbclient</span> <span class="pre">samba</span> <span class="pre">samba-client</span></code></p>
<ol class="arabic simple" start="2">
<li><p>join file server to the ipa realm:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">ipa-client-install</span> <span class="pre">--mkhomedir</span></code></p>
<p><strong>NOTE</strong>: This step may fail shortly after creating the keytab and
configuring sssd, caused by the version mismatch between ipa server
(3.3) and client (4.1). If failure happens, one can complete the
configuration manually:</p>
<p><code class="docutils literal notranslate"><span class="pre">authconfig</span> <span class="pre">--enablesssdauth</span> <span class="pre">--enablemkhomedir</span> <span class="pre">--update</span></code> (on the samba
file server)</p>
<p><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">dnsrecord-add</span> <span class="pre">my.realm</span> <span class="pre">sambatest</span> <span class="pre">--a-rec=x.y.w.z</span></code> (on ipa server)</p>
<ol class="arabic simple" start="3">
<li><p>On the ipa server create the cifs principal for samba:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">service-add</span> <span class="pre">cifs/sambatest.my.realm</span></code></p>
<ol class="arabic simple" start="4">
<li><p>Install keytab on the samba file server:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">ipa-getkeytab</span> <span class="pre">-s</span> <span class="pre">ipaserver.my.realm</span> <span class="pre">-p</span> <span class="pre">cifs/sambatest.my.realm</span> <span class="pre">-k</span> <span class="pre">/etc/samba/samba.keytab</span></code></p>
<ol class="arabic simple" start="5">
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/etc/samba/smb.conf</span></code> on the samba file server:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
        <span class="n">workgroup</span> <span class="o">=</span> <span class="n">MY</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="n">MY</span><span class="o">.</span><span class="n">REALM</span>
        <span class="n">dedicated</span> <span class="n">keytab</span> <span class="n">file</span> <span class="o">=</span> <span class="n">FILE</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">samba</span><span class="o">.</span><span class="n">keytab</span>
        <span class="n">kerberos</span> <span class="n">method</span> <span class="o">=</span> <span class="n">dedicated</span> <span class="n">keytab</span>
        <span class="n">log</span> <span class="n">file</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">log</span><span class="o">.%</span><span class="n">m</span>
        <span class="n">security</span> <span class="o">=</span> <span class="n">ads</span>

<span class="p">[</span><span class="n">homes</span><span class="p">]</span>
        <span class="n">browsable</span> <span class="o">=</span> <span class="n">no</span>
        <span class="n">writable</span> <span class="o">=</span> <span class="n">yes</span>

<span class="p">[</span><span class="n">shared</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">shared</span>
        <span class="n">writable</span> <span class="o">=</span> <span class="n">yes</span>
        <span class="n">browsable</span><span class="o">=</span><span class="n">yes</span>
        <span class="n">write</span> <span class="nb">list</span> <span class="o">=</span> <span class="nd">@admins</span>
</pre></div>
</div>
<p>6) To enable samba <code class="docutils literal notranslate"><span class="pre">/home</span></code> sharing you should turn the proper selinux
boolean:</p>
<p><code class="docutils literal notranslate"><span class="pre">setsebool</span> <span class="pre">-P</span> <span class="pre">samba_enable_home_dirs</span> <span class="pre">on</span></code></p>
<ol class="arabic simple" start="7">
<li><p>restart samba</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">smb.service</span></code></p>
</section>
<section id="testing">
<h1>Testing:<a class="headerlink" href="#testing" title="Permalink to this heading">¶</a></h1>
<p>On another linux member of the IPA domain it is possible to connect to
the samba shares using <code class="docutils literal notranslate"><span class="pre">smbclient</span> <span class="pre">-k</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">kinit</span> <span class="pre">user&#64;MY.REALM</span></code></p>
<p>smbclient -k -L sambatest.my.realm</p>
<p>smbclient -k //sambatest.my.realm/shared</p>
<p>On a Microsoft Windows machine member of a trusted AD domain it is
possible to connect to the samba shares by typing in the windows
explorer location bar:</p>
<p><code class="docutils literal notranslate"><span class="pre">\\sambatest.my.realm</span></code></p>
<p>Also, if the AD user is an (indirect) member of the IPA admins group,
thanks to the trust relationship and with the above sample <code class="docutils literal notranslate"><span class="pre">smb.conf</span></code>
he may have write access to the <code class="docutils literal notranslate"><span class="pre">\shared</span></code> folder.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/Howto/Integrating_a_Samba_File_Server_With_IPA.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>