<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Migration from different identity management solution &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Introduction" href="Promote_CA_to_Renewal_and_CRL_Master.html" />
    <link rel="prev" title="Using IPA services for JBoss EAP/AS" href="JBoss.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>There are several use cases where administrators may choose to migrate
either to FreeIPA, either on the same platform or OS or on different.
This page shows several procedures for different use cases:</p>
<section id="migration-from-different-identity-management-solution">
<span id="id1"></span><h1>Migration from different identity management solution<a class="headerlink" href="#migration-from-different-identity-management-solution" title="Permalink to this heading">¶</a></h1>
<section id="migrating-from-nis-to-freeipa">
<span id="id2"></span><h2>Migrating from NIS to FreeIPA<a class="headerlink" href="#migrating-from-nis-to-freeipa" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/migrating-from-nis.html">related RHEL Guide for detailed
steps</a></p>
</section>
<section id="migrating-from-ldap-to-freeipa">
<span id="id3"></span><h2>Migrating from LDAP to FreeIPA<a class="headerlink" href="#migrating-from-ldap-to-freeipa" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/Migrating_from_a_Directory_Server_to_IPA.html">related RHEL Guide
chapter</a>
or read <a class="reference external" href="https://www.dragonsreach.it/2014/10/12/the-gnome-infrastructures-freeipa-move-behind-the-scenes/">how GNOME project
migrated</a>
from OpenLDAP to FreeIPA.</p>
</section>
<section id="migrating-from-other-freeipa-to-freeipa">
<span id="id4"></span><h2>Migrating from other FreeIPA to FreeIPA<a class="headerlink" href="#migrating-from-other-freeipa-to-freeipa" title="Permalink to this heading">¶</a></h2>
<p>If you want to start a new FreeIPA deployment and you cannot simply
create FreeIPA replica as for example <em>realm</em> is now different, new
FreeIPA installation has to be made and data migrated.</p>
<p>Users and groups can be migrated using the <code class="docutils literal notranslate"><span class="pre">migrate-ds</span></code> command, just
like with any other LDAP based identity management server. You just need
to make sure that FreeIPA Kerberos related attributes are not migrated
as they need to be generated again by the new FreeIPA server and it’s
new <a class="reference external" href="Kerberos">Kerberos</a> settings or keys. The command doesn’t
migrate user private groups. Following command is suggested:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo Secret123 | ipa migrate-ds --bind-dn=&quot;cn=Directory Manager&quot; --user-container=cn=users,cn=accounts --group-container=cn=groups,cn=accounts --group-objectclass=posixgroup --user-ignore-attribute={krbPrincipalName,krbextradata,krblastfailedauth,krblastpwdchange,krblastsuccessfulauth,krbloginfailedcount,krbpasswordexpiration,krbticketflags,krbpwdpolicyreference,mepManagedEntry} --user-ignore-objectclass=mepOriginEntry --with-compat ldap://migrated.freeipa.server.test
</pre></div>
</div>
<p>Until <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3656">#3656</a> is
implemented, other objects (SUDO, HBAC, DNS, …) have to be migrated
manually, by exporting the LDIF from old FreeIPA instance, selecting the
records to be migrated, updating the attributes in batch (e.g. new
realm) and adding the cleaned LDIF to new FreeIPA.</p>
</section>
</section>
<section id="migrating-existing-freeipa-deployment">
<span id="id5"></span><h1>Migrating existing FreeIPA deployment<a class="headerlink" href="#migrating-existing-freeipa-deployment" title="Permalink to this heading">¶</a></h1>
<section id="upgrading-to-new-freeipa-release">
<span id="id6"></span><h2>Upgrading to new FreeIPA release<a class="headerlink" href="#upgrading-to-new-freeipa-release" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="Upgrade">Upgrade</a> page.</p>
<section id="general-procedure">
<span id="id7"></span><h3>General procedure<a class="headerlink" href="#general-procedure" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Before you begin, make sure that you have <strong>sufficient redundancy</strong>
in your FreeIPA deployment (at least <strong>2 running replicas</strong>). If the
upgrade procedure goes wrong in any way, other FreeIPA server can
keep the functionality until the upgrade process is successfully
finished. If there is just one FreeIPA server, consider <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/Setting_up_IPA_Replicas.html">preparing a
new
replica</a>
used for the upgrade.</p></li>
<li><p>When ready, simply upgrade the underlying operating system and
FreeIPA packages on chosen replica. After the upgrade, it may be
useful to see <code class="docutils literal notranslate"><span class="pre">/var/log/ipaupgrade.log</span></code> and check for errors..</p></li>
<li><p>When the upgrade is finished, it is recommended to check the upgraded
services to see that upgrade procedure was successful. This includes
testing that:</p>
<ul>
<li><p>FreeIPA users are still recognized by the operating system</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">id</span> <span class="pre">$USER</span></code></p>
</li>
<li><p>Kerberos authentication still works and passwords can be changed</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kinit</span> <span class="pre">$USER</span></code></p>
</li>
<li><p>ipa command works</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ipa</span> <span class="pre">user-find</span></code></p>
</li>
<li><p>Web UI works</p></li>
<li><p><a class="reference external" href="DNS">DNS</a> service (if provided by the server) works</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">host</span> <span class="pre">$(hostname)</span></code></p>
</li>
<li><p><a class="reference external" href="PKI">CA</a> services (if appropriate) works</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ipa</span> <span class="pre">cert-find</span></code>
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ipa</span> <span class="pre">cert-request</span> <span class="pre">$(CSR_FILENAME)</span></code></p>
</li>
</ul>
</li>
<li><p>After the FreeIPA upgrade is confirmed to be successful, remaining
FreeIPA server may be upgraded using the same procedure, one by one.</p></li>
</ol>
</section>
</section>
<section id="migrating-to-different-platform-or-os">
<span id="id8"></span><h2>Migrating to different platform or OS<a class="headerlink" href="#migrating-to-different-platform-or-os" title="Permalink to this heading">¶</a></h2>
<p>Sometimes, FreeIPA server package update within one operating system may
not be an option. In that case, the following general procedure can be
applied:</p>
<ol class="arabic">
<li><p>At the start of the procedure, there is a number of FreeIPA servers
that are about to be migrated to different platform or OS</p></li>
<li><p>On one of your servers, create a replica file
(<code class="docutils literal notranslate"><span class="pre">ipa-replica-prepare</span></code>) and copy the replica file to the new
server/VM which will host the FreeIPA server</p></li>
<li><p>Install the, preferably most up-to-date, FreeIPA server on the target
system (<code class="docutils literal notranslate"><span class="pre">ipa-replica-install</span></code>). It should have all the services as
the original server had, i.e.</p>
<ul>
<li><p>if original server had <a class="reference external" href="PKI">CA</a> installed (it probably did),
add <code class="docutils literal notranslate"><span class="pre">--setup-ca</span></code> option to <code class="docutils literal notranslate"><span class="pre">ipa-replica-install</span></code></p></li>
<li><p>Note that the FreeIPA master <a class="reference external" href="PKI">CA</a> server (this is by
default the first installed FreeIPA server) is being migrated, you
need to <a class="reference external" href="Howto/Promote_CA_to_Renewal_and_CRL_Master">promote the new CA replica to the FreeIPA master CA
server</a></p></li>
<li><p>if original server had <a class="reference external" href="DNS">DNS</a> installed , also add
<code class="docutils literal notranslate"><span class="pre">--setup-dns</span></code> option to <code class="docutils literal notranslate"><span class="pre">ipa-replica-install</span></code></p>
<p>The new server should now have all the capability of the migrated
servers. Administrator may want to run at least a basic test to
test all major functions of the migrated FreeIPA server, namely
testing that:</p>
</li>
<li><p>FreeIPA users are still recognized by the operating system</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">id</span> <span class="pre">$USER</span></code></p>
</li>
<li><p>Kerberos authentication still works and passwords can be changed</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">kinit</span> <span class="pre">$USER</span></code></p>
</li>
<li><p>ipa command works</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ipa</span> <span class="pre">user-find</span></code></p>
</li>
<li><p>Web UI works</p></li>
<li><p><a class="reference external" href="DNS">DNS</a> service (if provided by the server) works</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">host</span> <span class="pre">$(hostname)</span></code></p>
</li>
<li><p><a class="reference external" href="PKI">CA</a> services (if appropriate) works</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ipa</span> <span class="pre">cert-find</span></code>
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ipa</span> <span class="pre">cert-request</span> <span class="pre">$(CSR_FILENAME)</span></code></p>
</li>
</ul>
</li>
<li><p>If the FreeIPA server is configured to provide <a class="reference external" href="DNS">DNS</a> service,
FreeIPA domain SRV records should be already updated and FreeIPA
clients will also use the migrated FreeIPA server for their function.
When other <a class="reference external" href="DNS">DNS</a> service is used, SRV records need to be
either updated manually, if used. If clients are using fixed list of
servers, administrator would need to update these lists in
<code class="docutils literal notranslate"><span class="pre">/etc/sssd/sssd.conf</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/krb5.conf</span></code> and other
configuration files that were manually configured.</p></li>
<li><p>If the installation was successful and the actual migration is about
to start, administrator may want to spin off more replica on the new
platform to:</p>
<ul class="simple">
<li><p>Keep redundancy in case of failure of one of the migrated server</p></li>
<li><p>Split the load when the migrated servers go live</p></li>
</ul>
</li>
<li><p>When the FreeIPA servers on the migrated platform are ready, old
FreeIPA servers can be stopped, one by one, so that clients will only
use the migrated FreeIPA servers:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ipactl</span> <span class="pre">stop</span></code>
This step is important, this will prevent loosing data in case the
new server misses some functionality and will let you start the
server again in such case</p>
</div></blockquote>
</li>
<li><p>When administrator verifies that clients keep functioning properly,
old FreeIPA server may be removed:</p>
<ol class="arabic">
<li><p>Log in to one of the migrated FreeIPA servers</p></li>
<li><p>List all servers in the realm:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">list</span></code></p>
</div></blockquote>
</li>
<li><p>Identity server on the olf platform and start removing them, one
by one:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span> <span class="pre">old.ipa.server.fqdn</span></code></p>
</div></blockquote>
<p>This procedure will also remove these servers from FreeIPA
<a class="reference external" href="DNS">DNS</a> SRV records, if used.</p>
</li>
</ol>
</li>
<li><p>Old FreeIPA servers can be now uninstalled with
<code class="docutils literal notranslate"><span class="pre">ipa-server-install</span> <span class="pre">--uninstall</span></code></p></li>
</ol>
</section>
</section>
<section id="migrating-identity-management-in-rhel-centos">
<span id="migrating-identity-management-in-rhelcentos"></span><h1>Migrating Identity Management in RHEL/CentOS<a class="headerlink" href="#migrating-identity-management-in-rhel-centos" title="Permalink to this heading">¶</a></h1>
<p>If you are using FreeIPA/Identity Management in RHEL or CentOS, please
refer to downstream guide for migration process:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/upgrading.html#migrating-ipa-proc">Migrating the IdM Server to Red Hat Enterprise Linux
7</a></p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/Howto/Migration.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>