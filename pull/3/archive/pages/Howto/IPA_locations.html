<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Short feature description &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Description" href="IPAv3_Add_a_KRA.html" />
    <link rel="prev" title="HBAC and the allow_all problem" href="HBAC_and_allow_all.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="short-feature-description">
<span id="id1"></span><h1>Short feature description<a class="headerlink" href="#short-feature-description" title="Permalink to this heading">¶</a></h1>
<p>IPA (DNS) Locations feature can be used to distribute load from clients.
This is done by SRV records with the proper priority set and CNAME
aliases. Servers in IPA location redirect DNS queries using CNAME to
location records.</p>
<p>IPA servers outside location work as backup servers. In case that all
IPA servers in the particular location failed to respond, servers from
outside of the location will be used.</p>
<section id="information-good-to-know">
<span id="id2"></span><h2>Information good to know<a class="headerlink" href="#information-good-to-know" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Only IPA system services are supported.</p></li>
<li><p>IPA DNS subsystem must be installed.</p></li>
<li><p>IPA DNS must be authoritative for primary IPA DNS domain.</p></li>
<li><p>IPA locations use SRV records, without functional DNS server inside a
location, this location effectively stops working.</p></li>
<li><p>IPA locations use priority field in SRV records to prefer servers in
the location. Servers with priority 0 belongs to the location,
servers with priority 50 are backup servers from outside of the
location.</p></li>
<li><p>Membership of client in a location depends on DNS server which is
configured as resolver for client. (Directly or indirectly through
recursors etc.)</p></li>
<li><p>Each location must contain at leas one IPA DNS server.</p></li>
<li><p>Multiple IPA DNS servers per location are recommended (backup DNS
servers inside one location).</p></li>
<li><p>Be careful with caching DNS servers. Caching DNS servers may cause
delay in propagation of changes in locations. This can be solved by
lowering TTL for location records in advance (IPA default is one
day).</p></li>
<li><p>Clients must be able to work with SRV and CNAME records to work with
IPA locations properly.</p></li>
</ul>
</section>
</section>
<section id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h1>
<section id="topology">
<h2>Topology<a class="headerlink" href="#topology" title="Permalink to this heading">¶</a></h2>
<figure class="align-default" id="id12">
<img alt="dns_location_topology.svg" src="../../../_images/Dns_location_topology.svg" /><figcaption>
<p><span class="caption-text">dns_location_topology.svg</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="installation-server">
<span id="id3"></span><h2>Installation (server)<a class="headerlink" href="#installation-server" title="Permalink to this heading">¶</a></h2>
<p>Please note the following steps are just examples, in real world, do not
forget to add additional replication agreements as backup to prevents
disconnect topology.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa-server-install --setup-dns</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;prague1 ~]# ipa-replica-install --setup-dns</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;prague2 ~]# ipa-replica-install --setup-dns</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;paris1 ~]# ipa-replica-install --setup-dns</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;paris2 ~]# ipa-replica-install</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;paris3 ~]# ipa-replica-install --setup-dns</span></code></div>
</div>
</section>
<section id="adding-locations">
<span id="id4"></span><h2>Adding locations<a class="headerlink" href="#adding-locations" title="Permalink to this heading">¶</a></h2>
<p>Use <strong>location-add</strong> command to create a new location.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa location-add czechrep --description=&quot;Czech republic clients&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa location-add france --description=&quot;France clients&quot;</span></code></div>
</div>
</section>
<section id="adding-servers-to-locations">
<span id="id5"></span><h2>Adding servers to locations<a class="headerlink" href="#adding-servers-to-locations" title="Permalink to this heading">¶</a></h2>
<p>Use <strong>server-mod</strong> command to add server into location. Server can be
member of only one location.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa server-mod prague1.example.com --location=czechrep</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa server-mod prague2.example.com --location=czechrep</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa server-mod paris1.example.com --location=france</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa server-mod paris2.example.com --location=france</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa server-mod paris3.example.com --location=france</span></code></div>
</div>
</section>
<section id="advanced-configuration">
<span id="id6"></span><h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this heading">¶</a></h2>
<section id="setting-service-weight">
<span id="id7"></span><h3>Setting service weight<a class="headerlink" href="#setting-service-weight" title="Permalink to this heading">¶</a></h3>
<p>Using weight attribute in SRV records, you can customize load between
servers in a location (for servers without location too). Servers with
better performance can have assigned higher weight for IPA services and
those servers will receive more queries than others. To set weight for
IPA system SRV records, please use <strong>server-mod</strong>. For further
information about weight please see <a class="reference external" href="https://tools.ietf.org/html/rfc2782#page-3">RFC 2783 page
3</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa server-mod paris2.example.com --service-weight=2000</span></code></p>
</section>
<section id="lowering-ttl">
<span id="id8"></span><h3>Lowering TTL<a class="headerlink" href="#lowering-ttl" title="Permalink to this heading">¶</a></h3>
<p>In case you use caching DNS servers, you may need to lower default TTL
(86400) of the IPA domain. Any change in locations or in system records
will be reflected on caching servers after the TTL of original records
expires. Lowering TTL in advance is good for planned changes in
topology.</p>
<p>To change default TTL use <strong>dnszone-mod</strong> command.</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa dnszone-mod example.com. --default-ttl=3600</span></code></p>
</section>
</section>
<section id="installation-client">
<span id="id9"></span><h2>Installation (client)<a class="headerlink" href="#installation-client" title="Permalink to this heading">¶</a></h2>
<p>Client must have set the proper resolver which belongs to the location
where clients are supposed to be located in. Preferred is to configure
resolvers using DHCP, as we expect that the network topology respects
geographical location, and the DHCP provides the closest DNS server IP
addresses, thus this should be done without any extra configuration.</p>
<p>Please note that all nameservers configured on client should be in the
same location. A configuration with nameservers from various location
will work, but it may result into inefficient resolving.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;client-prague ~] # cat /etc/resolv.conf</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nameserver 10.10.0.1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nameserver 10.10.0.2</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;client-paris ~]# cat /etc/resolv.conf</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nameserver 10.50.0.1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nameserver 10.50.0.3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;client-berlin ~]# cat /etc/resolv.conf</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nameserver 10.30.0.1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;client-oslo ~]# cat /etc/resolv.conf</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">nameserver 10.30.0.1</span></code></div>
</div>
<p>If resolvers are properly set, you can install clients by using
<strong>ipa-client-install</strong>.</p>
</section>
<section id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Permalink to this heading">¶</a></h2>
<p>We can use <strong>dig</strong> to verify returned DNS records</p>
<p>Server/client without locations</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# dig +short _ldap._tcp.example.com SRV</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 berlin.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 prague1.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 prague2.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 paris1.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 2000 389 paris2.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 paris3.example.com.</span></code></div>
</div>
<p>Server/client inside <em>czechrep</em> location</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;client-prague ~]# dig +short _ldap._tcp.example.com SRV</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">_ldap._tcp.czechrep._locations.example.com.    # CNAME alias _ldap._tcp --&gt; _ldap._tcp.czechrep._locations</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 100 389 berlin.example.com.    # server with lower priority (50), outside of location</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 prague1.example.com.    # server inside location</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 prague2.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 100 389 paris1.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 2000 389 paris2.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 100 389 paris3.example.com.</span></code></div>
</div>
<p>Server/client inside <em>france</em> location</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;client-paris ~]# dig +short _ldap._tcp.example.com SRV</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">_ldap._tcp.france._locations.example.com.    # CNAME alias _ldap._tcp --&gt; _ldap._tcp.france._locations</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 100 389 berlin.example.com.    # server with lower priority (50), outside of location</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 100 389 prague1.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">50 100 389 prague2.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 paris1.example.com.    # server inside location</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 2000 389 paris2.example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">0 100 389 paris3.example.com.</span></code></div>
</div>
<section id="get-list-of-all-required-records">
<span id="id10"></span><h3>Get list of all required records<a class="headerlink" href="#get-list-of-all-required-records" title="Permalink to this heading">¶</a></h3>
<p>You can use command <strong>ipa dns-update-system-records –dry-run</strong> to print
list of all required system records, and location records. Eventually if
some records are missing in IPA domain, you can use this command
<strong>without –dry-run</strong> option to fix missing system records.</p>
</section>
</section>
<section id="example-with-non-freeipa-dns-servers">
<span id="id11"></span><h2>Example with non-FreeIPA DNS servers<a class="headerlink" href="#example-with-non-freeipa-dns-servers" title="Permalink to this heading">¶</a></h2>
<p>The first example assumed that you have at least one FreeIPA DNS server
in each location. With same effort the same feature can be implemented
also using external DNS servers. Following example is using InfoBlox’s
support for DNS view to simulate multiple DNS servers in each location:</p>
<ul class="simple">
<li><p>On Infoblox, create DNS view <strong>for each location</strong>:</p></li>
<li><p>Data Management -&gt; DNS -&gt; Zones -&gt; click to Plus sign to add DNS view</p></li>
<li><p>Add DNS view step 1 -&gt; fill-in name, use the same name as for IPA location, e.g. “czechrep”</p></li>
<li><p>Add DNS view step 2 -&gt; specify Match Clients rule so that all clients in “czechrep” location domain belong to this DNS view</p></li>
<li><p>Add DNS view step 3 -&gt; Save</p></li>
<li><p>In each DNS view, create two zones with names: “_udp.”, “_tcp.”</p></li>
</ul>
<p>These zones (specific for each DNS view) will be filled-in with records
produced by the IPA server.</p>
<ul class="simple">
<li><p>On a IPA server, run command:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa dns-update-system-records --dry-run</span></code></p>
<p>It will produce a lot of DNS records. We are interested in records
listed in section <strong>IPA location records</strong>:</p>
<div class="line-block">
<div class="line">`` IPA location records:``</div>
<div class="line">``   _kerberos-master._tcp.czechrep._locations.example.com. …``</div>
<div class="line">``   _kerberos-master._udp.france._locations.example.com. …``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
<p>Each IPA location has own set of records. Records specific to given
location contain <code class="docutils literal notranslate"><span class="pre">._locations</span></code> in their name.</p>
<ul class="simple">
<li><p>For each DNS location/DNS view, select relevant records from
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">dns-update-system-records</span> <span class="pre">--dry-run</span></code>’s output and transform
them to form suitable for general purpose DNS server. E.g.:</p></li>
</ul>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">LOCATION=czechrep</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin ~]# ipa dns-update-system-records --dry-run | grep $LOCATION._locations | sed &quot;s/\.$LOCATION\._locations//&quot;</span></code></div>
</div>
<p>This way, you will obtain list of records for each location. Each list
contains records with the same names (the left side) but different data
(the right side).</p>
<ul class="simple">
<li><p>As the last step, take this list of records and for each location,
copy it into particular Infoblox’s DNS view.</p></li>
</ul>
<p>Now you are done. Clients using DNS discovery to find IPA servers will
prefer the local servers automatically (as soon as DNS TTL expires). Of
course, the procedure needs to be repeated each time you reconfigure IPA
location or do a modification to a IPA server topology.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/Howto/IPA_locations.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>