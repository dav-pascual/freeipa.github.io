<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Trust_config_command.html" />
    <link rel="prev" title="Overview" href="Single_OCSP_and_CRL_in_certs.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>__NOTOC__</p>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>FreeIPA v3 supports cross-forest trusts to Active Directory domains. By
their nature, cross-forest trusts are established at the forest root
level. Each forest root domain’s domain controller is responsible to
expose subordinate domains to the trusting party.</p>
<p>FreeIPA v3 currently does not support fetching transitive trusts
information and providing its own view of a FreeIPA forest.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>Following use cases considered:</p>
<ul class="simple">
<li><p>Active Directory forest with a resource domain and user domain where
the user domain is not the forest root, and users in AD need to
access resources in FreeIPA forest</p></li>
<li><p>Active Directory forest with a resource domain and user domain where
the resource domain is not the forest root, and users in FreeIPA need
to access resources in AD forest</p></li>
</ul>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>Main tracking ticket: <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3510">https://fedorahosted.org/freeipa/ticket/3510</a></p>
<p>Transitive trusts enquiry requires that information about other domains
is available through the Global Catalog service in the forest root
domain. A trusting party can query the GC to perform SID-to-name and
name-to-SID resolution operations. Additionally, FreeIPA will need to
retrieve transitive trust information from the AD side.</p>
<p>The following should be implemented:</p>
<ul class="simple">
<li><p>A GC service on at least one FreeIPA master, exposing an AD
compatible schema and the necessary set of information derived from
the main LDAP instance</p></li>
<li><p>Discovery of all the trusted domains within the trusted AD forest</p></li>
<li><p>CLI and Web UI to manage filtering of trusted domain’s trusts and
refreshing list of domains</p></li>
</ul>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<section id="global-catalog-service">
<span id="id1"></span><h2>Global Catalog service<a class="headerlink" href="#global-catalog-service" title="Permalink to this heading">¶</a></h2>
<p>The Global Catalog service will be implemented through a separate
directory server (389-ds) instance. In this instance, a separate
AD-compatible schema will be used and a read-only view of the original
data will be given according to an AD-compatible DIT.</p>
<p>A special plugin will be used to connect to the original FreeIPA
directory server instance to notice any changes and propagate them to
the GC instance. The plugin will rely on the forthcoming SyncRepl
feature of 389-ds (ticket <a class="reference external" href="https://fedorahosted.org/389/ticket/47388">“RFE Support ‘Content Synchronization
Operation’ (SyncRepl) - RFC
4533”</a>)</p>
<p>A specialized tool to bootstrap the GC instance based on an
AD-compatible schema and an existing FreeIPA directory service instance
needs to be developed for testing and development purposes. This tool
will use the existing ‘ipaserver.install.dsinstance’ code and configure
the instance based on existing parameters for the original instance.</p>
</section>
<section id="discovery-of-the-trusted-domain-s-partnerships">
<span id="discovery-of-the-trusted-domains-partnerships"></span><h2>Discovery of the trusted domain’s partnerships<a class="headerlink" href="#discovery-of-the-trusted-domain-s-partnerships" title="Permalink to this heading">¶</a></h2>
<p>FreeIPA framework will need to fetch list of the domains in the trusted
forest and their trusted domains, and configure both domain and range
objects for these additional domains. This is achieved by the use of
netr_DsrEnumerateDomainTrusts DCE RPC call.</p>
<p>All imported domains need to have SID filtration set up for them
according to the rules described in <a class="reference external" href="http://technet.microsoft.com/en-us/library/cc755673%28v=ws.10%29.aspx">this MSDN
article</a></p>
</section>
<section id="kerberos-dal-driver-modifications">
<span id="id2"></span><h2>Kerberos DAL driver modifications<a class="headerlink" href="#kerberos-dal-driver-modifications" title="Permalink to this heading">¶</a></h2>
<p>Kerberos DAL driver will need to be updated to understand transitive
trusts. It includes understanding that a ticket from a child domain
should be usable with a cross-realm TGT belonging to the forest root
domain. This is supposedly done by implementing check_transited_realms()
method in the driver (though little examples exist for this method).</p>
<p>Since forest-level trusts with Active Directory can only be established
with root level domain of the foreign forest, cross-realm TGT will
always be issued by the root level domain’s DC. This ticket is already
trusted by FreeIPA Kerberos DAL driver.</p>
<p>However, when accessing services in the non-root level domains in the
trusted forest, a request for a ticket for those services should be
forwarded to the DC of the root domain. We need to ensure proper
realm/domain and capaths mappings are in place.</p>
<p>When non-root level domains in the trusted forest are hierarchical to
the root domain, MIT Kerberos KDC already knows how to transit trust
paths to then. When there are non-heirarchical domains in the trusted
forest, [capaths] should be set up on all IPA clients to establish
proper transit trust path towards non-root level domains in the trusted
forest.</p>
<p>In SSSD following tickets were opened to track these changes:
<a class="reference external" href="https://fedorahosted.org/sssd/ticket/2080">https://fedorahosted.org/sssd/ticket/2080</a> and
<a class="reference external" href="https://fedorahosted.org/sssd/ticket/2093">https://fedorahosted.org/sssd/ticket/2093</a>.</p>
</section>
<section id="realm-and-domain-mapping-for-forest-domains">
<span id="id3"></span><h2>Realm and domain mapping for forest domains<a class="headerlink" href="#realm-and-domain-mapping-for-forest-domains" title="Permalink to this heading">¶</a></h2>
<p>When trust to an AD forest is established, we trust explicitly root
level domain in the forest. For all other domains in the forest trust
path should go through the root level domain. However, FreeIPA needs to
know about the domains first.</p>
<ul class="simple">
<li><p>List of the domains belonging to a forest needs to be fetched upon
establishing the trust</p></li>
<li><p>List of the domains belonging to the trusted domain may be refreshed
after trust is established. The update process should be triggered by
an admin manually since adding new domains is rare</p></li>
<li><p>Information about domains from the trusted forest needs to be stored
in FreeIPA LDAP storage</p></li>
<li><p>For each domain from the trusted forest there should be identity
range created in order to allow user and group enumeration for the
domain</p></li>
<li><p>FreeIPA PDB module to Samba should be able to retrieve the list of
the domains and provide it to other Samba components similar to how
we provide list of our own additional DNS domains</p></li>
<li><p>SSSD should be able to fetch the list of the domains and expose it to
IPA clients for proper configuration of the Kerberos applications via
domain/realm mapping and auth_to_local regular expressions in
krb5.conf. In MIT Kerberos 1.12 there will be new API added to allow
bulk auth_to_local ruleset handling.</p></li>
</ul>
</section>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<p>TODO.</p>
<p>Since discovery of the domains belonging to the trusted forest can be
run by an administrator at will, new CLI command is required. <strong>ipa
trust-domain</strong> command family will contain the commands to operate on
the information about trusted forest domains.</p>
<dl class="simple">
<dt>ipa trust-fetch-domains</dt><dd><p>Fetches the list of domains belonging to the forest trust. If there
are already domains defined for the trust with the same name, no
changes are done to them)</p>
</dd>
<dt>ipa trustdomain-find</dt><dd><p>Displays list of domains associated with the trust. Root level domain
is always included</p>
</dd>
<dt>ipa trustdomain-del</dt><dd><p>Removes domain from the trust. As result, Kerberos principals
belonging to the domain will not be allowed to access IPA resources.
Root level domain cannot be removed through this command as it makes
trust inactive.</p>
</dd>
<dt>ipa trustdomain-disable</dt><dd><p>Adds SID of the domain from the list of filtered SIDs for this trust.
SID filtering per trust is already implemented in <strong>trust-mod</strong>. SID
filtering can be used to temporarily block access to IPA resources
from the domain.</p>
</dd>
<dt>ipa trustdomain-enable</dt><dd><p>Removes SID of the domain from the list of filtered SIDs for this
trust. SID filtering per trust is already implemented in
<strong>trust-mod</strong>.</p>
</dd>
</dl>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>SSSD will need to understand transitive trusted domains membership.</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>Part of the implementation relies on SSSD being able to understand
transitive trusted domain membership for incoming users</p>
</section>
<section id="backup-and-restore">
<h1>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">¶</a></h1>
<p>TODO</p>
</section>
<section id="rfe-author">
<h1>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">¶</a></h1>
<p>Alexander Bokovoy</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V3/Transitive_Trusts.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>