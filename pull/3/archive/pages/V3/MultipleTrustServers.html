<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Description" href="Multitenancy.html" />
    <link rel="prev" title="Overview (#2732)" href="Messages.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>__NOTOC__</p>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Ticket <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2189">#2189</a>;</p>
<p>Each FreeIPA server in the realm has potential to serve as domain
controller in the cross-forest realm trust. This page outlines design
for implementing multiple servers support in FreeIPA.</p>
</section>
<section id="use-cases">
<span id="use-cases10g"></span><h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<p>Once <code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code> ran on the FreeIPA server, the server can
handle requests from trusted domains by means of Samba project’s
<code class="docutils literal notranslate"><span class="pre">smbd</span></code> and <code class="docutils literal notranslate"><span class="pre">winbindd</span></code> daemons.</p>
<p>Hosts in FreeIPA realm may be enrolled against specific FreeIPA replica
server. User from trusted domain can access these hosts and their
identities will be resolved against the replica. However, if replica
server does not have trust support configured, these identities will not
be processed since running <code class="docutils literal notranslate"><span class="pre">winbindd</span></code> process is required to contact
the trusted domain’s domain controllers and Global Catalog servers.</p>
<p>Domain controllers are advertised to clients via SRV records in DNS.
Since replica servers may be arranged in a specific topology, adding new
domain controller would need to respect the topology design. It means
priority/weight of the domain controller compared to other domain
controllers should be adjustable. Prime use case for this is branch
office deployments.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Each domain controller uses separate identity and service key to talk
to FreeIPA LDAP server. The identity is tied to the server hostname.</p></li>
<li><p>Service principal is <code class="docutils literal notranslate"><span class="pre">cifs/hostname&#64;REALM</span></code>, identified in LDAP as
<code class="docutils literal notranslate"><span class="pre">krbprincipalname=cifs/hostname&#64;REALM</span></code>.</p></li>
<li><p>All identities are members of
<code class="docutils literal notranslate"><span class="pre">cn=adtrust</span> <span class="pre">agents</span></code>,<code class="docutils literal notranslate"><span class="pre">cn=sysaccounts</span></code>,<code class="docutils literal notranslate"><span class="pre">cn=etc</span></code>,<code class="docutils literal notranslate"><span class="pre">$SUFFIX</span></code>.
Thus, all replica servers can see what other servers are providing
domain controller service.</p></li>
<li><p>Replica server only becomes domain controller when
<code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code> utility was executed on it. It means all DC
setup is delivered via the <code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code> should be able to detect other DCs by looking
at existing identities as members of the
<code class="docutils literal notranslate"><span class="pre">cn=adtrust</span> <span class="pre">agents</span></code>,<code class="docutils literal notranslate"><span class="pre">cn=sysaccounts</span></code>,<code class="docutils literal notranslate"><span class="pre">cn=etc</span></code>,<code class="docutils literal notranslate"><span class="pre">$SUFFIX</span></code>
tree and modify list of SRV records under <code class="docutils literal notranslate"><span class="pre">_msdcs</span></code> and default site
configuration if DNS is controlled by FreeIPA.</p></li>
<li><p>Domain Controller priority/weight can be modified at run time since
it only affects SRV records in the DNS (if FreeIPA controls the DNS).
Normal <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">dnsrecord-mod</span></code> commands should be used for this
purpose, operating on SRV records for <code class="docutils literal notranslate"><span class="pre">_msdcs</span></code> and default site
configuration.</p></li>
<li><p>There are trust properties that are global for the realm. Some of
them are modifiable, some not. Thus, <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">trustconfig-show</span></code> and
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">trustconfig-mod</span></code> should reflect both global and local settings
(realm-wise and DC-wise).</p></li>
<li><p>Following properties of the trust are global for the realm:</p>
<ul>
<li><p>NetBIOS domain name (read-only, affects existing trusts)</p></li>
<li><p>Domain name (read-only, affects existing trusts)</p></li>
<li><p>Domain GUID (read-only, informational)</p></li>
<li><p>Additional domain suffixes exposed to the trusted party, handled
as black list against global list of additional domains associated
with our or transitive realm, read/write</p></li>
<li><p>Fallback primary group (read-write)</p></li>
</ul>
</li>
<li><p>Following properties of the trust are per Domain Controller:</p>
<ul>
<li><p>priority of the DC and GC services (read-write, DNS SRV record)</p></li>
</ul>
</li>
</ul>
<p>Details on <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">trustconfig</span></code> commands design are available at
<a class="reference external" href="http://www.freeipa.org/page/V3/Trust_config_command">http://www.freeipa.org/page/V3/Trust_config_command</a> Details on
additional domain suffixes handling are available at
<a class="reference external" href="http://www.freeipa.org/page/V3/Domain_suffixes">http://www.freeipa.org/page/V3/Domain_suffixes</a></p>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<p>Implementation-wise there are three parts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code>:</p>
<ul>
<li><p>Gather list of CIFS services that are also members of
<code class="docutils literal notranslate"><span class="pre">cn=adtrust</span> <span class="pre">agents</span></code> and add SRV records for them to _msdcs in
ipaserver/install/adtrustinstance.py:ADTrustInstance::__add_dns_service_records().</p></li>
<li><p>Once Global Catalog Server implementation will be ready, configure
its use as one of <code class="docutils literal notranslate"><span class="pre">ADTrustInstance</span></code> setup steps.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">IPA</span> <span class="pre">framework</span></code>:</p>
<ul>
<li><p>Add display and modification of trust properties as
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">trustconfig-*</span></code> commands, including listing DC and GC
servers.</p></li>
<li><p>NOTE: there is no need to modify trust creation procedure since it
appears that AD DC assumes LSA CreateTrustedDomainEx2 call comes
from the DC (in Windows the UI to establish trust is only on DC)
and therefore does not do DNS discovery during validation step.
Since smbd running on the same host that ‘ipa trust-add’ runs on
will contact the same host’s LDAP server, there is no issue in
replication at this stage.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">IPA</span> <span class="pre">Web</span> <span class="pre">UI</span></code></p>
<ul>
<li><p>Add support for <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">trustconfig-*</span></code> to Web UI.</p></li>
</ul>
</li>
</ul>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>No additional options to <code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code></p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>All data is already in a replicated namespace.</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>No changes to schema, no need to run anything additional on updates or
upgrades</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>No additional dependencies beyond AD trusts support</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>Once <code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code> install ran on replica, the replica will be
advertised via <code class="docutils literal notranslate"><span class="pre">_msdcs</span></code> SRV namespace as a domain controller.</p>
</section>
<section id="rfe-author">
<h1>RFE author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="User:ab">Alexander Bokovoy</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V3/MultipleTrustServers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>